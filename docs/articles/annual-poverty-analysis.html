<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Monthly Poverty Analysis with Annual PNADC Data • PNADCperiods</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Monthly Poverty Analysis with Annual PNADC Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PNADCperiods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/download-and-prepare.html">Download and Prepare Data</a></li>
    <li><a class="dropdown-item" href="../articles/applied-examples.html">Applied Examples</a></li>
    <li><a class="dropdown-item" href="../articles/annual-poverty-analysis.html">Annual Poverty Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/complex-survey-design.html">Complex Survey Design</a></li>
    <li><a class="dropdown-item" href="../articles/how-it-works.html">How PNADCperiods Works</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/sidra-mensalization.html">SIDRA Mensalization Guide</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/antrologos/PNADCperiods/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Monthly Poverty Analysis with Annual PNADC Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antrologos/PNADCperiods/blob/HEAD/vignettes/annual-poverty-analysis.Rmd" class="external-link"><code>vignettes/annual-poverty-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>annual-poverty-analysis.Rmd</code></div>
    </div>

    
    
<!--
MAINTAINER NOTE:
The code chunks in this vignette must match the code in:
  mensalizacao_pnad/code/generate_annual_poverty_figures.R

Look for comments like "# VIGNETTE CODE: chunk-name" in that script.
To regenerate figures, run that script.
-->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When exactly did poverty spike during COVID-19? Official annual
statistics tell us that 2020 was a difficult year—but they can’t tell us
whether the crisis peaked in April or June, whether the Auxilio
Emergencial reduced poverty immediately or with a delay, or what the
month-by-month recovery path looked like. <strong>Monthly data
can.</strong></p>
<p>This vignette combines the mensalization algorithm with
<strong>annual PNADC data</strong> to produce monthly poverty
statistics. The annual PNADC releases contain comprehensive household
income measures (<code>VD5008</code>) that aren’t available in the
quarterly releases. By applying a mensalization crosswalk (built from
quarterly data) to annual income data, we get monthly temporal precision
with comprehensive income measurement.</p>
<div class="float">
<img src="figures/annual-poverty-analysis/fig-workflow-diagram.png" style="width:100.0%" alt="Data Workflow: Monthly Poverty Analysis with Annual PNADC"><div class="figcaption">Data Workflow: Monthly Poverty Analysis with
Annual PNADC</div>
</div>
<p>IBGE’s PNADC uses a rotating panel design where the same households
appear in both quarterly and annual data. The workflow is:</p>
<ol style="list-style-type: decimal">
<li>Build a <strong>crosswalk</strong> from quarterly data using
<code><a href="../reference/pnadc_identify_periods.html">pnadc_identify_periods()</a></code>
</li>
<li>
<strong>Apply</strong> the crosswalk to annual income data with
<code><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods()</a></code> (which handles the merge internally
and calibrates weights)</li>
<li>Analyze detailed income and poverty measures at monthly
frequency</li>
</ol>
<hr>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://antrologos.github.io/PNADCperiods/">PNADCperiods</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org" class="external-link">fst</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span>      <span class="co"># Read IBGE deflator Excel files</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/meirelesff/deflatebr/" class="external-link">deflateBR</a></span><span class="op">)</span>   <span class="co"># INPC deflator</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span></code></pre></div>
<p>You also need:</p>
<ul>
<li>
<strong>Quarterly PNADC data</strong> (2015-2024) in
<code>.fst</code> format for creating the mensalization crosswalk</li>
<li>
<strong>Annual PNADC data</strong> (2015-2024) in <code>.fst</code>
format with income supplement variables</li>
<li>
<strong>Deflator file</strong> from IBGE documentation
(<code>deflator_pnadc_2024.xls</code>)</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="complete-workflow">Complete Workflow<a class="anchor" aria-label="anchor" href="#complete-workflow"></a>
</h2>
<div class="section level3">
<h3 id="step-1-create-mensalization-crosswalk">Step 1: Create Mensalization Crosswalk<a class="anchor" aria-label="anchor" href="#step-1-create-mensalization-crosswalk"></a>
</h3>
<p>Load stacked quarterly PNADC data and run the mensalization
algorithm. See the <a href="download-and-prepare.html">Download and
Prepare Data</a> vignette for details on obtaining and formatting PNADC
microdata.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define paths</span></span>
<span><span class="va">pnad_quarterly_dir</span> <span class="op">&lt;-</span> <span class="st">"path/to/quarterly/data"</span></span>
<span></span>
<span><span class="co"># List quarterly files (2015-2024)</span></span>
<span><span class="va">quarterly_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="va">pnad_quarterly_dir</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">"pnadc_20(1[5-9]|2[0-4])-[1-4]q\\.fst$"</span>,</span>
<span>  full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Variables needed for mensalization</span></span>
<span><span class="va">quarterly_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Ano"</span>, <span class="st">"Trimestre"</span>, <span class="st">"UPA"</span>, <span class="st">"V1008"</span>, <span class="st">"V1014"</span>,</span>
<span>  <span class="st">"V2008"</span>, <span class="st">"V20081"</span>, <span class="st">"V20082"</span>, <span class="st">"V2009"</span>,</span>
<span>  <span class="st">"V1028"</span>, <span class="st">"UF"</span>, <span class="st">"posest"</span>, <span class="st">"posest_sxi"</span>, <span class="st">"Estrato"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and stack quarterly data</span></span>
<span><span class="va">quarterly_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">quarterly_files</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">read_fst</a></span><span class="op">(</span><span class="va">f</span>, as.data.table <span class="op">=</span> <span class="cn">TRUE</span>, columns <span class="op">=</span> <span class="va">quarterly_vars</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build the crosswalk (identifies reference periods)</span></span>
<span><span class="va">crosswalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_identify_periods.html">pnadc_identify_periods</a></span><span class="op">(</span></span>
<span>  <span class="va">quarterly_data</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check determination rate (expect ~96% with 40 quarters of data)</span></span>
<span><span class="va">crosswalk</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">determined_month</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-load-annual-pnadc-data">Step 2: Load Annual PNADC Data<a class="anchor" aria-label="anchor" href="#step-2-load-annual-pnadc-data"></a>
</h3>
<p>Annual PNADC files follow a specific naming convention. Note that
2020-2021 use visit 5 (due to COVID-related field disruptions), while
other years use visit 1:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pnad_annual_dir</span> <span class="op">&lt;-</span> <span class="st">"path/to/annual/data"</span></span>
<span></span>
<span><span class="co"># Define which visit to use for each year</span></span>
<span><span class="va">visit_selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  ano <span class="op">=</span> <span class="fl">2015</span><span class="op">:</span><span class="fl">2024</span>,</span>
<span>  visita <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>  <span class="co"># 2020-2021 use visit 5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Why Visit 5 for 2020-2021?</strong></p>
<p>During COVID-19, IBGE suspended in-person data collection. Visit 1
interviews for 2020-2021 have significant quality issues or are
unavailable entirely. Visit 5 interviews were conducted later under
improved conditions and are the standard choice for COVID-era income and
poverty analysis.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build file paths</span></span>
<span><span class="va">annual_files</span> <span class="op">&lt;-</span> <span class="va">visit_selection</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pnad_annual_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"pnadc_%d_visita%d.fst"</span>, <span class="va">ano</span>, <span class="va">visita</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">ano</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Variables to load</span></span>
<span><span class="va">annual_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># Join keys</span></span>
<span>  <span class="st">"ano"</span>, <span class="st">"trimestre"</span>, <span class="st">"upa"</span>, <span class="st">"v1008"</span>, <span class="st">"v1014"</span>,</span>
<span>  <span class="co"># Demographics</span></span>
<span>  <span class="st">"v2005"</span>, <span class="st">"v2007"</span>, <span class="st">"v2009"</span>, <span class="st">"v2010"</span>, <span class="st">"uf"</span>, <span class="st">"estrato"</span>,</span>
<span>  <span class="co"># Weights and calibration</span></span>
<span>  <span class="st">"v1032"</span>, <span class="st">"posest"</span>, <span class="st">"posest_sxi"</span>,</span>
<span>  <span class="co"># Household per capita income (IBGE pre-calculated)</span></span>
<span>  <span class="st">"vd5008"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and stack annual data</span></span>
<span><span class="va">annual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">annual_files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>, <span class="va">file</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">read_fst</a></span><span class="op">(</span><span class="va">f</span>, as.data.table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">cols_present</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">annual_vars</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">dt</span><span class="op">[</span>, <span class="va">..cols_present</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2b-standardize-column-names">Step 2b: Standardize Column Names<a class="anchor" aria-label="anchor" href="#step-2b-standardize-column-names"></a>
</h3>
<p>The annual data has lowercase column names, but
<code><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods()</a></code> requires specific casing for the join
keys. Standardize before applying the crosswalk:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pnadc_apply_periods() expects uppercase join keys</span></span>
<span><span class="va">key_mappings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"ano"</span> <span class="op">=</span> <span class="st">"Ano"</span>, <span class="st">"trimestre"</span> <span class="op">=</span> <span class="st">"Trimestre"</span>,</span>
<span>  <span class="st">"upa"</span> <span class="op">=</span> <span class="st">"UPA"</span>, <span class="st">"v1008"</span> <span class="op">=</span> <span class="st">"V1008"</span>, <span class="st">"v1014"</span> <span class="op">=</span> <span class="st">"V1014"</span>,</span>
<span>  <span class="st">"v1032"</span> <span class="op">=</span> <span class="st">"V1032"</span>, <span class="st">"uf"</span> <span class="op">=</span> <span class="st">"UF"</span>, <span class="st">"v2009"</span> <span class="op">=</span> <span class="st">"V2009"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">old_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">key_mappings</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">old_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">annual_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">annual_data</span>, <span class="va">old_name</span>, <span class="va">key_mappings</span><span class="op">[[</span><span class="va">old_name</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> The calibration columns <code>posest</code>
and <code>posest_sxi</code> stay lowercase—the package expects them in
that case. Only the join keys (<code>Ano</code>, <code>Trimestre</code>,
<code>UPA</code>, <code>V1008</code>, <code>V1014</code>) and weight
column (<code>V1032</code>) need uppercase.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="step-3-apply-crosswalk-and-calibrate-weights">Step 3: Apply Crosswalk and Calibrate Weights<a class="anchor" aria-label="anchor" href="#step-3-apply-crosswalk-and-calibrate-weights"></a>
</h3>
<p>Apply the crosswalk to annual data and calibrate weights using
<code><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods()</a></code>. The function handles the merge
internally using the five join keys (<code>Ano</code>,
<code>Trimestre</code>, <code>UPA</code>, <code>V1008</code>,
<code>V1014</code>):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span></span>
<span>  <span class="va">annual_data</span>,</span>
<span>  <span class="va">crosswalk</span>,</span>
<span>  weight_var <span class="op">=</span> <span class="st">"V1032"</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  calibrate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  calibration_unit <span class="op">=</span> <span class="st">"month"</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check match rate (expect ~97% with year anchor)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">ref_month_in_quarter</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Why <code>anchor = "year"</code>?</strong> Annual PNADC data
contains only one visit per household (e.g., visit 1 or visit 5), not
all rotation groups like quarterly data. The <code>"year"</code> anchor
calibrates the annual weight <code>V1032</code> to monthly SIDRA
population totals while preserving yearly totals.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="step-4-construct-per-capita-income">Step 4: Construct Per Capita Income<a class="anchor" aria-label="anchor" href="#step-4-construct-per-capita-income"></a>
</h3>
<p>Use IBGE’s pre-calculated household per capita income variable:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to household members only</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="va">v2005</span> <span class="op">&lt;=</span> <span class="fl">14</span> <span class="op">|</span> <span class="va">v2005</span> <span class="op">==</span> <span class="fl">16</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Use IBGE's pre-calculated per capita household income</span></span>
<span><span class="va">d</span><span class="op">[</span>, <span class="va">hhinc_pc_nominal</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vd5008</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">vd5008</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-5-apply-deflation">Step 5: Apply Deflation<a class="anchor" aria-label="anchor" href="#step-5-apply-deflation"></a>
</h3>
<p>Convert nominal income to real values using IBGE deflators:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load deflator data (from IBGE documentation)</span></span>
<span><span class="va">deflator</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"path/to/deflator_pnadc_2024.xls"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">deflator</span><span class="op">)</span></span>
<span><span class="va">deflator</span> <span class="op">&lt;-</span> <span class="va">deflator</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>Ano <span class="op">=</span> <span class="va">ano</span>, Trimestre <span class="op">=</span> <span class="va">trim</span>, UF <span class="op">=</span> <span class="va">uf</span>, <span class="va">CO2</span>, <span class="va">CO2e</span>, <span class="va">CO3</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Merge deflators with data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">deflator</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ano"</span>, <span class="st">"Trimestre"</span>, <span class="st">"UF"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ano"</span>, <span class="st">"Trimestre"</span>, <span class="st">"UF"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">deflator</span><span class="op">[</span><span class="va">d</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># INPC adjustment factor to reference date (December 2025)</span></span>
<span><span class="va">inpc_factor</span> <span class="op">&lt;-</span> <span class="fu">deflateBR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deflateBR/man/inpc.html" class="external-link">inpc</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>                               nominal_dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-07-01"</span><span class="op">)</span>,</span>
<span>                               real_date <span class="op">=</span> <span class="st">"12/2025"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply deflation</span></span>
<span><span class="va">d</span><span class="op">[</span>, <span class="va">hhinc_pc</span> <span class="op">:=</span> <span class="va">hhinc_pc_nominal</span> <span class="op">*</span> <span class="va">CO2</span> <span class="op">*</span> <span class="va">inpc_factor</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-6-define-poverty-line">Step 6: Define Poverty Line<a class="anchor" aria-label="anchor" href="#step-6-define-poverty-line"></a>
</h3>
<p>Calculate the World Bank PPP-based poverty threshold:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># World Bank poverty line: USD 8.30 PPP per day (upper-middle income threshold)</span></span>
<span><span class="va">poverty_line_830_ppp_daily</span> <span class="op">&lt;-</span> <span class="fl">8.30</span></span>
<span></span>
<span><span class="co"># 2021 PPP conversion factor (World Bank)</span></span>
<span><span class="co"># https://data.worldbank.org/indicator/PA.NUS.PRVT.PP?year=2021</span></span>
<span><span class="va">usd_to_brl_ppp</span> <span class="op">&lt;-</span> <span class="fl">2.45</span></span>
<span><span class="va">days_to_month</span> <span class="op">&lt;-</span> <span class="fl">365</span><span class="op">/</span><span class="fl">12</span></span>
<span></span>
<span><span class="co"># Monthly value in 2021 BRL</span></span>
<span><span class="va">poverty_line_830_brl_monthly_2021</span> <span class="op">&lt;-</span> <span class="va">poverty_line_830_ppp_daily</span> <span class="op">*</span></span>
<span>                                     <span class="va">usd_to_brl_ppp</span> <span class="op">*</span> <span class="va">days_to_month</span></span>
<span></span>
<span><span class="co"># Deflate to December 2025 reference</span></span>
<span><span class="va">poverty_line_830_brl_monthly_2025</span> <span class="op">&lt;-</span> <span class="fu">deflateBR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deflateBR/man/inpc.html" class="external-link">inpc</a></span><span class="op">(</span></span>
<span>  <span class="va">poverty_line_830_brl_monthly_2021</span>,</span>
<span>  nominal_dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-01"</span><span class="op">)</span>,</span>
<span>  real_date <span class="op">=</span> <span class="st">"12/2025"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span><span class="op">[</span>, <span class="va">poverty_line</span> <span class="op">:=</span> <span class="va">poverty_line_830_brl_monthly_2025</span><span class="op">]</span></span></code></pre></div>
<blockquote>
<p><strong>Why USD 8.30/day?</strong> This is the World Bank’s
upper-middle income poverty threshold, appropriate for Brazil. We use
the 2021 PPP conversion factor (2.45 BRL per USD) because 2021 is the
World Bank’s reference year for the current poverty lines.</p>
</blockquote>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="analysis-examples">Analysis Examples<a class="anchor" aria-label="anchor" href="#analysis-examples"></a>
</h2>
<div class="section level3">
<h3 id="helper-functions">Helper Functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h3>
<p>Before computing poverty measures, we define the FGT family of
poverty indices:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># FGT poverty measure family (Foster-Greer-Thorbecke)</span></span>
<span><span class="co"># alpha = 0: Headcount ratio (share below line)</span></span>
<span><span class="co"># alpha = 1: Poverty gap (average shortfall)</span></span>
<span><span class="co"># alpha = 2: Squared poverty gap (sensitive to inequality among poor)</span></span>
<span><span class="va">fgt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span>, <span class="va">w</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span><span class="op">)</span> <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">z</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span>, <span class="va">w</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>; <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>; <span class="va">w</span> <span class="op">&lt;-</span> <span class="va">w</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">(</span><span class="va">z</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="va">z</span><span class="op">)</span></span>
<span>  <span class="va">fgt_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="va">z</span>, <span class="va">g</span><span class="op">^</span><span class="va">alpha</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span> <span class="op">*</span> <span class="va">fgt_val</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-1-monthly-fgt-poverty-measures">Example 1: Monthly FGT Poverty Measures<a class="anchor" aria-label="anchor" href="#example-1-monthly-fgt-poverty-measures"></a>
</h3>
<p>Calculate monthly poverty rates using the FGT family:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to determined observations</span></span>
<span><span class="va">d_monthly</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ref_month_yyyymm</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Use calibrated monthly weight (from pnadc_apply_periods())</span></span>
<span><span class="va">d_monthly</span><span class="op">[</span>, <span class="va">peso</span> <span class="op">:=</span> <span class="va">weight_monthly</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Compute monthly poverty statistics</span></span>
<span><span class="va">monthly_poverty</span> <span class="op">&lt;-</span> <span class="va">d_monthly</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  <span class="co"># FGT-0 (Headcount ratio)</span></span>
<span>  poverty_rate <span class="op">=</span> <span class="fu">fgt</span><span class="op">(</span><span class="va">hhinc_pc</span>, <span class="va">poverty_line</span>, <span class="va">peso</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># FGT-1 (Poverty gap)</span></span>
<span>  poverty_gap <span class="op">=</span> <span class="fu">fgt</span><span class="op">(</span><span class="va">hhinc_pc</span>, <span class="va">poverty_line</span>, <span class="va">peso</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># Mean income</span></span>
<span>  mean_income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">hhinc_pc</span>, <span class="va">peso</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># Sample size</span></span>
<span>  n_obs <span class="op">=</span> <span class="va">.N</span></span>
<span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">ref_month_yyyymm</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Add date for plotting</span></span>
<span><span class="va">monthly_poverty</span><span class="op">[</span>, <span class="va">period</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="va">ref_month_yyyymm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">100</span>, <span class="st">"-"</span>,</span>
<span>  <span class="va">ref_month_yyyymm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">100</span>, <span class="st">"-15"</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<details><summary>
Show plotting code
</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare data for plotting</span></span>
<span><span class="va">fgt_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span>
<span>  <span class="va">monthly_poverty</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">period</span>,</span>
<span>                      `PPP 8.30/day` <span class="op">=</span> <span class="va">poverty_rate</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  id.vars <span class="op">=</span> <span class="st">"period"</span>,</span>
<span>  variable.name <span class="op">=</span> <span class="st">"poverty_line"</span>,</span>
<span>  value.name <span class="op">=</span> <span class="st">"rate"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fgt_gap_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span>
<span>  <span class="va">monthly_poverty</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">period</span>,</span>
<span>                      `PPP 8.30/day` <span class="op">=</span> <span class="va">poverty_gap</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  id.vars <span class="op">=</span> <span class="st">"period"</span>,</span>
<span>  variable.name <span class="op">=</span> <span class="st">"poverty_line"</span>,</span>
<span>  value.name <span class="op">=</span> <span class="st">"gap"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Panel A: Headcount ratio (FGT-0)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fgt_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">period</span>, y <span class="op">=</span> <span class="va">rate</span>, color <span class="op">=</span> <span class="va">poverty_line</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 year"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PPP 8.30/day"</span> <span class="op">=</span> <span class="st">"#b2182b"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A. Poverty Headcount (FGT-0)"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Share of population below poverty line"</span>,</span>
<span>       x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Poverty Rate"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Poverty Line"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Panel B: Poverty gap (FGT-1)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fgt_gap_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">period</span>, y <span class="op">=</span> <span class="va">gap</span>, color <span class="op">=</span> <span class="va">poverty_line</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 year"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PPP 8.30/day"</span> <span class="op">=</span> <span class="st">"#ef8a62"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B. Relative Poverty Gap (FGT-1)"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Average shortfall as share of poverty line"</span>,</span>
<span>       x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Relative Poverty Gap"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Poverty Line"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine panels</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">fig_fgt</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Monthly Poverty Measures: Brazil, 2015-2024"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Source: PNADC/IBGE. Annual data with monthly reference periods from PNADCperiods."</span>,</span>
<span>    theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>      plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">fig_fgt</span></span></code></pre></div>
</details><div class="float">
<img src="figures/annual-poverty-analysis/fig-fgt-monthly-series.png" style="width:100.0%" alt="Monthly Poverty Measures: Brazil, 2015-2024"><div class="figcaption">Monthly Poverty Measures: Brazil,
2015-2024</div>
</div>
<p>The figure reveals several key dynamics:</p>
<ol style="list-style-type: decimal">
<li><p><strong>COVID-19 spike (March-April 2020)</strong>: The poverty
rate shows a sharp increase in early 2020.</p></li>
<li><p><strong>Auxilio Emergencial effect (May-December 2020)</strong>:
Emergency cash transfers dramatically reduced poverty below pre-pandemic
levels.</p></li>
<li><p><strong>Post-Auxilio adjustment (2021)</strong>: As emergency aid
was reduced, poverty rates partially rebounded.</p></li>
</ol>
<p>For proper inference with confidence intervals, use complex survey
design with monthly weights—see the <a href="complex-survey-design.html">Complex Survey Design</a>
vignette.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<table class="table">
<colgroup>
<col width="25%">
<col width="36%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th>Insight</th>
<th>Annual Data</th>
<th>Monthly Data</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>COVID poverty spike</strong></td>
<td>Averaged across year</td>
<td>Visible March-April 2020</td>
</tr>
<tr class="even">
<td><strong>Auxilio timing</strong></td>
<td>Effect blurred</td>
<td>Clear May 2020 onset</td>
</tr>
<tr class="odd">
<td><strong>Recovery dynamics</strong></td>
<td>Single 2021 estimate</td>
<td>Monthly trajectory</td>
</tr>
<tr class="even">
<td><strong>Seasonal patterns</strong></td>
<td>Invisible</td>
<td>December income spikes</td>
</tr>
</tbody>
</table>
<p><strong>Limitations</strong>: ~3% sample loss from undetermined
reference months; annual PNADC is released with 18+ month delay; monthly
estimates have wider confidence intervals than annual.</p>
<hr>
</div>
<div class="section level2">
<h2 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ul>
<li>
<a href="getting-started.html">Get Started</a> - Basic mensalization
workflow</li>
<li>
<a href="how-it-works.html">How It Works</a> - Algorithm
details</li>
<li>
<a href="complex-survey-design.html">Complex Survey Design</a> -
Variance estimation</li>
<li>
<a href="applied-examples.html">Applied Examples</a> - Unemployment
and minimum wage examples</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>HECKSHER, Marcos. “Valor Impreciso por Mes Exato: Microdados e
Indicadores Mensais Baseados na Pnad Continua”. IPEA - Nota Tecnica
Disoc, n. 62. Brasilia, DF: IPEA, 2020. <a href="https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&amp;view=article&amp;id=35453" class="external-link uri">https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&amp;view=article&amp;id=35453</a>
</li>
<li>HECKSHER, M. “Cinco meses de perdas de empregos e simulacao de um
incentivo a contratacoes”. IPEA - Nota Tecnica Disoc, n. 87. Brasilia,
DF: IPEA, 2020.</li>
<li>HECKSHER, Marcos. “Mercado de trabalho: A queda da segunda quinzena
de marco, aprofundada em abril”. IPEA - Carta de Conjuntura, v. 47,
p. 1-6, 2020.</li>
<li>NERI, Marcelo; HECKSHER, Marcos. “A Montanha-Russa da Pobreza”. FGV
Social - Sumario Executivo. Rio de Janeiro: FGV, Junho/2022. <a href="https://www.cps.fgv.br/cps/bd/docs/MontanhaRussaDaPobreza_Neri_Hecksher_FGV_Social.pdf" class="external-link uri">https://www.cps.fgv.br/cps/bd/docs/MontanhaRussaDaPobreza_Neri_Hecksher_FGV_Social.pdf</a>
</li>
<li>NERI, Marcelo; HECKSHER, Marcos. “A montanha-russa da pobreza mensal
e um programa social alternativo”. <em>Revista NECAT</em>, v. 11, n. 21,
2022.</li>
<li>IBGE. Pesquisa Nacional por Amostra de Domicilios Continua (PNADC).
<a href="https://www.ibge.gov.br/estatisticas/sociais/trabalho/" class="external-link uri">https://www.ibge.gov.br/estatisticas/sociais/trabalho/</a>
</li>
<li>World Bank. Poverty and Shared Prosperity Reports. Various
years.</li>
<li>Foster, J., Greer, J., &amp; Thorbecke, E. (1984). A class of
decomposable poverty measures. <em>Econometrica</em>, 52(3),
761-766.</li>
<li>Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify
Reference Periods in Brazil’s PNADC Survey Data. R package version
v0.1.0. <a href="https://github.com/antrologos/PNADCperiods" class="external-link uri">https://github.com/antrologos/PNADCperiods</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0002-6796-4547" class="external-link">Rogerio Barbosa</a>, <a href="https://orcid.org/0000-0003-2992-1252" class="external-link">Marcos Hecksher</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
