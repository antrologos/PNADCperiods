[{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":null,"dir":"","previous_headings":"","what":"PNADCperiods - Architecture Documentation","title":"PNADCperiods - Architecture Documentation","text":"document describes implemented architecture PNADCperiods package.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"package-overview","dir":"","previous_headings":"","what":"Package Overview","title":"PNADCperiods - Architecture Documentation","text":"Package name: PNADCperiods Purpose: Identify reference periods (months, fortnights, weeks) Brazil’s PNADC survey data calibrate weights sub-quarterly analysis.","code":""},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"nested-identification-strategy","dir":"","previous_headings":"","what":"Nested Identification Strategy","title":"PNADCperiods - Architecture Documentation","text":"package uses nested identification hierarchy: Key principle: finer period can determined parent period determined. nesting ensures logical consistency: know week without knowing fortnight, know fortnight without knowing month.","code":"Month → Fortnight → Week"},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"crosswalk-structure","dir":"","previous_headings":"","what":"Crosswalk Structure","title":"PNADCperiods - Architecture Documentation","text":"crosswalk data.table household-quarter level: Join keys: Ano, Trimestre, UPA, V1008, V1014 store_date_bounds = TRUE, additional columns include date bounds debugging variables (see function documentation).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"determination-rates","dir":"","previous_headings":"","what":"Determination Rates","title":"PNADCperiods - Architecture Documentation","text":"Strict algorithm (full series 2012-2025): smaller datasets, rates may differ (e.g., 8 quarters 2019-2020: ~94% month). Experimental strategies (probabilistic + UPA aggregation) improve upon rates. Key insight: month identification benefits stacking data across quarters. Fortnights weeks determined solely birthday constraints within single quarter, require parent period determined first.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"file-structure","dir":"","previous_headings":"","what":"File Structure","title":"PNADCperiods - Architecture Documentation","text":"","code":"R/ ├── pnadc-identify-periods.R         # pnadc_identify_periods() - nested 4-phase algorithm ├── pnadc-apply-periods.R            # pnadc_apply_periods() - adaptive calibration + smoothing ├── pnadc-experimental-periods.R     # pnadc_experimental_periods() - probabilistic/UPA strategies ├── fetch-sidra-population.R         # fetch_monthly_population() - SIDRA population API ├── fetch-sidra-series.R             # fetch_sidra_rolling_quarters() + unified SIDRA cache ├── mensalize-sidra-series.R         # mensalize_sidra_series() - rolling quarters → monthly ├── sidra-series-metadata.R          # get_sidra_series_metadata() - 86+ series definitions ├── data-starting-points.R           # compute_*() functions + pnadc_series_starting_points dataset ├── utils-dates.R                    # Fast IBGE date utilities (lookup tables, week/fortnight functions) ├── utils-validation.R               # validate_pnadc() + internal helpers └── PNADCperiods-package.R           # Package docs + globalVariables"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"phase-1-month-identification-high-rate","dir":"","previous_headings":"Algorithm Details","what":"Phase 1: Month Identification (High Rate)","title":"PNADCperiods - Architecture Documentation","text":"Calculate valid interview Saturdays using IBGE “Parada Técnica” rules Apply birthday constraints narrow date range per person Convert dates month positions (1, 2, 3 quarter) Aggregate UPA-V1014 level ACROSS QUARTERS (key optimization) Dynamic exception detection edge cases (relaxed Saturday rules) Determine: min_position == max_position → determined","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"phase-2-fortnight-identification-nested-low-rate","dir":"","previous_headings":"Algorithm Details","what":"Phase 2: Fortnight Identification (Nested, Low Rate)","title":"PNADCperiods - Architecture Documentation","text":"Precondition: processes observations determined_month = TRUE Month 1 → fortnights 1-2 Month 2 → fortnights 3-4 Month 3 → fortnights 5-6 Apply birthday constraints within constrained range Aggregate household level (Ano, Trimestre, UPA, V1008) WITHIN QUARTER Dynamic exception detection Determine: min_position == max_position → determined","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"phase-3-week-identification-nested-low-rate","dir":"","previous_headings":"Algorithm Details","what":"Phase 3: Week Identification (Nested, Low Rate)","title":"PNADCperiods - Architecture Documentation","text":"Precondition: processes observations determined_fortnight = TRUE Constrain week search within identified fortnight Apply birthday constraints within constrained range Aggregate household level (Ano, Trimestre, UPA, V1008) WITHIN QUARTER Dynamic exception detection Rule 3.1: Quarter boundary stops → assign week 12 (last week quarter) Rule 3.2: Within-quarter stops → use household consensus available Rule 3.3: Fallback → first valid week technical stop Determine: min_position == max_position → determined","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"phase-4-build-crosswalk","dir":"","previous_headings":"Algorithm Details","what":"Phase 4: Build Crosswalk","title":"PNADCperiods - Architecture Documentation","text":"Combines results phases final crosswalk data.table : - IBGE period boundaries (start/end dates Sunday-Saturday) - Position codes (in_quarter) - YYYYMM/YYYYFF/YYYYWW integer codes - Determination flags","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"experimental-strategies","dir":"","previous_headings":"","what":"Experimental Strategies","title":"PNADCperiods - Architecture Documentation","text":"pnadc_experimental_periods() function provides three strategies improving determination rates beyond strict algorithm: strategies enforce proper nesting: experimental fortnights require identified months (strict experimental), experimental weeks require identified fortnights (strict experimental).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"strategy-details","dir":"","previous_headings":"Experimental Strategies","what":"Strategy Details","title":"PNADCperiods - Architecture Documentation","text":"Probabilistic: Calculates confidence proportion date interval falling within assigned period. assigns confidence >= threshold (default 0.9). Implements dynamic exception detection strict algorithm. UPA Aggregation: Uses UPA-V1014 level months (panel design), UPA level fortnights/weeks (households UPA interviewed period within quarter). Requires proportion >= threshold (default 0.5). : Strategies operate independently - probabilistic captures narrow ranges, UPA aggregation extends based strict consensus. Result union .","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"output-columns","dir":"","previous_headings":"Experimental Strategies","what":"Output Columns","title":"PNADCperiods - Architecture Documentation","text":"Output directly compatible pnadc_apply_periods():","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"calibration-pipeline","dir":"","previous_headings":"","what":"Calibration Pipeline","title":"PNADCperiods - Architecture Documentation","text":"pnadc_apply_periods(..., calibrate = TRUE): Join data crosswalk Fetch population targets SIDRA (use provided targets) Create hierarchical calibration cells (auto-selected based period) Iterative reweighting within anchor period (quarter year) Calibrate external population totals (FULL Brazilian population) Apply smoothing (period-specific)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"period-specific-calibration-settings","dir":"","previous_headings":"Calibration Pipeline","what":"Period-Specific Calibration Settings","title":"PNADCperiods - Architecture Documentation","text":"Cell levels auto-selected based calibration_unit parameter. Levels cells smaller min_cell_size skipped.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"calibration-cell-hierarchy","dir":"","previous_headings":"Calibration Pipeline","what":"Calibration Cell Hierarchy","title":"PNADCperiods - Architecture Documentation","text":"celula1: Age groups (0-13, 14-29, 30-59, 60+) celula2: Post-stratum group (posest_sxi) + age celula3: State (UF) + celula2 celula4: Post-stratum (posest) + celula2","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"anchor-types","dir":"","previous_headings":"Calibration Pipeline","what":"Anchor Types","title":"PNADCperiods - Architecture Documentation","text":"anchor = \"quarter\": Preserve quarterly totals, redistribute sub-periods (use V1028) anchor = \"year\": Preserve annual totals (annual PNADC data V1032 weights)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"output-weight-columns","dir":"","previous_headings":"Calibration Pipeline","what":"Output Weight Columns","title":"PNADCperiods - Architecture Documentation","text":"weight_monthly: Calibrated monthly weight (calibration_unit = \"month\") weight_fortnight: Calibrated fortnight weight (calibration_unit = \"fortnight\") weight_weekly: Calibrated weekly weight (calibration_unit = \"week\")","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"performance-optimizations","dir":"","previous_headings":"","what":"Performance Optimizations","title":"PNADCperiods - Architecture Documentation","text":"package optimized large datasets (~450,000 rows/sec): Lookup tables: Pre-computed date tables 20x faster date creation vs ISOdate() Integer arithmetic: ISO week calculations use pure integer math (300x faster data.table::isoweek()) data.table threading: Enabled via setDTthreads(0) package load Vectorized operations: calculations use vectorized data.table syntax Efficient joins: data.table binary joins instead merge()","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"sidra-series-mensalization-1","dir":"","previous_headings":"","what":"SIDRA Series Mensalization","title":"PNADCperiods - Architecture Documentation","text":"package provides functions convert IBGE’s rolling quarterly (trimestre móvel) aggregate series exact monthly estimates.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"mathematical-foundation","dir":"","previous_headings":"SIDRA Series Mensalization","what":"Mathematical Foundation","title":"PNADCperiods - Architecture Documentation","text":"Rolling quarters 3-month moving averages. relationship: allows recovery exact monthly values given starting points.","code":"RQ_t - RQ_{t-1} = (Month_t - Month_{t-3}) / 3"},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"algorithm-steps","dir":"","previous_headings":"SIDRA Series Mensalization","what":"Algorithm Steps","title":"PNADCperiods - Architecture Documentation","text":"Fetch rolling quarters SIDRA API Calculate d3 = 3 × (RQ_t - RQ_{t-1}) Separate d3 month position quarter (mesnotrim 1, 2, 3) Cumulate separately: cum1, cum2, cum3 Apply starting points: y = y0 + cum Final adjustment rolling quarter consistency","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"starting-points","dir":"","previous_headings":"SIDRA Series Mensalization","what":"Starting Points","title":"PNADCperiods - Architecture Documentation","text":"Pre-computed 53 series 2013-2019 microdata Bundled pnadc_series_starting_points dataset Users can compute custom starting points via compute_starting_points_from_microdata()","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"available-series","dir":"","previous_headings":"SIDRA Series Mensalization","what":"Available Series","title":"PNADCperiods - Architecture Documentation","text":"86+ series across themes: - labor_market: Employment, unemployment, participation rates - earnings: Wages, income category - demographics: Population components - social_protection: Pension coverage - prices: Deflated series","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"caching","dir":"","previous_headings":"SIDRA Series Mensalization","what":"Caching","title":"PNADCperiods - Architecture Documentation","text":"Unified cache infrastructure optional expiration: - Rolling quarters population data cached .sidra_cache environment - clear_sidra_cache() force fresh download","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"dependencies","dir":"","previous_headings":"","what":"Dependencies","title":"PNADCperiods - Architecture Documentation","text":"Required: - data.table (>= 1.14.0) - Core data manipulation - checkmate (>= 2.0.0) - Input validation - sidrar (>= 0.2.9) - SIDRA API access population series data - lubridate (>= 1.9.4) - Date/time utilities Suggested: - dplyr - Alternative data manipulation - haven - Read SAS/SPSS/Stata files - testthat (>= 3.0.0) - Testing - knitr, rmarkdown - Vignettes - pkgdown - Website - ggplot2, scales - Visualization","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"standard-monthly-analysis","dir":"","previous_headings":"Workflow Examples","what":"Standard Monthly Analysis","title":"PNADCperiods - Architecture Documentation","text":"","code":"# Build crosswalk from stacked multi-year data (maximizes determination rate) crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply to specific quarter with calibration result <- pnadc_apply_periods(pnadc_2023, crosswalk,                               weight_var = \"V1028\",                               anchor = \"quarter\")"},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"annual-data","dir":"","previous_headings":"Workflow Examples","what":"Annual Data","title":"PNADCperiods - Architecture Documentation","text":"","code":"result <- pnadc_apply_periods(pnadc_annual, crosswalk,                               weight_var = \"V1032\",                               anchor = \"year\")"},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"crosswalk-only-no-calibration","dir":"","previous_headings":"Workflow Examples","what":"Crosswalk Only (No Calibration)","title":"PNADCperiods - Architecture Documentation","text":"","code":"result <- pnadc_apply_periods(pnadc_2023, crosswalk,                               calibrate = FALSE)"},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"experimental-period-assignment","dir":"","previous_headings":"Workflow Examples","what":"Experimental Period Assignment","title":"PNADCperiods - Architecture Documentation","text":"","code":"# Build standard crosswalk (with date bounds for probabilistic strategy) crosswalk <- pnadc_identify_periods(pnadc_data, store_date_bounds = TRUE)  # Apply experimental strategies for additional assignments crosswalk_exp <- pnadc_experimental_periods(   crosswalk,   strategy = \"both\",  # probabilistic + UPA aggregation   confidence_threshold = 0.9,   upa_proportion_threshold = 0.5 )  # Use directly with calibration result <- pnadc_apply_periods(pnadc_data, crosswalk_exp,                               weight_var = \"V1028\",                               anchor = \"quarter\")  # Filter to strict-only if needed strict_only <- crosswalk_exp[probabilistic_assignment == FALSE | is.na(probabilistic_assignment)]"},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"sidra-series-mensalization-2","dir":"","previous_headings":"Workflow Examples","what":"SIDRA Series Mensalization","title":"PNADCperiods - Architecture Documentation","text":"","code":"# Fetch rolling quarterly data from SIDRA rolling <- fetch_sidra_rolling_quarters(theme = \"labor_market\")  # Convert to exact monthly estimates monthly <- mensalize_sidra_series(rolling)  # View available series get_sidra_series_metadata(theme = \"labor_market\")"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"for-period-identification","dir":"","previous_headings":"Required PNADC Variables","what":"For Period Identification","title":"PNADCperiods - Architecture Documentation","text":"Ano - Survey year Trimestre - Quarter (1-4) UPA - Primary sampling unit V1008 - Household sequence number V1014 - Panel group (1-8) V2008 - Birth day (1-31, 99=unknown) V20081 - Birth month (1-12, 99=unknown) V20082 - Birth year V2009 - Age","code":""},{"path":"https://antrologos.github.io/PNADCperiods/ARCHITECTURE_PLAN.html","id":"for-weight-calibration-additional","dir":"","previous_headings":"Required PNADC Variables","what":"For Weight Calibration (additional)","title":"PNADCperiods - Architecture Documentation","text":"V1028 - Quarterly weight (quarterly data) V1032 - Annual weight (annual data) UF - State code posest - Post-stratum posest_sxi - Post-stratum group","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"exactly poverty spike COVID-19? Official annual statistics tell us 2020 difficult year—can’t tell us whether crisis peaked April June, whether Auxilio Emergencial reduced poverty immediately delay, month--month recovery path looked like. Monthly data can. vignette combines mensalization algorithm annual PNADC data produce monthly poverty statistics. annual PNADC releases contain comprehensive household income measures (VD5008) aren’t available quarterly releases. applying mensalization crosswalk (built quarterly data) annual income data, get monthly temporal precision comprehensive income measurement. IBGE’s PNADC uses rotating panel design households appear quarterly annual data. workflow : Build crosswalk quarterly data using pnadc_identify_periods() Apply crosswalk annual income data pnadc_apply_periods() (handles merge internally calibrates weights) Analyze detailed income poverty measures monthly frequency","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"prerequisites","dir":"Articles","previous_headings":"","what":"Prerequisites","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"also need: Quarterly PNADC data (2015-2024) .fst format creating mensalization crosswalk Annual PNADC data (2015-2024) .fst format income supplement variables Deflator file IBGE documentation (deflator_pnadc_2024.xls)","code":"library(PNADCperiods) library(data.table) library(fst) library(readxl)      # Read IBGE deflator Excel files library(deflateBR)   # INPC deflator library(ggplot2) library(scales)"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"step-1-create-mensalization-crosswalk","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 1: Create Mensalization Crosswalk","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Load stacked quarterly PNADC data run mensalization algorithm. See Download Prepare Data vignette details obtaining formatting PNADC microdata.","code":"# Define paths pnad_quarterly_dir <- \"path/to/quarterly/data\"  # List quarterly files (2015-2024) quarterly_files <- list.files(   path = pnad_quarterly_dir,   pattern = \"pnadc_20(1[5-9]|2[0-4])-[1-4]q\\\\.fst$\",   full.names = TRUE )  # Variables needed for mensalization quarterly_vars <- c(   \"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\",   \"V2008\", \"V20081\", \"V20082\", \"V2009\",   \"V1028\", \"UF\", \"posest\", \"posest_sxi\", \"Estrato\" )  # Load and stack quarterly data quarterly_data <- rbindlist(   lapply(quarterly_files, function(f) {     read_fst(f, as.data.table = TRUE, columns = quarterly_vars)   }),   fill = TRUE )  # Build the crosswalk (identifies reference periods) crosswalk <- pnadc_identify_periods(   quarterly_data,   verbose = TRUE )  # Check determination rate (expect ~96% with 40 quarters of data) crosswalk[, mean(determined_month, na.rm = TRUE)]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"step-2-load-annual-pnadc-data","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 2: Load Annual PNADC Data","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Annual PNADC files follow specific naming convention. Note 2020-2021 use visit 5 (due COVID-related field disruptions), years use visit 1: Visit 5 2020-2021? COVID-19, IBGE suspended -person data collection. Visit 1 interviews 2020-2021 significant quality issues unavailable entirely. Visit 5 interviews conducted later improved conditions standard choice COVID-era income poverty analysis.","code":"pnad_annual_dir <- \"path/to/annual/data\"  # Define which visit to use for each year visit_selection <- data.table(   ano = 2015:2024,   visita = c(1, 1, 1, 1, 1, 5, 5, 1, 1, 1)  # 2020-2021 use visit 5 ) # Build file paths annual_files <- visit_selection[, .(   file = file.path(pnad_annual_dir, sprintf(\"pnadc_%d_visita%d.fst\", ano, visita)) ), by = ano]  # Variables to load annual_vars <- c(   # Join keys   \"ano\", \"trimestre\", \"upa\", \"v1008\", \"v1014\",   # Demographics   \"v2005\", \"v2007\", \"v2009\", \"v2010\", \"uf\", \"estrato\",   # Weights and calibration   \"v1032\", \"posest\", \"posest_sxi\",   # Household per capita income (IBGE pre-calculated)   \"vd5008\" )  # Load and stack annual data annual_data <- rbindlist(   lapply(annual_files[file.exists(file), file], function(f) {     dt <- read_fst(f, as.data.table = TRUE)     setnames(dt, tolower(names(dt)))     cols_present <- intersect(annual_vars, names(dt))     dt[, ..cols_present]   }),   fill = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"step-2b-standardize-column-names","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 2b: Standardize Column Names","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"annual data lowercase column names, pnadc_apply_periods() requires specific casing join keys. Standardize applying crosswalk: Note: calibration columns posest posest_sxi stay lowercase—package expects case. join keys (Ano, Trimestre, UPA, V1008, V1014) weight column (V1032) need uppercase.","code":"# pnadc_apply_periods() expects uppercase join keys key_mappings <- c(   \"ano\" = \"Ano\", \"trimestre\" = \"Trimestre\",   \"upa\" = \"UPA\", \"v1008\" = \"V1008\", \"v1014\" = \"V1014\",   \"v1032\" = \"V1032\", \"uf\" = \"UF\", \"v2009\" = \"V2009\" )  for (old_name in names(key_mappings)) {   if (old_name %in% names(annual_data)) {     setnames(annual_data, old_name, key_mappings[[old_name]])   } }"},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"step-3-apply-crosswalk-and-calibrate-weights","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 3: Apply Crosswalk and Calibrate Weights","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Apply crosswalk annual data calibrate weights using pnadc_apply_periods(). function handles merge internally using five join keys (Ano, Trimestre, UPA, V1008, V1014): anchor = \"year\"? Annual PNADC data contains one visit per household (e.g., visit 1 visit 5), rotation groups like quarterly data. \"year\" anchor calibrates annual weight V1032 monthly SIDRA population totals preserving yearly totals.","code":"d <- pnadc_apply_periods(   annual_data,   crosswalk,   weight_var = \"V1032\",   anchor = \"year\",   calibrate = TRUE,   calibration_unit = \"month\",   smooth = TRUE,   verbose = TRUE )  # Check match rate (expect ~97% with year anchor) mean(!is.na(d$ref_month_in_quarter))"},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"step-4-construct-per-capita-income","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 4: Construct Per Capita Income","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Use IBGE’s pre-calculated household per capita income variable:","code":"# Filter to household members only d <- d[v2005 <= 14 | v2005 == 16]  # Use IBGE's pre-calculated per capita household income d[, hhinc_pc_nominal := fifelse(is.na(vd5008), 0, vd5008)]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"step-5-apply-deflation","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 5: Apply Deflation","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Convert nominal income real values using IBGE deflators:","code":"# Load deflator data (from IBGE documentation) deflator <- readxl::read_excel(\"path/to/deflator_pnadc_2024.xls\") setDT(deflator) deflator <- deflator[, .(Ano = ano, Trimestre = trim, UF = uf, CO2, CO2e, CO3)]  # Merge deflators with data setkeyv(deflator, c(\"Ano\", \"Trimestre\", \"UF\")) setkeyv(d, c(\"Ano\", \"Trimestre\", \"UF\")) d <- deflator[d]  # INPC adjustment factor to reference date (December 2025) inpc_factor <- deflateBR::inpc(1,                                nominal_dates = as.Date(\"2024-07-01\"),                                real_date = \"12/2025\")  # Apply deflation d[, hhinc_pc := hhinc_pc_nominal * CO2 * inpc_factor]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"step-6-define-poverty-line","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 6: Define Poverty Line","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Calculate World Bank PPP-based poverty threshold: USD 8.30/day? World Bank’s upper-middle income poverty threshold, appropriate Brazil. use 2021 PPP conversion factor (2.45 BRL per USD) 2021 World Bank’s reference year current poverty lines.","code":"# World Bank poverty line: USD 8.30 PPP per day (upper-middle income threshold) poverty_line_830_ppp_daily <- 8.30  # 2021 PPP conversion factor (World Bank) # https://data.worldbank.org/indicator/PA.NUS.PRVT.PP?year=2021 usd_to_brl_ppp <- 2.45 days_to_month <- 365/12  # Monthly value in 2021 BRL poverty_line_830_brl_monthly_2021 <- poverty_line_830_ppp_daily *                                      usd_to_brl_ppp * days_to_month  # Deflate to December 2025 reference poverty_line_830_brl_monthly_2025 <- deflateBR::inpc(   poverty_line_830_brl_monthly_2021,   nominal_dates = as.Date(\"2021-07-01\"),   real_date = \"12/2025\" )  d[, poverty_line := poverty_line_830_brl_monthly_2025]"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"helper-functions","dir":"Articles","previous_headings":"Analysis Examples","what":"Helper Functions","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"computing poverty measures, define FGT family poverty indices:","code":"# FGT poverty measure family (Foster-Greer-Thorbecke) # alpha = 0: Headcount ratio (share below line) # alpha = 1: Poverty gap (average shortfall) # alpha = 2: Squared poverty gap (sensitive to inequality among poor) fgt <- function(x, z, w = NULL, alpha = 0) {   if (is.null(w)) w <- rep(1, length(x))   if (length(z) == 1) z <- rep(z, length(x))    idx <- complete.cases(x, z, w)   x <- x[idx]; z <- z[idx]; w <- w[idx]    g <- pmax(0, (z - x) / z)   fgt_val <- ifelse(x < z, g^alpha, 0)    sum(w * fgt_val) / sum(w) }"},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"example-1-monthly-fgt-poverty-measures","dir":"Articles","previous_headings":"Analysis Examples","what":"Example 1: Monthly FGT Poverty Measures","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Calculate monthly poverty rates using FGT family: figure reveals several key dynamics: COVID-19 spike (March-April 2020): poverty rate shows sharp increase early 2020. Auxilio Emergencial effect (May-December 2020): Emergency cash transfers dramatically reduced poverty pre-pandemic levels. Post-Auxilio adjustment (2021): emergency aid reduced, poverty rates partially rebounded. proper inference confidence intervals, use complex survey design monthly weights—see Complex Survey Design vignette.","code":"# Filter to determined observations d_monthly <- d[!is.na(ref_month_yyyymm)]  # Use calibrated monthly weight (from pnadc_apply_periods()) d_monthly[, peso := weight_monthly]  # Compute monthly poverty statistics monthly_poverty <- d_monthly[, .(   # FGT-0 (Headcount ratio)   poverty_rate = fgt(hhinc_pc, poverty_line, peso, alpha = 0),    # FGT-1 (Poverty gap)   poverty_gap = fgt(hhinc_pc, poverty_line, peso, alpha = 1),    # Mean income   mean_income = weighted.mean(hhinc_pc, peso, na.rm = TRUE),    # Sample size   n_obs = .N  ), by = ref_month_yyyymm]  # Add date for plotting monthly_poverty[, period := as.Date(paste0(   ref_month_yyyymm %/% 100, \"-\",   ref_month_yyyymm %% 100, \"-15\" ))] # Prepare data for plotting fgt_data <- melt(   monthly_poverty[, .(period,                       `PPP 8.30/day` = poverty_rate)],   id.vars = \"period\",   variable.name = \"poverty_line\",   value.name = \"rate\" )  fgt_gap_data <- melt(   monthly_poverty[, .(period,                       `PPP 8.30/day` = poverty_gap)],   id.vars = \"period\",   variable.name = \"poverty_line\",   value.name = \"gap\" )  # Panel A: Headcount ratio (FGT-0) p1 <- ggplot(fgt_data, aes(x = period, y = rate, color = poverty_line)) +   geom_line(linewidth = 0.8) +   geom_point(size = 1) +   scale_y_continuous(labels = percent_format(accuracy = 1),                      limits = c(0, NA)) +   scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +   scale_color_manual(values = c(\"PPP 8.30/day\" = \"#b2182b\")) +   labs(title = \"A. Poverty Headcount (FGT-0)\",        subtitle = \"Share of population below poverty line\",        x = NULL, y = \"Poverty Rate\",        color = \"Poverty Line\") +   theme_minimal(base_size = 11) +   theme(legend.position = \"bottom\",         panel.grid.minor = element_blank(),         plot.title = element_text(face = \"bold\"))  # Panel B: Poverty gap (FGT-1) p2 <- ggplot(fgt_gap_data, aes(x = period, y = gap, color = poverty_line)) +   geom_line(linewidth = 0.8) +   geom_point(size = 1) +   scale_y_continuous(labels = percent_format(accuracy = 0.1),                      limits = c(0, NA)) +   scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +   scale_color_manual(values = c(\"PPP 8.30/day\" = \"#ef8a62\")) +   labs(title = \"B. Relative Poverty Gap (FGT-1)\",        subtitle = \"Average shortfall as share of poverty line\",        x = NULL, y = \"Relative Poverty Gap\",        color = \"Poverty Line\") +   theme_minimal(base_size = 11) +   theme(legend.position = \"bottom\",         panel.grid.minor = element_blank(),         plot.title = element_text(face = \"bold\"))  # Combine panels library(patchwork) fig_fgt <- p1 / p2 +   plot_annotation(     title = \"Monthly Poverty Measures: Brazil, 2015-2024\",     caption = \"Source: PNADC/IBGE. Annual data with monthly reference periods from PNADCperiods.\",     theme = theme(       plot.title = element_text(face = \"bold\", size = 14),       plot.subtitle = element_text(size = 11),       plot.caption = element_text(size = 9, hjust = 0)     )   ) fig_fgt"},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"summary","dir":"Articles","previous_headings":"","what":"Summary","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Limitations: ~3% sample loss undetermined reference months; annual PNADC released 18+ month delay; monthly estimates wider confidence intervals annual.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"further-reading","dir":"Articles","previous_headings":"","what":"Further Reading","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Get Started - Basic mensalization workflow Works - Algorithm details Complex Survey Design - Variance estimation Applied Examples - Unemployment minimum wage examples","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/annual-poverty-analysis.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"HECKSHER, Marcos. “Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua”. IPEA - Nota Tecnica Disoc, n. 62. Brasilia, DF: IPEA, 2020. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453 HECKSHER, M. “Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes”. IPEA - Nota Tecnica Disoc, n. 87. Brasilia, DF: IPEA, 2020. HECKSHER, Marcos. “Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril”. IPEA - Carta de Conjuntura, v. 47, p. 1-6, 2020. NERI, Marcelo; HECKSHER, Marcos. “Montanha-Russa da Pobreza”. FGV Social - Sumario Executivo. Rio de Janeiro: FGV, Junho/2022. https://www.cps.fgv.br/cps/bd/docs/MontanhaRussaDaPobreza_Neri_Hecksher_FGV_Social.pdf NERI, Marcelo; HECKSHER, Marcos. “montanha-russa da pobreza mensal e um programa social alternativo”. Revista NECAT, v. 11, n. 21, 2022. IBGE. Pesquisa Nacional por Amostra de Domicilios Continua (PNADC). https://www.ibge.gov.br/estatisticas/sociais/trabalho/ World Bank. Poverty Shared Prosperity Reports. Various years. Foster, J., Greer, J., & Thorbecke, E. (1984). class decomposable poverty measures. Econometrica, 52(3), 761-766. Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package version v0.1.0. https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Brazil’s Continuous National Household Sample Survey (PNADC) publishes quarterly annual microdata official labor market statistics. However, quarterly statistics actually average three-month phenomena—SIDRA monthly series rolling averages, true monthly snapshots. quarterly averaging obscures timing magnitude economic shocks blurs detection turning points. PNADCperiods package solves identifying specific month interview refers , using birthday information IBGE’s interview scheduling rules. full PNADC history (2012-2025), algorithm achieves ~97% determination rate monthly identification. vignette demonstrates three cases monthly data reveals dynamics quarterly data hides, culminating powerful validation using minimum wage transitions. Working poverty income data? See Monthly Poverty Analysis Annual PNADC Data.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"prerequisites","dir":"Articles","previous_headings":"","what":"Prerequisites","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"reproduce analyses, need stacked PNADC microdata spanning multiple quarters. See Download Prepare Data data preparation, Get Started basic usage.","code":"# Load required packages library(PNADCperiods) library(data.table) library(ggplot2) library(scales)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"preparing-the-data","dir":"Articles","previous_headings":"","what":"Preparing the Data","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"section shows create aggregate time series used examples .","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"step-1-load-and-mensalize-your-data","dir":"Articles","previous_headings":"Preparing the Data","what":"Step 1: Load and Mensalize Your Data","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"","code":"# Load your stacked PNADC data (see download-and-prepare vignette) library(fst) pnadc <- read_fst(\"path/to/your/pnadc_stacked.fst\", as.data.table = TRUE)  # Build crosswalk (identify reference periods) crosswalk <- pnadc_identify_periods(pnadc, verbose = TRUE)  # Keep a clean copy for sub-monthly calibration later (Section 4) pnadc_clean <- copy(pnadc)  # Apply crosswalk with weight calibration pnadc <- pnadc_apply_periods(   pnadc,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"step-2-create-labor-market-variables","dir":"Articles","previous_headings":"Preparing the Data","what":"Step 2: Create Labor Market Variables","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"","code":"# Filter to working-age population (14+) pnadc <- pnadc[V2009 >= 14]  # Create labor market indicators pnadc[, `:=`(   # PEA: Economically Active Population (VD4001 == 1)   pea = fifelse(VD4001 == 1, 1L, 0L),    # Employed (VD4002 == 1)   employed = fifelse(VD4002 == 1, 1L, 0L),    # Unemployed (in labor force but not employed)   unemployed = fifelse(VD4002 == 2, 1L, 0L) )]  # Formality indicator (among employed) # Formal: positions 1,3,5,7 OR positions 8,9 with social security contribution pnadc[, formal := fifelse(   VD4009 %in% c(1L, 3L, 5L, 7L), 1L,   fifelse(VD4009 %in% c(8L, 9L) & VD4012 == 1L, 1L, 0L) )] pnadc[VD4002 != 1, formal := NA_integer_]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"step-3-create-quarterly-series","dir":"Articles","previous_headings":"Preparing the Data","what":"Step 3: Create Quarterly Series","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Quarterly aggregates use original IBGE weight (V1028):","code":"quarterly_total <- pnadc[, .(   unemployment_rate = sum(unemployed * V1028, na.rm = TRUE) /                       sum(pea * V1028, na.rm = TRUE),   participation_rate = sum(pea * V1028, na.rm = TRUE) /                        sum(V1028, na.rm = TRUE),   formalization_rate = sum(formal * V1028, na.rm = TRUE) /                        sum(employed * V1028, na.rm = TRUE) ), by = .(Ano, Trimestre)]  # Add period column for plotting (mid-quarter date) quarterly_total[, period := as.Date(paste0(Ano, \"-\", (Trimestre - 1) * 3 + 2, \"-15\"))]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"step-4-create-monthly-series","dir":"Articles","previous_headings":"Preparing the Data","what":"Step 4: Create Monthly Series","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Monthly aggregates use weight_monthly PNADCperiods: objects created, can now run examples .","code":"# Filter to observations with determined reference month pnadc_monthly <- pnadc[!is.na(weight_monthly)]  monthly_total <- pnadc_monthly[, .(   unemployment_rate = sum(unemployed * weight_monthly, na.rm = TRUE) /                       sum(pea * weight_monthly, na.rm = TRUE),   participation_rate = sum(pea * weight_monthly, na.rm = TRUE) /                        sum(weight_monthly, na.rm = TRUE),   formalization_rate = sum(formal * weight_monthly, na.rm = TRUE) /                        sum(employed * weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]  # Add period column for plotting (mid-month date) monthly_total[, period := as.Date(paste0(   ref_month_yyyymm %/% 100, \"-\",   ref_month_yyyymm %% 100, \"-15\" ))]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"covid-19-unemployment-the-true-peak","dir":"Articles","previous_headings":"","what":"1. COVID-19 Unemployment: The True Peak","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"COVID-19 pandemic caused sharpest labor market shock Brazilian history. Quarterly data couldn’t tell policymakers exactly crisis peaked severe truly —information critical calibrating emergency responses like unemployment benefits business support. monthly series reveals unemployment peaked roughly 2 percentage points higher quarterly data suggests, timing peak precisely identified.","code":"# Filter to COVID period (Oct 2019 - Jan 2022) covid_quarterly <- quarterly_total[period >= \"2019-10-01\" & period <= \"2022-01-01\"] covid_monthly <- monthly_total[period >= \"2019-10-01\" & period <= \"2022-01-01\"]  # Find the unemployment peaks peak_quarterly <- covid_quarterly[which.max(unemployment_rate)] peak_monthly <- covid_monthly[which.max(unemployment_rate)]  # Create the comparison plot ggplot() +   # Quarterly as step function (emphasizes moving-average nature)   geom_step(data = covid_quarterly,             aes(x = period, y = unemployment_rate),             color = \"steelblue\", linewidth = 1.2, direction = \"mid\") +   geom_point(data = covid_quarterly,              aes(x = period, y = unemployment_rate),              color = \"steelblue\", size = 3) +    # Monthly as line   geom_line(data = covid_monthly,             aes(x = period, y = unemployment_rate),             color = \"darkred\", linewidth = 0.9) +   geom_point(data = covid_monthly,              aes(x = period, y = unemployment_rate),              color = \"darkred\", size = 1.5) +    # Annotate monthly peak   annotate(\"segment\",            x = peak_monthly$period, xend = peak_monthly$period,            y = peak_monthly$unemployment_rate + 0.005,            yend = peak_monthly$unemployment_rate + 0.02,            arrow = arrow(length = unit(0.2, \"cm\")), color = \"darkred\") +   annotate(\"text\",            x = peak_monthly$period,            y = peak_monthly$unemployment_rate + 0.022,            label = paste0(\"Monthly peak: \", format(peak_monthly$period, \"%b %Y\"), \"\\n\",                          sprintf(\"%.1f%%\", peak_monthly$unemployment_rate * 100)),            size = 3.2, color = \"darkred\", hjust = 0.5) +    # Annotate quarterly peak   annotate(\"segment\",            x = peak_quarterly$period + 30, xend = peak_quarterly$period + 30,            y = peak_quarterly$unemployment_rate - 0.005,            yend = peak_quarterly$unemployment_rate - 0.02,            arrow = arrow(length = unit(0.2, \"cm\")), color = \"steelblue\") +   annotate(\"text\",            x = peak_quarterly$period + 30,            y = peak_quarterly$unemployment_rate - 0.025,            label = paste0(\"Quarterly peak: \", format(peak_quarterly$period, \"%b %Y\"), \"\\n\",                          sprintf(\"%.1f%%\", peak_quarterly$unemployment_rate * 100)),            size = 3.2, color = \"steelblue\", hjust = 0.5) +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 0.1),                      limits = c(0.10, 0.17)) +   scale_x_date(date_breaks = \"3 months\", date_labels = \"%b\\n%Y\") +   labs(     title = \"COVID-19 Unemployment Spike: Monthly vs Quarterly\",     subtitle = \"Monthly data (red) shows the true peak; quarterly (blue) averages it away\",     x = NULL, y = \"Unemployment Rate\",     caption = \"Source: PNADC/IBGE. Quarterly shown as step function to emphasize moving-average nature.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     panel.grid.minor = element_blank()   )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"the-2014-2017-recession-tracking-month-by-month-deterioration","dir":"Articles","previous_headings":"","what":"2. The 2014-2017 Recession: Tracking Month-by-Month Deterioration","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Brazil’s 2014-2017 recession saw unemployment rise around 6% 13%. Monthly data reveals deterioration unfolded fits starts, several months showing unemployment increases exceeding 1 percentage point—sudden shocks invisible averaged quarterly figures. yellow circles mark months unemployment jumped 1 percentage point: sudden deteriorations completely invisible smooth quarterly trend.","code":"# Filter to recession period (Jun 2014 - Jun 2017) recession_quarterly <- quarterly_total[period >= \"2014-06-01\" & period <= \"2017-06-01\"] recession_monthly <- monthly_total[period >= \"2014-06-01\" & period <= \"2017-06-01\"]  # Find the peak peak_recession <- recession_monthly[which.max(unemployment_rate)]  # Calculate month-over-month changes setorder(recession_monthly, period) recession_monthly[, change := unemployment_rate - shift(unemployment_rate)]  # Identify months with large jumps (> 1 percentage point) big_jumps <- recession_monthly[!is.na(change) & change > 0.01]  # Create the plot ggplot() +   # Quarterly   geom_step(data = recession_quarterly,             aes(x = period, y = unemployment_rate),             color = \"steelblue\", linewidth = 1, direction = \"mid\", alpha = 0.7) +   geom_point(data = recession_quarterly,              aes(x = period, y = unemployment_rate),              color = \"steelblue\", size = 2.5) +    # Monthly   geom_line(data = recession_monthly,             aes(x = period, y = unemployment_rate),             color = \"darkred\", linewidth = 0.8) +   geom_point(data = recession_monthly,              aes(x = period, y = unemployment_rate),              color = \"darkred\", size = 1.2) +    # Highlight big monthly jumps   geom_point(data = big_jumps,              aes(x = period, y = unemployment_rate),              color = \"darkred\", size = 3, shape = 21, fill = \"yellow\", stroke = 1.5) +    # Mark the peak   annotate(\"point\", x = peak_recession$period, y = peak_recession$unemployment_rate,            color = \"darkred\", size = 4, shape = 18) +   annotate(\"text\",            x = peak_recession$period + 45, y = peak_recession$unemployment_rate,            label = paste0(\"Peak: \", format(peak_recession$period, \"%b %Y\"), \"\\n\",                          sprintf(\"%.1f%%\", peak_recession$unemployment_rate * 100)),            size = 3, hjust = 0, color = \"darkred\") +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 1),                      breaks = seq(0.06, 0.14, 0.02)) +   scale_x_date(date_breaks = \"6 months\", date_labels = \"%b\\n%Y\") +   labs(     title = \"2014-2017 Recession: Month-by-Month Unemployment Rise\",     subtitle = \"Yellow circles: months with >1 p.p. unemployment increase. Monthly data (red) vs quarterly (blue).\",     x = NULL, y = \"Unemployment Rate\",     caption = \"Source: PNADC/IBGE. Monthly data reveals sudden jumps hidden in quarterly averages.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     panel.grid.minor = element_blank()   )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"minimum-wage-adjustments-validating-mensalization","dir":"Articles","previous_headings":"","what":"3. Minimum Wage Adjustments: Validating Mensalization","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Perhaps compelling validation mensalization methodology comes tracking minimum wage adjustments. PNADC collects two income measures: Habitual income (VD4016): worker usually earns—refers current reference month Effective income (VD4017): worker actually received—refers previous month minimum wage increases (typically January), habitual income show new value immediately, effective income still show old value (since refers previous month). one-month lag prediction mensalization: reference month identification correct, pattern crisp; wrong, blurs. focus formal private sector employees (VD4009 == 1) aged 18+, tracking share earning exactly historical minimum wage value.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"preparing-the-minimum-wage-data","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"Preparing the Minimum Wage Data","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"","code":"# Historical minimum wage values (R$) # Note: 2020 had two adjustments (Jan and Feb), 2023 had mid-year adjustment (May) mw_history <- data.table(   start_yyyymm = c(201201, 201301, 201401, 201501, 201601, 201701, 201801,                    201901, 202001, 202002, 202101, 202201, 202301, 202305,                    202401, 202501),   mw_value = c(622, 678, 724, 788, 880, 937, 954, 998, 1039, 1045, 1100,                1212, 1302, 1320, 1412, 1518) ) mw_adjustment_months <- mw_history$start_yyyymm  # For each formal private sector employee, identify which MW they earn pnadc_formal <- pnadc[VD4009 == 1 & V2009 >= 18 & !is.na(weight_monthly)]  # Match exact habitual/effective incomes to MW values pnadc_formal[, habitual_mw := mw_history[start_yyyymm <= ref_month_yyyymm][.N, mw_value], by = ref_month_yyyymm] pnadc_formal[, at_habitual_mw := as.integer(VD4016 == habitual_mw)] pnadc_formal[, at_effective_mw := as.integer(VD4017 == habitual_mw)]  # Aggregate by month and MW value monthly_mw_exact <- pnadc_formal[, .(   n_workers = sum(weight_monthly),   pct_habitual = sum(at_habitual_mw * weight_monthly) / sum(weight_monthly),   pct_effective = sum(at_effective_mw * weight_monthly) / sum(weight_monthly) ), by = .(ref_month_yyyymm, mw_value = habitual_mw)]  monthly_mw_exact[, period := as.Date(paste0(ref_month_yyyymm %/% 100, \"-\",                                              ref_month_yyyymm %% 100, \"-15\"))]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"the-smoking-gun-january-2013-transition","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"The Smoking Gun: January 2013 Transition","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"January 2013, minimum wage increased R$ 622 R$ 678: smoking gun. left panel (habitual income), workers shift R$ 622 R$ 678 January. right panel (effective income), shift happens February—exactly one-month lag predicted temporal reference variable.","code":"# Create long format for plotting (needed for all MW examples) mw_long <- melt(monthly_mw_exact,                 id.vars = c(\"ref_month_yyyymm\", \"period\", \"mw_value\", \"n_workers\"),                 measure.vars = c(\"pct_habitual\", \"pct_effective\"),                 variable.name = \"income_type\",                 value.name = \"pct_at_mw\")  # Add readable labels mw_long[, income_label := fifelse(income_type == \"pct_habitual\",                                    \"Habitual Income (current month)\",                                    \"Effective Income (previous month)\")]  # Get adjustment dates for reference lines adj_dates <- as.Date(paste0(mw_adjustment_months %/% 100, \"-\",                              mw_adjustment_months %% 100, \"-15\"))  # Filter to the first transition period (Oct 2012 - Apr 2013) mw_2013 <- mw_long[period >= \"2012-10-15\" & period <= \"2013-04-15\" &                    mw_value %in% c(622, 678)]  # Create the plot ggplot(mw_2013,        aes(x = period, y = pct_at_mw, color = factor(mw_value), linetype = factor(mw_value))) +   geom_line(linewidth = 1.2) +   geom_point(size = 2.5) +    # Mark the adjustment date (January 2013)   geom_vline(xintercept = as.Date(\"2013-01-15\"),              linetype = \"dashed\", linewidth = 0.8, color = \"gray40\") +    # Facet by income type   facet_wrap(~ income_label, ncol = 2) +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 0.1)) +   scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\\n%Y\") +   scale_color_manual(values = c(\"622\" = \"#b2182b\", \"678\" = \"#2166ac\"),                      labels = c(\"622\" = \"R$ 622 (old)\", \"678\" = \"R$ 678 (new)\"),                      name = \"MW Value\") +   scale_linetype_manual(values = c(\"622\" = \"solid\", \"678\" = \"solid\"), guide = \"none\") +   labs(     title = \"MW Transition: January 2013 (R$ 622 -> R$ 678)\",     subtitle = \"Habitual income shows transition in January; Effective income shows same pattern in February\",     x = NULL, y = \"Share Earning Exact MW\",     caption = \"Vertical line = MW adjustment. Habitual income refers to current month; effective to previous month.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"bottom\",     panel.grid.minor = element_blank(),     strip.text = element_text(face = \"bold\")   )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"a-harder-test-the-2020-double-adjustment","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"A Harder Test: The 2020 Double Adjustment","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"unusual sequence, Brazil adjusted minimum wage twice consecutive months: January 2020: R$ 998 -> R$ 1,039 (annual adjustment) February 2020: R$ 1,039 -> R$ 1,045 (correction) R$ 1,039 official minimum wage one month. reference month identification imprecise, rapid transitions blur together. pattern remains crisp. habitual income, January shows R$ 1,039 replacing R$ 998, February shows R$ 1,045 replacing R$ 1,039. effective income, transition appears exactly one month later.","code":"# Filter to 2020 double adjustment period (Jul 2019 - Jul 2020) mw_2020 <- mw_long[period >= \"2019-07-15\" & period <= \"2020-07-15\" &                    mw_value %in% c(998, 1039, 1045)]  # Get adjustment dates in this period adj_2020 <- adj_dates[adj_dates >= \"2019-07-15\" & adj_dates <= \"2020-07-15\"]  # Create the plot ggplot(mw_2020,        aes(x = period, y = pct_at_mw, color = factor(mw_value), linetype = factor(mw_value))) +   geom_line(linewidth = 1.1) +   geom_point(size = 2.5) +    # Mark adjustment months   geom_vline(xintercept = adj_2020, linetype = \"dashed\", linewidth = 0.8, color = \"gray40\") +    # Facet by income type   facet_wrap(~ income_label, ncol = 2) +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 0.1)) +   scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\\n%Y\") +   scale_color_manual(values = c(\"998\" = \"#b2182b\", \"1039\" = \"#7b3294\", \"1045\" = \"#2166ac\"),                      labels = c(\"998\" = \"R$ 998 (2019)\", \"1039\" = \"R$ 1,039 (Jan 2020)\",                                \"1045\" = \"R$ 1,045 (Feb 2020+)\"),                      name = \"MW Value\") +   scale_linetype_manual(values = c(\"998\" = \"solid\", \"1039\" = \"solid\", \"1045\" = \"solid\"),                         guide = \"none\") +   labs(     title = \"The 2020 Double Adjustment: A Demanding Test\",     subtitle = \"R$ 998 -> R$ 1,039 (Jan) -> R$ 1,045 (Feb). Three values, two transitions, one-month lag preserved.\",     x = NULL, y = \"Share Earning Exact MW\",     caption = \"Vertical lines = MW adjustments. The short-lived R$ 1,039 value (one month only) creates a sharp test.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"bottom\",     panel.grid.minor = element_blank(),     strip.text = element_text(face = \"bold\")   )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"the-full-picture-2012-2025","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"The Full Picture: 2012-2025","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"vertical line marks MW adjustment. pattern top panel (habitual income) shifted one month earlier bottom panel (effective income)—consistently across thirteen years sixteen minimum wage values. provides strong validation mensalization algorithm correctly identifies reference months.","code":"# Create color palette (blue to red gradient) mw_vals <- sort(unique(monthly_mw_exact$mw_value)) n_mw <- length(mw_vals) palette_fn <- colorRampPalette(c(\"#2166ac\", \"#67a9cf\", \"#d1e5f0\",                                   \"#fddbc7\", \"#ef8a62\", \"#b2182b\")) mw_colors <- palette_fn(n_mw) names(mw_colors) <- as.character(mw_vals)  # Filter to MW values with meaningful presence (>0.1% at some point) mw_long[, max_pct := max(pct_at_mw), by = mw_value] mw_long_filtered <- mw_long[max_pct > 0.001]  # Create the plot ggplot(mw_long_filtered,        aes(x = period, y = pct_at_mw, color = factor(mw_value), group = mw_value)) +   geom_line(linewidth = 0.6, alpha = 0.8) +    # Mark MW adjustment months   geom_vline(xintercept = adj_dates, linetype = \"dashed\", alpha = 0.3, color = \"gray40\") +    # Facet by income type   facet_wrap(~ income_label, ncol = 1) +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 0.1)) +   scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +   scale_color_manual(values = mw_colors, name = \"MW Value (R$)\") +   labs(     title = \"Share of Formal Workers Earning Each Exact MW Value\",     subtitle = \"Each line = one MW value. Vertical lines = MW adjustments. Pattern shifted 1 month between panels.\",     x = NULL, y = \"Share of Workers\",     caption = \"Source: PNADC/IBGE. Formal private sector employees age 18+. All calculations use weight_monthly.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"right\",     legend.key.size = unit(0.4, \"cm\"),     panel.grid.minor = element_blank(),     strip.text = element_text(face = \"bold\", size = 11)   ) +   guides(color = guide_legend(ncol = 2))"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"summary-what-monthly-data-reveals","dir":"Articles","previous_headings":"","what":"Summary: What Monthly Data Reveals","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Monthly data PNADCperiods enables precise timing economic turning points, true magnitudes shocks, validation known temporal patterns.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"beyond-monthly-fortnightly-and-weekly-analysis","dir":"Articles","previous_headings":"","what":"4. Beyond Monthly: Fortnightly and Weekly Analysis","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"PNADCperiods also identifies fortnightly weekly reference periods. lower determination rates , unlike months (aggregate constraints across quarterly visits), fortnights weeks can use information within single quarter.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"determination-rates-and-experimental-strategies","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"Determination Rates and Experimental Strategies","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"pnadc_experimental_periods() function applies two strategies boost sub-monthly rates: probabilistic assignment (interview window falls one period) UPA aggregation (observations UPA agree period).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"sub-monthly-calibration-workflow","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"Sub-Monthly Calibration Workflow","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Sub-monthly analysis requires separate call pnadc_apply_periods() appropriate calibration_unit. calibration unit produces weight column (weight_fortnight weight_weekly), calibrated account non-random selection sub-monthly determination. Important: Use clean copy data (prior pnadc_apply_periods() call) avoid column conflicts duplicate merges.","code":"# Step 1: Apply experimental strategies to the crosswalk crosswalk_exp <- pnadc_experimental_periods(   crosswalk,   strategy = \"both\",   confidence_threshold = 0.85,   upa_proportion_threshold = 0.80,   verbose = TRUE )  # Step 2: Apply to CLEAN data with calibration_unit = \"fortnight\" # (pnadc_apply_periods handles the crosswalk merge internally) pnadc_fortnight <- pnadc_apply_periods(   pnadc_clean,   crosswalk_exp,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = TRUE,   calibration_unit = \"fortnight\" )  # Step 3: For weekly analysis, call again with calibration_unit = \"week\" pnadc_weekly <- pnadc_apply_periods(   pnadc_clean,   crosswalk_exp,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = TRUE,   calibration_unit = \"week\",   smooth = FALSE  # No smoothing for weekly (too sparse) )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"example-covid-19-lockdown-at-fortnightly-resolution","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"Example: COVID-19 Lockdown at Fortnightly Resolution","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Brazilian lockdowns began around March 16, 2020—almost perfectly aligned fortnight boundary. Monthly data March averages pre- post-lockdown. Fortnightly data can separate . fortnightly data shows sharper discontinuity around March 16—participation rate second fortnight March dropped steeply monthly average suggests.","code":"# Filter to COVID period with calibrated fortnight weights pnadc_fn_covid <- pnadc_fortnight[   !is.na(weight_fortnight) & Ano == 2020 & Trimestre %in% 1:2 & V2009 >= 14 ]  # Compute participation rate by fortnight fortnight_covid <- pnadc_fn_covid[, .(   participation_rate = sum((VD4001 == 1) * weight_fortnight, na.rm = TRUE) /                        sum(weight_fortnight, na.rm = TRUE),   n_obs = .N ), by = .(ref_fortnight_yyyyff)]  # Add period Date column fortnight_covid[, period := as.Date(paste0(   ref_fortnight_yyyyff %/% 100, \"-\",   ((ref_fortnight_yyyyff %% 100) - 1L) %/% 2L + 1L, \"-\",   fifelse(ref_fortnight_yyyyff %% 2L == 1L, \"1\", \"16\") ))] # Monthly comparison data covid_monthly_part <- monthly_total[   period >= \"2020-01-01\" & period <= \"2020-06-30\",   .(period, participation_rate) ]  ggplot() +   # Monthly as reference   geom_line(data = covid_monthly_part,             aes(x = period, y = participation_rate),             color = \"darkred\", linewidth = 1, alpha = 0.7) +   geom_point(data = covid_monthly_part,              aes(x = period, y = participation_rate),              color = \"darkred\", size = 3) +    # Fortnightly   geom_point(data = fortnight_covid[n_obs >= 300],              aes(x = period, y = participation_rate, size = n_obs),              color = \"#ff7f0e\", alpha = 0.8) +   scale_size_continuous(range = c(2, 5), guide = \"none\") +    # Mark lockdown transition   geom_vline(xintercept = as.Date(\"2020-03-16\"),              linetype = \"dotted\", color = \"gray40\") +    scale_y_continuous(labels = percent_format(accuracy = 0.1)) +   scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\\n%Y\") +   labs(     title = \"COVID-19 Labor Force Participation: Monthly vs Fortnightly\",     subtitle = \"Fortnightly points (orange) show sharper discontinuity at lockdown onset (experimental strategies)\",     x = NULL, y = \"Labor Force Participation Rate\",     caption = \"Uses pnadc_experimental_periods(strategy='both', conf=0.85, upa=0.80). Only fortnights with n >= 300 shown.\"   ) +   theme_minimal(base_size = 11)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"example-carnival-week-labor-market-effects","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"Example: Carnival Week Labor Market Effects","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Carnival Brazil’s largest cultural event, concentrated specific states (Bahia, Rio de Janeiro, Pernambuco). pool multiple years (2019, 2022-2025, excluding COVID years) compare Carnival states states, using average hours worked (VD4035): Workers Carnival-intensive states reduce average hours worked Carnival week compared weeks, though small weekly sample sizes mean estimates considerable uncertainty.","code":"# Filter to Q1 of Carnival years with calibrated weekly weights carnival_years <- c(2019L, 2022L, 2023L, 2024L, 2025L) pnadc_wk <- pnadc_weekly[   !is.na(weight_weekly) & Trimestre == 1L & Ano %in% carnival_years &   V2009 >= 14 & VD4002 == 1 & !is.na(VD4035) ]  # Define Carnival weeks (ISO week of Carnival Tuesday) carnival_weeks <- data.table(   Ano = carnival_years,   carnival_iso_week = c(10L, 9L, 8L, 7L, 10L) )  # Extract ISO week and merge pnadc_wk[, iso_week := ref_week_yyyyww %% 100L] pnadc_wk <- merge(pnadc_wk, carnival_weeks, by = \"Ano\", all.x = TRUE) pnadc_wk[, is_carnival_week := (iso_week == carnival_iso_week)]  # Flag Carnival-intensive states (BA=29, RJ=33, PE=26) pnadc_wk[, is_carnival_state := UF %in% c(29L, 33L, 26L)]  # Aggregate: average hours by Carnival week x region (pooled across years) weekly_carnival <- pnadc_wk[, .(   avg_hours_worked = sum(VD4035 * weight_weekly, na.rm = TRUE) /                      sum(weight_weekly, na.rm = TRUE),   n_obs = .N ), by = .(is_carnival_week, is_carnival_state)] ggplot(weekly_carnival,        aes(x = fifelse(is_carnival_week, \"Carnival Week\", \"Other Weeks\"),            y = avg_hours_worked,            fill = fifelse(is_carnival_state, \"Carnival States (BA/RJ/PE)\", \"Other States\"))) +   geom_col(position = position_dodge(width = 0.8), width = 0.7) +   scale_y_continuous(limits = c(0, 45)) +   scale_fill_manual(values = c(\"Carnival States (BA/RJ/PE)\" = \"#ff7f0e\",                                \"Other States\" = \"#1f77b4\")) +   labs(     title = \"Average Hours Worked by Week Type and Region\",     subtitle = \"Pooled data from Q1 2019, 2022-2025 (experimental strategies)\",     x = NULL, y = \"Average Hours Worked (per week)\",     fill = \"Region\",     caption = \"Uses pnadc_experimental_periods(strategy='both', conf=0.85, upa=0.80). Pooled across 5 years.\"   ) +   theme_minimal(base_size = 11)"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"see-also","dir":"Articles","previous_headings":"","what":"See Also","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Get Started - Basic mensalization workflow Works - Algorithm details technical explanation Annual Poverty Analysis - Monthly poverty analysis annual income data Download Prepare Data - Data download workflow","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/applied-examples.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"HECKSHER, Marcos. “Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua”. IPEA - Nota Tecnica Disoc, n. 62. Brasilia, DF: IPEA, 2020. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453 HECKSHER, M. “Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes”. IPEA - Nota Tecnica Disoc, n. 87. Brasilia, DF: IPEA, 2020. HECKSHER, Marcos. “Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril”. IPEA - Carta de Conjuntura, v. 47, p. 1-6, 2020. NERI, Marcelo; HECKSHER, Marcos. “Montanha-Russa da Pobreza”. FGV Social - Sumario Executivo. Rio de Janeiro: FGV, Junho/2022. https://www.cps.fgv.br/cps/bd/docs/MontanhaRussaDaPobreza_Neri_Hecksher_FGV_Social.pdf NERI, Marcelo; HECKSHER, Marcos. “montanha-russa da pobreza mensal e um programa social alternativo”. Revista NECAT, v. 11, n. 21, 2022. IBGE. Pesquisa Nacional por Amostra de Domicilios Continua (PNADC). https://www.ibge.gov.br/estatisticas/sociais/trabalho/ Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package version v0.1.0. https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Complex Survey Design with Monthly Weights","text":"compute statistic survey data—say, unemployment rate 7.2%—number alone doesn’t tell much. 7.2% meaningfully different last month’s 7.0%? Without standard errors confidence intervals, can’t answer question. matters especially tracking changes time. Monthly data PNADCperiods reveals dynamics hidden quarterly averages, sharp month--month movements real economic changes just sampling variability. Standard errors let distinguish signal noise. challenge PNADC uses complex sample design—stratification (Estrato), clustering (UPA), unequal probabilities—means standard formulas underestimate variance. vignette shows two strategies proper variance estimation: Linearization: Using design variables directly—simple fast Replication weights: Adjusting IBGE’s 200 bootstrap weights—intensive exact demonstrate using gender gap labor force participation, widened dramatically COVID-19.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"why-standard-errors-matter","dir":"Articles","previous_headings":"","what":"Why Standard Errors Matter","title":"Complex Survey Design with Monthly Weights","text":"diving methodology, consider figure . shows labor force participation men women COVID-19. shaded bands 95% confidence intervals proper complex survey analysis. Without confidence intervals, might -interpret month--month fluctuations real economic changes. , can assess movements statistically meaningful.","code":"# Subset to COVID period for focused visualization p3_data <- results_by_sex[period >= \"2019-01-01\" & period <= \"2022-06-01\"]  p3 <- ggplot(p3_data, aes(x = period, y = participation, color = sex)) +    # Just the lines (no CI)   geom_line(linewidth = 0.9) +    # Add confidence bands with low alpha   geom_ribbon(aes(ymin = ci_l, ymax = ci_u, fill = sex),               alpha = 0.25, color = NA) +    # Scales and labels   scale_y_continuous(     labels = percent_format(accuracy = 1),     limits = c(0.45, 0.80)   ) +   scale_x_date(date_breaks = \"6 months\", date_labels = \"%b\\n%Y\") +   scale_color_manual(values = c(\"Men\" = \"#0074D9\", \"Women\" = \"#FF4136\")) +   scale_fill_manual(values = c(\"Men\" = \"#0074D9\", \"Women\" = \"#FF4136\")) +    # Add annotations for interpretation   annotate(\"segment\",            x = as.Date(\"2020-06-15\"), xend = as.Date(\"2020-06-15\"),            y = 0.52, yend = 0.62,            arrow = arrow(ends = \"both\", length = unit(0.1, \"cm\")),            color = \"gray30\") +   annotate(\"text\",            x = as.Date(\"2020-06-15\"), y = 0.50,            label = \"Is this drop\\nstatistically\\nsignificant?\",            size = 2.8, color = \"gray30\") +    labs(     title = \"Why Confidence Intervals Matter: COVID-19 Labor Market Shock\",     subtitle = \"Confidence bands (shaded) show the precision of estimates. Overlapping bands suggest uncertain differences.\",     x = NULL,     y = \"Labor Force Participation Rate\",     color = \"Sex\",     fill = \"Sex\",     caption = \"Source: PNADC/IBGE. Confidence bands show +/- 1.96 SE from complex survey design.\"   ) +    theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"bottom\",     panel.grid.minor = element_blank()   ) p3"},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"prerequisites","dir":"Articles","previous_headings":"","what":"Prerequisites","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Core packages library(PNADCperiods) library(data.table) library(fst)  # Survey analysis library(survey)  # Visualization library(ggplot2) library(scales)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"loading-and-preparing-data","dir":"Articles","previous_headings":"","what":"Loading and Preparing Data","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Load stacked PNADC quarterly data (all years available) # Requires: identification vars, calibration vars, Estrato, plus analysis vars files <- list.files(\"D:/Dropbox/Bancos_Dados/PNADC/Trimestral/Dados/\",                     pattern = \"^pnadc_\\\\d{4}-\\\\dq\\\\.fst$\", full.names = TRUE)  cols_needed <- c(   # Mensalization keys   \"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\",   # Birthday variables (for identification)   \"V2008\", \"V20081\", \"V20082\", \"V2009\",   # Calibration variables   \"V1028\", \"UF\", \"posest\", \"posest_sxi\",   # Survey design variables   \"Estrato\",   # Analysis variables   \"VD4001\", \"VD4002\", \"V2007\" )  pnadc <- rbindlist(lapply(files, function(f) {   fst::read_fst(f, as.data.table = TRUE, columns = cols_needed) }), fill = TRUE)  # Step 1: Build crosswalk (identify reference periods) crosswalk <- pnadc_identify_periods(pnadc, verbose = TRUE)  # Step 2: Apply crosswalk and calibrate weights pnadc <- pnadc_apply_periods(pnadc, crosswalk,                               weight_var = \"V1028\",                               anchor = \"quarter\",                               calibrate = TRUE,                               calibration_unit = \"month\",                               verbose = TRUE)  # Filter to determined observations with monthly weights pnadc_monthly <- pnadc[!is.na(weight_monthly)]  # Handle singleton strata globally options(survey.lonely.psu = \"adjust\")"},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"strategy-1-linearization-with-strata-and-psu","dir":"Articles","previous_headings":"","what":"Strategy 1: Linearization with Strata and PSU","title":"Complex Survey Design with Monthly Weights","text":"approach uses Taylor series linearization estimate variances. PNADC uses two-stage stratified cluster sample: within stratum (Estrato), Primary Sampling Units (UPA) selected probability proportional size, households within selected UPAs interviewed.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"setting-up-a-survey-design","dir":"Articles","previous_headings":"Strategy 1: Linearization with Strata and PSU","what":"Setting Up a Survey Design","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Create survey design object for a specific month (e.g., January 2020) pnadc_jan2020 <- pnadc_monthly[ref_month_yyyymm == 202001 & V2009 >= 14]  design_jan2020 <- svydesign(   ids = ~UPA,                    # PSU/cluster identifier   strata = ~Estrato,             # Stratification variable   weights = ~weight_monthly,     # Monthly-adjusted weight   data = pnadc_jan2020,   nest = TRUE                    # UPAs nested within strata )  # Labor force participation rate svymean(~I(VD4001 == 1), design_jan2020, na.rm = TRUE) confint(svymean(~I(VD4001 == 1), design_jan2020, na.rm = TRUE))"},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"monthly-time-series-with-confidence-intervals","dir":"Articles","previous_headings":"Strategy 1: Linearization with Strata and PSU","what":"Monthly Time Series with Confidence Intervals","title":"Complex Survey Design with Monthly Weights","text":"create full monthly series, loop months function handles edge cases: tryCatch wrapper handles months survey design might fail (e.g., sparse data early pandemic months). svyby() function returns columns participation, se, ci_l, ci_u.","code":"# Prepare analysis data pnadc_monthly[, V2009 := as.integer(V2009)] pnadc_analysis <- pnadc_monthly[V2009 >= 14] pnadc_analysis[, VD4001 := as.integer(VD4001)] pnadc_analysis[, in_labor_force := fifelse(VD4001 == 1, 1L, 0L)] pnadc_analysis[, V2007 := as.integer(V2007)] pnadc_analysis[, sex := fifelse(V2007 == 1, \"Men\", \"Women\")]  # Function to compute participation by sex for one month compute_participation_by_sex <- function(month_yyyymm, data) {    month_data <- data[ref_month_yyyymm == month_yyyymm]    if (nrow(month_data) < 100) return(NULL)    tryCatch({     design <- svydesign(       ids = ~UPA,       strata = ~Estrato,       weights = ~weight_monthly,       data = month_data,       nest = TRUE     )      result <- svyby(       ~in_labor_force,       by = ~sex,       design = design,       FUN = svymean,       na.rm = TRUE,       vartype = c(\"se\", \"ci\")     )      setDT(result)     result[, ref_month_yyyymm := month_yyyymm]     result   }, error = function(e) {     cat(\"Error processing month\", month_yyyymm, \":\", e$message, \"\\n\")     NULL   }) }  # Compute for all months months <- sort(unique(pnadc_analysis$ref_month_yyyymm)) results_by_sex <- rbindlist(   lapply(months, compute_participation_by_sex, data = pnadc_analysis) )  # Rename estimate column for clarity setnames(results_by_sex, \"in_labor_force\", \"participation\")  # Add date column for plotting results_by_sex[, period := as.Date(paste0(   ref_month_yyyymm %/% 100, \"-\",   ref_month_yyyymm %% 100, \"-15\" ))]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"strategy-2-replication-weights","dir":"Articles","previous_headings":"","what":"Strategy 2: Replication Weights","title":"Complex Survey Design with Monthly Weights","text":"IBGE provides 200 bootstrap replication weights (V1028001 V1028200) quarterly release. approach computationally intensive (201 computations per statistic) handles complex statistics like quantiles, Gini coefficients, regression coefficients without special variance formulas. key insight: apply calibration ratio replication weight: V1028kmonthly=V1028k×weight_monthlyV1028 \\text{V1028}_k^{\\text{monthly}} = \\text{V1028}_k \\times \\frac{\\text{weight\\_monthly}}{\\text{V1028}}","code":"# Calculate the adjustment ratio pnadc_monthly[, weight_ratio := weight_monthly / V1028]  # Get names of replication weight columns rep_weight_cols <- paste0(\"V1028\", sprintf(\"%03d\", 1:200))  # Create adjusted replication weight columns for (col in rep_weight_cols) {   new_col <- paste0(col, \"_monthly\")   pnadc_monthly[, (new_col) := get(col) * weight_ratio] } # Create replicate weights design (e.g., for January 2020) pnadc_jan2020_rep <- pnadc_monthly[ref_month_yyyymm == 202001 & V2009 >= 14] rep_weight_cols_monthly <- paste0(\"V1028\", sprintf(\"%03d\", 1:200), \"_monthly\")  design_rep <- svrepdesign(   data = pnadc_jan2020_rep,   weights = ~weight_monthly,   repweights = rep_weight_cols_monthly,   type = \"bootstrap\",   combined.weights = TRUE )  # Use the same svymean/svyby functions as with linearization svymean(~I(VD4001 == 1), design_rep, na.rm = TRUE)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"comparing-strategies","dir":"Articles","previous_headings":"Strategy 2: Replication Weights","what":"Comparing Strategies","title":"Complex Survey Design with Monthly Weights","text":"Recommendation: Use linearization exploratory analysis routine work. Use replication computing complex statistics preparing results publication.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"practical-example-gender-gap-in-labor-force-participation","dir":"Articles","previous_headings":"","what":"Practical Example: Gender Gap in Labor Force Participation","title":"Complex Survey Design with Monthly Weights","text":"Brazil one largest gender gaps labor force participation among major economies—20 percentage points. COVID-19 provides natural experiment: school closures increased caregiving demands fell disproportionately women. Monthly data lets us track whether gap widened, confidence intervals tell us change statistically significant.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"computing-the-gender-gap","dir":"Articles","previous_headings":"Practical Example: Gender Gap in Labor Force Participation","what":"Computing the Gender Gap","title":"Complex Survey Design with Monthly Weights","text":"gap derived statistic: difference two survey estimates. derive -sex results already computed :","code":"# Reshape to wide format to compute gap results_wide <- dcast(results_by_sex, ref_month_yyyymm + period ~ sex,                       value.var = c(\"participation\", \"se\"))  # Compute gap and its SE # SE of difference: SE(gap) = sqrt(SE_men^2 + SE_women^2) results_wide[, `:=`(   gap = participation_Men - participation_Women,   gap_se = sqrt(se_Men^2 + se_Women^2) )]  results_wide[, `:=`(   gap_ci_lower = gap - 1.96 * gap_se,   gap_ci_upper = gap + 1.96 * gap_se )]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"visualizing-the-results","dir":"Articles","previous_headings":"Practical Example: Gender Gap in Labor Force Participation","what":"Visualizing the Results","title":"Complex Survey Design with Monthly Weights","text":"confidence bands men women never overlap, confirming gender gap statistically significant every month. Women’s participation dropped sharply COVID-19 (~53% 47%) men’s (~73% ~66%). gap widened ~20 ~23 percentage points COVID-19, confidence bands confirm increase statistically significant. gap returned pre-pandemic levels 2022.","code":"# Reshape back to long for plotting results_long <- results_by_sex[!is.na(participation)]  # Ensure proper CI columns exist if (!\"ci_l\" %in% names(results_long)) {   results_long[, ci_l := participation - 1.96 * se]   results_long[, ci_u := participation + 1.96 * se] }  p1 <- ggplot(results_long, aes(x = period, y = participation, color = sex, fill = sex)) +    # Confidence bands   geom_ribbon(aes(ymin = ci_l, ymax = ci_u), alpha = 0.2, color = NA) +    # Point estimates   geom_line(linewidth = 0.8) +    # Highlight COVID period   annotate(\"rect\",            xmin = as.Date(\"2020-03-01\"), xmax = as.Date(\"2021-12-31\"),            ymin = -Inf, ymax = Inf,            fill = \"gray80\", alpha = 0.3) +   annotate(\"text\",            x = as.Date(\"2021-01-01\"), y = 0.85,            label = \"COVID-19\", fontface = \"italic\", size = 3, color = \"gray40\") +    # Scales and labels   scale_y_continuous(     labels = percent_format(accuracy = 1),     limits = c(0.45, 0.85),     breaks = seq(0.45, 0.85, 0.05)   ) +   scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +   scale_color_manual(values = c(\"Men\" = \"#0074D9\", \"Women\" = \"#FF4136\")) +   scale_fill_manual(values = c(\"Men\" = \"#0074D9\", \"Women\" = \"#FF4136\")) +    labs(     title = \"Labor Force Participation by Sex: Monthly Series with 95% Confidence Intervals\",     subtitle = \"Brazil, 2012-2025. Shaded regions show 95% confidence bands from complex survey design.\",     x = NULL,     y = \"Labor Force Participation Rate\",     color = \"Sex\",     fill = \"Sex\",     caption = \"Source: PNADC/IBGE. Monthly weights from PNADCperiods. Variance estimated via Taylor linearization.\"   ) +    theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"bottom\",     panel.grid.minor = element_blank()   ) p1 # Pre-COVID average for reference line pre_covid_avg <- results_wide[period < \"2020-03-01\", mean(gap, na.rm = TRUE)]  p2 <- ggplot(results_wide[!is.na(gap)], aes(x = period, y = gap)) +    # Confidence band   geom_ribbon(aes(ymin = gap_ci_lower, ymax = gap_ci_upper),               fill = \"#7b3294\", alpha = 0.3) +    # Point estimate   geom_line(color = \"#7b3294\", linewidth = 0.9) +    # Reference line at pre-COVID average   geom_hline(     yintercept = pre_covid_avg,     linetype = \"dashed\", color = \"gray50\"   ) +   annotate(\"text\", x = min(results_wide$period, na.rm = TRUE) + 180,            y = pre_covid_avg + 0.008,            label = paste0(\"Pre-COVID avg: \", sprintf(\"%.1f\", pre_covid_avg * 100), \" p.p.\"),            size = 3, color = \"gray40\", hjust = 0) +    # Highlight COVID period   annotate(\"rect\",            xmin = as.Date(\"2020-03-01\"), xmax = as.Date(\"2021-12-31\"),            ymin = -Inf, ymax = Inf,            fill = \"gray80\", alpha = 0.3) +    # Scales and labels   scale_y_continuous(     labels = percent_format(accuracy = 1),     breaks = seq(0.15, 0.30, 0.025)   ) +   scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +    labs(     title = \"Gender Gap in Labor Force Participation (Men - Women)\",     subtitle = \"Monthly series with 95% CI. Dashed line = pre-COVID average. Gap widened during pandemic.\",     x = NULL,     y = \"Participation Gap (percentage points)\",     caption = \"Source: PNADC/IBGE. Monthly weights from PNADCperiods.\"   ) +    theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     panel.grid.minor = element_blank()   ) p2"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"singleton-strata","dir":"Articles","previous_headings":"Practical Tips","what":"Singleton Strata","title":"Complex Survey Design with Monthly Weights","text":"months may strata one PSU. options(survey.lonely.psu = \"adjust\") setting (shown data preparation section ) provides conservative adjustment. options include \"remove\" \"average\".","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"subpopulation-analysis","dir":"Articles","previous_headings":"Practical Tips","what":"Subpopulation Analysis","title":"Complex Survey Design with Monthly Weights","text":"analyzing subgroups, always subset design object, raw data: Subsetting data creating design object loses information full sample structure, leading incorrect variance estimates.","code":"# CORRECT: Subset the design design_women <- subset(design_jan2020, V2007 == 2) svymean(~I(VD4001 == 1), design_women, na.rm = TRUE)  # INCORRECT: Don't do this - loses design information # bad_design <- svydesign(..., data = pnadc[V2007 == 2])"},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"summary","dir":"Articles","previous_headings":"","what":"Summary","title":"Complex Survey Design with Monthly Weights","text":"vignette demonstrated two approaches computing standard errors monthly PNADC weights: Linearization: Use Estrato strata, UPA PSU, weight_monthly weight svydesign(). Fast, simple, works statistics. Replication: Multiply bootstrap weight weight_monthly / V1028. intensive exact complex statistics. gender gap example demonstrated confidence intervals transform claim like “gap looks bigger” “gap increased 2-3 percentage points, ’re 95% confident ’s real.”","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Complex Survey Design with Monthly Weights","text":"HECKSHER, Marcos. “Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua”. IPEA - Nota Tecnica Disoc, n. 62. Brasilia, DF: IPEA, 2020. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453 HECKSHER, M. “Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes”. IPEA - Nota Tecnica Disoc, n. 87. Brasilia, DF: IPEA, 2020. HECKSHER, Marcos. “Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril”. IPEA - Carta de Conjuntura, v. 47, p. 1-6, 2020. Thomas Lumley (2010). Complex Surveys: Guide Analysis Using R. Wiley. IBGE. Notas Metodologicas da PNAD Continua. Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package version v0.1.0. https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/complex-survey-design.html","id":"further-reading","dir":"Articles","previous_headings":"","what":"Further Reading","title":"Complex Survey Design with Monthly Weights","text":"Get Started - Basic mensalization workflow Applied Examples - Monthly labor market analysis figures","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Download and Prepare PNADC Data","text":"vignette provides complete workflow downloading Brazil’s quarterly PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) microdata preparing mensalization. workflow covers three steps: Downloading quarterly PNADC microdata IBGE using PNADcIBGE package Stacking multiple quarters single dataset (critical high determination rates) Applying mensalization using PNADCperiods package already PNADC data want learn package API first, see Get Started. algorithm details, see PNADCperiods Works.","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"required-packages","dir":"Articles","previous_headings":"Prerequisites","what":"Required Packages","title":"Download and Prepare PNADC Data","text":"","code":"# Install packages if needed install.packages(c(\"PNADcIBGE\", \"fst\"))  # Install PNADCperiods from GitHub # remotes::install_github(\"antrologos/PNADCperiods\")  # Load packages library(PNADcIBGE) library(data.table) library(fst) library(PNADCperiods)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"system-requirements","dir":"Articles","previous_headings":"Prerequisites","what":"System Requirements","title":"Download and Prepare PNADC Data","text":"Disk space: ~5 GB 2020-2024 data, ~15 GB full history (2012-present) RAM: least 8 GB recommended; 16 GB comfortable processing Time: 2-3 hours downloading (depends internet speed), ~5 minutes processing Internet: Required downloading data SIDRA API access (weight calibration)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"understanding-pnadc-data","dir":"Articles","previous_headings":"","what":"Understanding PNADC Data","title":"Download and Prepare PNADC Data","text":"PNADC Brazil’s primary household survey labor market statistics, conducted IBGE. survey uses rotating panel design household interviewed five times 15 months. quarterly release contains approximately 500,000 observations. stack multiple quarters? mensalization algorithm identifies reference months tracking households across panel interviews. single quarter, determination rate ~70%. stacking multiple quarters, algorithm leverages rotating panel structure achieve 97% determination. applications, recommend stacking least 2 years (8 quarters) data.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"step-1-set-up-your-environment","dir":"Articles","previous_headings":"","what":"Step 1: Set Up Your Environment","title":"Download and Prepare PNADC Data","text":"","code":"# Set your data directory (adjust path as needed) data_dir <- \"path/to/your/pnadc_data/\" dir.create(data_dir, recursive = TRUE, showWarnings = FALSE)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"step-2-define-which-quarters-to-download","dir":"Articles","previous_headings":"","what":"Step 2: Define Which Quarters to Download","title":"Download and Prepare PNADC Data","text":"Create grid year-quarter combinations. example uses 2020-2024, provides good balance data size determination rate:","code":"# Define quarters to download (2020-2024 example) editions <- expand.grid(   year = 2020:2024,   quarter = 1:4 ) # If downloading recent years, filter out quarters not yet available: # editions <- editions[!(editions$year == 2025 & editions$quarter > 3), ]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"step-3-download-the-data","dir":"Articles","previous_headings":"","what":"Step 3: Download the Data","title":"Download and Prepare PNADC Data","text":"download loop fetches quarter IBGE saves FST format fast loading: Important: Always use labels = FALSE downloading. mensalization algorithm requires numeric codes birthday variables (V2008, V20081, V20082). Using labeled factors cause errors.","code":"for (i in 1:nrow(editions)) {   year_i <- editions$year[i]   quarter_i <- editions$quarter[i]    filename <- paste0(\"pnadc_\", year_i, \"-\", quarter_i, \"q.fst\")   cat(\"Downloading:\", year_i, \"Q\", quarter_i, \"\\n\")    # Download from IBGE   pnadc_quarter <- get_pnadc(     year = year_i,     quarter = quarter_i,     labels = FALSE,    # IMPORTANT: Use numeric codes, not labels     deflator = FALSE,     design = FALSE,     savedir = data_dir   )    # Save as FST format (fast serialization)   write_fst(pnadc_quarter, file.path(data_dir, filename))    # Clean up temporary files created by PNADcIBGE   temp_files <- list.files(data_dir,                            pattern = \"\\\\.(zip|sas|txt)$\",                            full.names = TRUE)   file.remove(temp_files)    rm(pnadc_quarter)   gc() }"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"step-4-stack-the-quarterly-files","dir":"Articles","previous_headings":"","what":"Step 4: Stack the Quarterly Files","title":"Download and Prepare PNADC Data","text":"Stack quarterly files single dataset. save memory, load columns needed mensalization:","code":"# Columns needed for mensalization cols_needed <- c(   # Time and identifiers   \"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\",   # Birthday variables (for reference period algorithm)   \"V2008\", \"V20081\", \"V20082\", \"V2009\",   # Weight and stratification (for weight calibration)   \"V1028\", \"UF\", \"posest\", \"posest_sxi\" )  # Stack all quarters files <- list.files(data_dir, pattern = \"pnadc_.*\\\\.fst$\", full.names = TRUE)  pnadc_stacked <- rbindlist(lapply(files, function(f) {   cat(\"Loading:\", basename(f), \"\\n\")   read_fst(f, columns = cols_needed, as.data.table = TRUE) }))  cat(\"Total observations:\", format(nrow(pnadc_stacked), big.mark = \",\"), \"\\n\")"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"step-5-apply-mensalization","dir":"Articles","previous_headings":"","what":"Step 5: Apply Mensalization","title":"Download and Prepare PNADC Data","text":"Build crosswalk (identify reference periods) calibrate weights: verbose output shows progress determination rates phase (month, fortnight, week). 20 quarters stacked (2020-2024), expect ~95% month determination.","code":"# Step 1: Build crosswalk (identify reference periods) crosswalk <- pnadc_identify_periods(pnadc_stacked, verbose = TRUE)  # Check determination rates crosswalk[, .(   month_rate = mean(determined_month),   fortnight_rate = mean(determined_fortnight),   week_rate = mean(determined_week) )]  # Step 2: Apply crosswalk and calibrate weights result <- pnadc_apply_periods(   data = pnadc_stacked,   crosswalk = crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = TRUE,   calibration_unit = \"month\",   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"step-6-explore-the-results","dir":"Articles","previous_headings":"","what":"Step 6: Explore the Results","title":"Download and Prepare PNADC Data","text":"result contains original columns plus reference period indicators calibrated weights: Key output columns: distribution approximately equal across months 1, 2, 3 (around 31-32%), remaining observations NA indeterminate cases.","code":"# Key new columns names(result)[grep(\"ref_|determined_|weight_\", names(result))]  # Distribution of reference months within quarters result[, .N, by = ref_month_in_quarter][order(ref_month_in_quarter)]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"step-7-save-and-use-the-results","dir":"Articles","previous_headings":"","what":"Step 7: Save and Use the Results","title":"Download and Prepare PNADC Data","text":"Save mensalized data future use: compute monthly estimates, filter determined observations aggregate ref_month_yyyymm: analysis examples, see Applied Examples.","code":"write_fst(result, file.path(data_dir, \"pnadc_mensalized.fst\")) # Monthly unemployment rate monthly_unemployment <- result[determined_month == TRUE, .(   unemployment_rate = sum((VD4002 == 2) * weight_monthly, na.rm = TRUE) /                       sum((VD4001 == 1) * weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]  # Monthly population monthly_pop <- result[determined_month == TRUE, .(   population = sum(weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"memory-and-performance-tips","dir":"Articles","previous_headings":"","what":"Memory and Performance Tips","title":"Download and Prepare PNADC Data","text":"Selective column loading: load columns need read_fst(..., columns = ...). dramatically reduces memory usage. Process batches: large analyses, process one year time combine results. Use FST format: FST much faster CSV RDS large datasets. typical quarter loads seconds rather minutes. Clean regularly: Use rm() gc() free memory processing quarter.","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"extending-to-full-history","dir":"Articles","previous_headings":"","what":"Extending to Full History","title":"Download and Prepare PNADC Data","text":"best determination rate longitudinal analysis, download available quarters: full history provides approximately 29 million observations achieves highest possible determination rate (~97% month).","code":"# Download all available data (2012-present) editions_full <- expand.grid(   year = 2012:2025,   quarter = 1:4 ) editions_full <- editions_full[!(editions_full$year == 2025 &                                    editions_full$quarter > 3), ]  # Use the same download and stacking workflow as above"},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"troubleshooting","dir":"Articles","previous_headings":"","what":"Troubleshooting","title":"Download and Prepare PNADC Data","text":"“Column found” errors: Ensure used labels = FALSE downloading. algorithm requires numeric codes. Download failures: IBGE servers can slow unavailable. PNADcIBGE package retry automatically, may need restart interrupted downloads. Memory errors: Try processing fewer quarters time, use machine RAM. SIDRA API errors: Weight calibration requires internet access SIDRA API. fails, try later use calibrate = FALSE reference period identification without weight calibration.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"next-steps","dir":"Articles","previous_headings":"","what":"Next Steps","title":"Download and Prepare PNADC Data","text":"Follow usage patterns Get Started real data See analysis examples Applied Examples Learn algorithm PNADCperiods Works Working annual PNADC data? Annual data (visit-specific microdata comprehensive income variables) requires different workflow. See Monthly Poverty Analysis Annual PNADC Data details using pnadc_apply_periods() anchor = \"year\".","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/download-and-prepare.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Download and Prepare PNADC Data","text":"HECKSHER, Marcos. “Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua”. IPEA - Nota Tecnica Disoc, n. 62. Brasilia, DF: IPEA, 2020. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453 HECKSHER, M. “Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes”. IPEA - Nota Tecnica Disoc, n. 87. Brasilia, DF: IPEA, 2020. HECKSHER, Marcos. “Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril”. IPEA - Carta de Conjuntura, v. 47, p. 1-6, 2020. Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package version v0.1.0. https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Get Started with PNADCperiods","text":"PNADCperiods package converts Brazil’s quarterly PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) survey data sub-quarterly time series. PNADC quarterly statistics actually moving averages three months, obscures true timing economic shocks, actual magnitude changes, turning points trends. package offers two complementary approaches: Microdata mensalization — Identify specific month, fortnight, week survey observation refers , calibrate weights sub-quarterly analysis. Use custom variables, subgroup analysis, individual-level regressions. SIDRA mensalization — Convert IBGE’s published rolling quarter aggregate series (86+ indicators) exact monthly estimates. microdata needed — just 3 lines code. detailed explanation algorithm, see PNADCperiods Works.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"installation","dir":"Articles","previous_headings":"","what":"Installation","title":"Get Started with PNADCperiods","text":"Dependencies: data.table, checkmate, sidrar (weight calibration SIDRA API access).","code":"# Install from GitHub devtools::install_github(\"antrologos/PNADCperiods\") library(PNADCperiods) library(data.table)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"microdata-mensalization","dir":"Articles","previous_headings":"","what":"Microdata Mensalization","title":"Get Started with PNADCperiods","text":"Use microdata workflow need custom variable definitions, subgroup analysis, individual-level regressions, indicators available via SIDRA. requires PNADC microdata files — see Download Prepare Data obtain .","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"required-columns","dir":"Articles","previous_headings":"Microdata Mensalization","what":"Required Columns","title":"Get Started with PNADCperiods","text":"algorithm needs columns PNADC data: weight calibration, also need: V1028 (V1032 annual data), UF, posest, posest_sxi.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"step-1-build-the-crosswalk","dir":"Articles","previous_headings":"Microdata Mensalization","what":"Step 1: Build the Crosswalk","title":"Get Started with PNADCperiods","text":"Stack multiple quarters best results. algorithm exploits PNADC’s rotating panel design — household (UPA + V1014) interviewed across 5 consecutive quarters relative month position. Cross-quarter aggregation achieves ~97% month determination full 2012-2025 history, vs ~70% single quarter. See ?pnadc_identify_periods full documentation crosswalk output columns.","code":"# Load your stacked quarterly PNADC data pnadc <- fread(\"pnadc_stacked.csv\") # Identify reference periods (month, fortnight, week) crosswalk <- pnadc_identify_periods(pnadc, verbose = TRUE) # Check determination rates crosswalk[, .(   month_rate = mean(determined_month),   fortnight_rate = mean(determined_fortnight),   week_rate = mean(determined_week) )]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"step-2-apply-crosswalk-and-calibrate-weights","dir":"Articles","previous_headings":"Microdata Mensalization","what":"Step 2: Apply Crosswalk and Calibrate Weights","title":"Get Started with PNADCperiods","text":"Key parameters: Weight calibration adjusts survey weights match known population benchmarks SIDRA, ensuring monthly totals consistent. result includes original columns plus reference period indicators calibrated weights (e.g., weight_monthly).","code":"result <- pnadc_apply_periods(   pnadc_2023q1,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = TRUE,   calibration_unit = \"month\" )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"step-3-compute-monthly-estimates","dir":"Articles","previous_headings":"Microdata Mensalization","what":"Step 3: Compute Monthly Estimates","title":"Get Started with PNADCperiods","text":"Use determined_month == TRUE (equivalently, !.na(weight_monthly)) filter observations determined reference months. complete analysis examples plots, see Applied Examples.","code":"# Monthly unemployment rate monthly_unemployment <- result[determined_month == TRUE, .(   unemployment_rate = sum((VD4002 == 2) * weight_monthly, na.rm = TRUE) /                       sum((VD4001 == 1) * weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]  # Monthly population monthly_pop <- result[, .(   population = sum(weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"build-once-apply-many","dir":"Articles","previous_headings":"Microdata Mensalization","what":"Build Once, Apply Many","title":"Get Started with PNADCperiods","text":"crosswalk needs identification columns, can build reuse :","code":"# Build crosswalk once from stacked data crosswalk <- pnadc_identify_periods(pnadc_stacked) saveRDS(crosswalk, \"crosswalk.rds\")  # Apply to any quarterly or annual dataset crosswalk <- readRDS(\"crosswalk.rds\") result_q1 <- pnadc_apply_periods(pnadc_2023q1, crosswalk,                                   weight_var = \"V1028\", anchor = \"quarter\") result_annual <- pnadc_apply_periods(pnadc_annual_2023, crosswalk,                                       weight_var = \"V1032\", anchor = \"year\")"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"monthly-series-from-sidra-no-microdata-needed","dir":"Articles","previous_headings":"","what":"Monthly Series from SIDRA — No Microdata Needed","title":"Get Started with PNADCperiods","text":"need aggregate monthly labor market statistics (unemployment rate, employment levels, income), can get directly IBGE’s published data without microdata. SIDRA module converts rolling quarter series published IBGE exact monthly estimates.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"quick-start","dir":"Articles","previous_headings":"Monthly Series from SIDRA — No Microdata Needed","what":"Quick Start","title":"Get Started with PNADCperiods","text":"fetch_sidra_rolling_quarters() downloads 70+ economic indicators IBGE’s SIDRA API (Tables 4093, 6390, 6392, 6399, 6906). mensalize_sidra_series() applies mensalization formula using pre-computed starting points bundled package, converting rolling quarter averages exact monthly values. output contains anomesexato (month YYYYMM format) m_* columns mensalized monthly estimates, starting March 2012.","code":"# Step 1: Fetch rolling quarter data from SIDRA API rolling_quarters <- fetch_sidra_rolling_quarters()  # Step 2: Convert to exact monthly estimates monthly <- mensalize_sidra_series(rolling_quarters)  # Step 3: Use your monthly data head(monthly[, .(anomesexato, m_popocup, m_taxadesocup)])"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"discovering-available-series","dir":"Articles","previous_headings":"Monthly Series from SIDRA — No Microdata Needed","what":"Discovering Available Series","title":"Get Started with PNADCperiods","text":"commonly used series:","code":"# Browse all 86+ available series meta <- get_sidra_series_metadata() meta[, .(series_name, description, unit)]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"visualizing-monthly-vs-rolling-quarter-data","dir":"Articles","previous_headings":"Monthly Series from SIDRA — No Microdata Needed","what":"Visualizing Monthly vs Rolling Quarter Data","title":"Get Started with PNADCperiods","text":"Since original rolling quarter data mensalized monthly estimates, comparing straightforward: full SIDRA guide — including custom starting points, methodology, COVID case study — see SIDRA Mensalization Guide.","code":"library(ggplot2)  # Prepare comparison data (merge rolling quarter and monthly estimates) plot_data <- merge(   rolling_quarters[, .(anomesexato = anomesfinaltrimmovel, rolling = taxadesocup)],   monthly[, .(anomesexato, monthly = m_taxadesocup)],   by = \"anomesexato\" )[anomesexato >= 201901 & anomesexato <= 202312]  plot_data[, date := as.Date(paste0(substr(anomesexato, 1, 4), \"-\",                                     substr(anomesexato, 5, 6), \"-01\"))]  # Reshape to long format plot_long <- melt(plot_data, id.vars = c(\"anomesexato\", \"date\"),                   variable.name = \"type\", value.name = \"rate\") plot_long[, type := factor(type,                            levels = c(\"rolling\", \"monthly\"),                            labels = c(\"Rolling Quarter\", \"Monthly\"))]  # Plot ggplot(plot_long, aes(x = date, y = rate, color = type)) +   geom_line(linewidth = 0.8) +   annotate(\"rect\", xmin = as.Date(\"2020-03-01\"), xmax = as.Date(\"2020-12-31\"),            ymin = -Inf, ymax = Inf, fill = \"red\", alpha = 0.08) +   scale_color_manual(values = c(\"Rolling Quarter\" = \"#888888\",                                 \"Monthly\" = \"#E53935\"),                      name = NULL) +   scale_x_date(date_breaks = \"6 months\", date_labels = \"%b\\n%Y\") +   scale_y_continuous(labels = function(x) paste0(x, \"%\")) +   labs(     title = \"Unemployment Rate: Monthly vs Rolling Quarter (2019-2023)\",     subtitle = \"Monthly estimates capture the true timing and magnitude of economic shocks\",     x = NULL,     y = \"Unemployment Rate (%)\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"top\",     panel.grid.minor = element_blank()   )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"improving-determination-rates","dir":"Articles","previous_headings":"","what":"Improving Determination Rates","title":"Get Started with PNADCperiods","text":"PNADC uses rotating panel household (UPA + V1014) interviewed 5 consecutive quarters, always relative month position. means birthday constraints quarter can determine month quarters — stacking data dramatically improves rates: Fortnight week rates remain low regardless stacking constraints aggregate across quarters — month benefits panel design. analyses requiring higher determination, experimental strategies make informed probabilistic assignments: strategy = \"\" confidence_threshold = 0.9, month determination improves ~97.3% fortnight ~13.5%. See PNADCperiods Works details experimental strategies Determination Rates Benchmark comprehensive results.","code":"# Build crosswalk with date bounds for experimental strategies crosswalk <- pnadc_identify_periods(pnadc, store_date_bounds = TRUE)  # Apply experimental strategies crosswalk_exp <- pnadc_experimental_periods(   crosswalk,   strategy = \"both\",   confidence_threshold = 0.9 )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"annual-data","dir":"Articles","previous_headings":"","what":"Annual Data","title":"Get Started with PNADCperiods","text":"Annual PNADC data uses different weights achieves higher determination rates (~98% month) due complete panel coverage: poverty income analysis using annual data, see Monthly Poverty Analysis Annual PNADC Data.","code":"result_annual <- pnadc_apply_periods(   pnadc_annual,   crosswalk,   weight_var = \"V1032\",   anchor = \"year\",   calibrate = TRUE,   calibration_unit = \"month\" )"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"next-steps","dir":"Articles","previous_headings":"","what":"Next Steps","title":"Get Started with PNADCperiods","text":"Download data: Download Prepare Data — complete workflow download stack quarterly microdata IBGE Analysis examples: Applied Examples — monthly vs quarterly labor market analysis, COVID unemployment, minimum wage validation SIDRA deep dive: SIDRA Mensalization Guide — full guide rolling quarter mensalization, custom starting points, methodology Annual/poverty data: Monthly Poverty Analysis — poverty analysis using annual PNADC income data Survey design: Complex Survey Design — working survey design objects variance estimation Algorithm details: PNADCperiods Works — complete methodology, experimental strategies, weight calibration Benchmarks: Determination Rates Benchmark — comprehensive performance results across data configurations Function reference: Browse Reference documentation exported functions","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/getting-started.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Get Started with PNADCperiods","text":"HECKSHER, Marcos. “Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua”. IPEA - Nota Tecnica Disoc, n. 62. Brasilia, DF: IPEA, 2020. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453 HECKSHER, M. “Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes”. IPEA - Nota Tecnica Disoc, n. 87. Brasilia, DF: IPEA, 2020. HECKSHER, Marcos. “Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril”. IPEA - Carta de Conjuntura, v. 47, p. 1-6, 2020. Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package version v0.1.0. https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"How PNADCperiods Works","text":"vignette explains PNADCperiods algorithm works: methodology behind converting Brazil’s quarterly PNADC survey sub-quarterly time series calibrated weights. practical usage, see Get Started vignette. Policy questions often require sub-quarterly precision raw PNADC data provide: exactly unemployment spike COVID-19? (March 2020 vs. January 2020) quickly labor markets respond minimum wage changes? (month--month transitions) poverty December 2023 specifically? (just Q4 2023 average) algorithm exploits PNADC’s rotating panel design birthday information recover temporal precision. identifying household actually interviewed within quarter, can construct monthly time series 97% original sample retained. vignette covers: stacked multi-quarter data improves determination ~70% ~97% core algorithm: valid interview dates, birthday constraints, UPA-panel aggregation, cross-quarter propagation, dynamic exception detection Nested identification hierarchy (months > fortnights > weeks) Experimental strategies improved fortnight/week determination Weight calibration smoothing Performance characteristics Prerequisites: vignette assumes familiarity basic PNADC concepts (UPA, rotation groups, survey weights) focuses understanding methodology rather use functions. applied examples, see Applied Examples vignette.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"why-stacked-data-matters","dir":"Articles","previous_headings":"","what":"Why Stacked Data Matters","title":"How PNADCperiods Works","text":"algorithm achieves 97% determination rate processing stacked multi-quarter data (full 55-quarter history). process quarters individually, ’ll get ~73% determination. stacking help? PNADC uses rotating panel household (UPA + V1014) interviewed 5 consecutive quarters. Crucially, household always interviewed relative month position (always month 1, always month 2, always month 3). means birthday constraints quarter can determine month quarters: Empirical determination rates number quarters stacked (real PNADC 2012-2025 data): rate peaks around 32 quarters stabilizes, boundary quarters (first 4 last 4 series) inherently lower rates due incomplete panel coverage. Recommended: Stack least 2 years (8 quarters) data calling pnadc_identify_periods() achieve >96% determination.","code":"UPA=123456, V1014=1 appears in 5 quarters:    2023-Q1: month_min=1, month_max=2 (ambiguous: Jan or Feb)   2023-Q2: month_min=1, month_max=3 (ambiguous: Apr, May, or Jun)   2023-Q3: month_min=2, month_max=2 (DETERMINED: August)  <- Birthday constraint!   2023-Q4: month_min=1, month_max=2 (ambiguous: Oct or Nov)   2024-Q1: month_min=2, month_max=3 (ambiguous: Feb or Mar)  Cross-quarter aggregation:   upa_month_min = max(1, 1, 2, 1, 2) = 2   upa_month_max = min(2, 3, 2, 2, 3) = 2  Result: ALL 5 quarters -> ref_month_in_quarter = 2 p1 <- ggplot(cumulative_det, aes(x = n_quarters, y = det_rate * 100)) +   geom_line(color = \"#2166ac\", linewidth = 1.2) +   geom_point(color = \"#2166ac\", size = 3.5) +   geom_hline(yintercept = max(cumulative_det$det_rate) * 100,              linetype = \"dashed\", color = \"#666666\", alpha = 0.7) +   annotate(\"text\",            x = max(cumulative_det$n_quarters) * 0.85,            y = max(cumulative_det$det_rate) * 100 + 1.2,            label = paste0(sprintf(\"%.1f%%\", max(cumulative_det$det_rate) * 100),                          \" (full history)\"),            color = \"#666666\", size = 3.5, hjust = 0.5) +   annotate(\"text\",            x = 2,            y = cumulative_det[n_quarters == 1, det_rate * 100] + 2,            label = paste0(sprintf(\"%.0f%%\", cumulative_det[n_quarters == 1, det_rate * 100]),                          \"\\n(single quarter)\"),            color = \"#2166ac\", size = 3, hjust = 0, vjust = 0) +   scale_x_continuous(     breaks = c(1, 10, 20, 30, 40, 50),     limits = c(0, max(cumulative_det$n_quarters) + 5)   ) +   scale_y_continuous(     breaks = seq(65, 100, by = 5),     limits = c(60, 100),     labels = function(x) paste0(x, \"%\")   ) +   labs(     title = \"Monthly Determination Rate Improves with More Quarters Stacked\",     subtitle = paste0(\"Real PNADC data (2012-\", max(quarterly_det$Ano),                       \"): Cross-quarter aggregation exploits rotating panel design\"),     x = \"Number of Quarters Stacked\",     y = \"Determination Rate\"   ) +   theme_minimal(base_size = 12) +   theme(     plot.title = element_text(face = \"bold\", size = 14),     plot.subtitle = element_text(color = \"#666666\", size = 11),     panel.grid.minor = element_blank(),     axis.title = element_text(size = 11),     plot.margin = margin(10, 20, 10, 10)   )  p1"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"the-algorithm-explained","dir":"Articles","previous_headings":"","what":"The Algorithm Explained","title":"How PNADCperiods Works","text":"reference period identification follows pipeline shared initial steps period-specific aggregation: identification nested construction — fortnights can identified month already determined, weeks fortnight determined. Months benefit cross-quarter aggregation, fortnights weeks aggregate across quarters. explains monthly determination (97%) far exceeds fortnights (9%) weeks (3%).","code":"+-----------------------------------------------------------------------------+ |                    REFERENCE PERIOD IDENTIFICATION PIPELINE                  | +-----------------------------------------------------------------------------+  INPUTS (per observation):   Year (Ano), Quarter (Trimestre), Birthday (V2008/V20081/V20082), Age (V2009)         |         v SHARED COMPUTATION (All Periods):   Step 1: Calculate valid interview Saturdays (IBGE rules)   Step 2: Apply birthday constraints to narrow date range   Step 3: Convert dates to period positions (month/fortnight/week)         |         v NESTED IDENTIFICATION (enforced by construction):    PHASE 1: MONTHS   |-- Aggregate at (UPA, V1014) level   |-- CROSS-QUARTER aggregation across ALL quarters   |-- Dynamic exception detection   +-- Determination: ~97% (55Q)                 |                 v (only if month determined)   PHASE 2: FORTNIGHTS   |-- Aggregate at (Ano, Trimestre, UPA, V1008) level   |-- NO cross-quarter aggregation   +-- Determination: ~9% (strict)                 |                 v (only if fortnight determined)   PHASE 3: WEEKS   |-- Aggregate at (Ano, Trimestre, UPA, V1008) level   |-- NO cross-quarter aggregation   +-- Determination: ~3% (strict)  OUTPUT:   ref_month_in_quarter (1-3), ref_month_yyyymm (YYYYMM)   ref_fortnight_in_quarter (1-6), ref_fortnight_yyyyff (YYYYFF)   ref_week_in_quarter (1-13), ref_week_yyyyww (YYYYWW)   determined_month, determined_fortnight, determined_week (logical flags)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"shared-computation-steps-1-3","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Shared Computation (Steps 1-3)","title":"How PNADCperiods Works","text":"following three steps computed shared across period types.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"step-1-valid-interview-saturdays-ibge-rules","dir":"Articles","previous_headings":"The Algorithm Explained > Shared Computation (Steps 1-3)","what":"Step 1: Valid Interview Saturdays (IBGE Rules)","title":"How PNADCperiods Works","text":"IBGE defines reference week belongs month least 4 days within month. Since reference weeks end Saturdays, examine Saturdays month determine valid interview dates. calculate first valid Saturday: Example Q1 2023: valid Saturday calculation defines possible interview date range quarter: - date_min = First valid Saturday Month 1 - date_max = First valid Saturday Month 3 + 21 days","code":"first_saturday_day = day of the first Saturday of the month if first_saturday_day >= 4:     use this Saturday (it has enough days in the month) else:     use the second Saturday (first_saturday_day + 7) JANUARY 2023:   Sun  Mon  Tue  Wed  Thu  Fri  SAT    1    2    3    4    5    6   [7]  <- First Saturday is day 7                                      7 >= 4? YES -> Valid! (7 days in January)  FEBRUARY 2023:   Wed  Thu  Fri  SAT  ...    1    2    3   [4]              <- First Saturday is day 4                                   4 >= 4? YES -> Valid! (4 days in February)  APRIL 2023:   SAT  Sun  Mon  Tue  ...   [1]   2    3    4              <- First Saturday is day 1                                   1 >= 4? NO -> Skip to second Saturday!   Fri  SAT  Sun  ...    7   [8]   9                   <- Use day 8 instead"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"step-2-birthday-constraints","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Step 2: Birthday Constraints","title":"How PNADCperiods Works","text":"IBGE calculates age using exact birthdate interview reference date. comparing calculated age birth year, can determine whether interview occurred person’s birthday year, narrowing possible interview date window. Example: Interview birthday Example: Interview birthday Unknown birthdays: V2008=99, V20081=99, V20082=9999, person’s birthday constrain date. However, may still determined UPA-Panel aggregation (Step 4) cross-quarter aggregation (Step 5).","code":"visit_before_birthday = (Survey_Year - Birth_Year) - Calculated_Age  If = 0: Interview was AFTER birthday (person already celebrated this year) If = 1: Interview was BEFORE birthday (birthday hasn't happened yet) Person: Born March 15, 1990 Survey Year and quarter: 2023 Q1 Calculated Age: 33  Check age: 2023 - 1990 = 33            33 - 33 = 0  -> Interview was AFTER March 15, 2023  New constraint:   date_min = max(date_min, first_Saturday_on_or_after(March 15))   date_min = max(Jan 7, March 18) = March 18  This person can only have been interviewed in MARCH (Month 3 of Q1). Person: Born February 17, 1990 Survey Year and quarter: 2023 Q1 Calculated Age: 32  Check age: 2023 - 1990 = 33            33 - 32 = 1  -> Interview was BEFORE February 17, 2023  Constraint: date_max = min(date_max, Saturday_before(birthday))             date_max = min(March 25, February 11) = February 11  This person can only have been interviewed in JANUARY or early FEBRUARY."},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"step-3-date-to-period-position","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Step 3: Date to Period Position","title":"How PNADCperiods Works","text":"Transform date window [date_min, date_max] period positions: Month positions (1, 2, 3): Boundary handling: Interviews days 1-3 month typically belong reference week started previous month. Fortnight positions (1-6): Week positions (IBGE calendar): Weeks follow IBGE calendar convention weeks run Sunday Saturday. first week month must least 4 days month. Reference months contain either 4 5 complete weeks.","code":"For date_min: if day <= 3 AND not in first month of quarter:               subtract 1 from month position  For date_max: if day <= 3:               use the month of (date - 3 days) instead fortnight_pos = (month_pos - 1) * 2 + half_of_month   where half_of_month = 1 if day <= 15, else 2"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"month-identification-pipeline-steps-4-7","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Month Identification Pipeline (Steps 4-7)","title":"How PNADCperiods Works","text":"month identification pipeline uses cross-quarter aggregation achieve ~97% determination.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"step-4-upa-panel-aggregation","dir":"Articles","previous_headings":"The Algorithm Explained > Month Identification Pipeline (Steps 4-7)","what":"Step 4: UPA-Panel Aggregation","title":"How PNADCperiods Works","text":"people UPA + V1014 interviewed together reference month. Take intersection: Example:","code":"upa_month_min = MAX of all individual month_min_pos upa_month_max = MIN of all individual month_max_pos UPA=123456, Panel V1014=1 has 3 members:  Person A: month_min=1, month_max=2 (could be Jan or Feb) Person B: month_min=1, month_max=3 (could be Jan, Feb, or Mar) Person C: month_min=2, month_max=3 (could be Feb or Mar)  Aggregation:   upa_month_min = max(1, 1, 2) = 2   upa_month_max = min(2, 3, 3) = 2  Result: min=2, max=2 -> Reference month is FEBRUARY!  Visual:               Jan    Feb    Mar Person A:     [=========] Person B:     [============] Person C:            [========] Intersection:        [==]      <- Only February satisfies all"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"step-5-cross-quarter-aggregation","dir":"Articles","previous_headings":"The Algorithm Explained > Month Identification Pipeline (Steps 4-7)","what":"Step 5: Cross-Quarter Aggregation","title":"How PNADCperiods Works","text":"Since relative month position constant across quarters, constraints quarter apply quarters: processing stacked data improves determination ~70% (single quarter) 97% (full history). cross-quarter aggregation applied fortnights weeks — even though household always relative month, specific fortnight week within month varies quarter.","code":"For each (UPA, V1014) group across ALL quarters:   upa_month_min = MAX of all month_min_pos from all quarters   upa_month_max = MIN of all month_max_pos from all quarters"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"step-6-dynamic-exception-detection","dir":"Articles","previous_headings":"The Algorithm Explained > Month Identification Pipeline (Steps 4-7)","what":"Step 6: Dynamic Exception Detection","title":"How PNADCperiods Works","text":"quarters, standard rule (first reference week least 4 days) may produce impossible results (upa_month_min > upa_month_max). algorithm detects applies alternative rule (least 3 days instead 4): Exception quarters detected automatically. Examples found 2012-2025 data: 2016q3, 2016q4, 2017q2, 2022q3, 2023q2, 2024q1.","code":"For each UPA-V1014:   1. Calculate positions using STANDARD rules (>= 4 days)   2. Also calculate using ALTERNATIVE rules (>= 3 days)   3. If standard is impossible but alternative works:      -> Flag which month needs the exception   4. Propagate: if ANY UPA in the quarter needs exception for a month,      apply to ALL observations in that quarter"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"step-7-final-assignment","dir":"Articles","previous_headings":"The Algorithm Explained > Month Identification Pipeline (Steps 4-7)","what":"Step 7: Final Assignment","title":"How PNADCperiods Works","text":"applying exceptions: upa_month_min == upa_month_max, reference month determined. Otherwise, remains NA. makes observations indeterminate (~3%)? Incomplete panel coverage: Boundary quarters (first/last 4 series) UPAs fewer 5 visits Unit non-response: Fewer responding households means fewer birthday constraints Small household sizes missing birth dates: Fewer constraints narrow month Indeterminate observations get weight_monthly = NA output (keep_all = TRUE).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"fortnight-and-week-identification","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Fortnight and Week Identification","title":"How PNADCperiods Works","text":"Fortnights weeks use shared computation (Steps 1-3) months, critical differences: 1. aggregate across quarters. household’s relative month position constant (always month 2), specific fortnight week varies quarter. Therefore constraints evaluated within quarter independently. 2. Aggregation key differs. Fortnights weeks aggregate (Ano, Trimestre, UPA, V1008) — household level within quarter — rather (UPA, V1014) across quarters. 3. Nesting enforced. fortnight can determined month already determined. week can determined fortnight already determined. Fortnight algorithm: Fortnights divide quarter 6 periods (2 per month). (Ano, Trimestre, UPA, V1008) group, aggregate fortnight positions. min == max, fortnight determined. Week algorithm: Weeks divide quarter approximately 13 periods (following IBGE Sunday-Saturday calendar). aggregation logic fortnights. Determination requires fortnight already known.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"experimental-strategies","dir":"Articles","previous_headings":"","what":"Experimental Strategies","title":"How PNADCperiods Works","text":"applications requiring larger sub-monthly samples, package provides experimental strategies via pnadc_experimental_periods() can moderately increase fortnight week determination rates. Important: Experimental strategies produce “likely” assignments based additional assumptions. intended sensitivity analysis robustness checks, replacing strict determination rigorous analysis. Key finding: Probabilistic strategy provides improvement. UPA aggregation adds essentially nothing. Choose conf=0.9 conservative analysis, conf=0.8 maximum week coverage.","code":"# Select key configurations for visualization exp_plot_data <- experimental_rates[crosswalk_id %in% c(   \"CW-FULL\", \"EXP-P08\", \"EXP-P09\" )]  exp_plot_data[, strategy_display := factor(strategy_label,   levels = c(\"Strict baseline\",              \"Probabilistic (conf=0.8)\",              \"Probabilistic (conf=0.9)\"),   labels = c(\"Strict baseline\",              \"Probabilistic (conf=0.8)\",              \"Probabilistic (conf=0.9)\") )]  # Reshape to long format exp_plot_data_long <- melt(exp_plot_data,   id.vars = \"strategy_display\",   measure.vars = c(\"det_month_overall\", \"det_fortnight_overall\", \"det_week_overall\"),   variable.name = \"period\",   value.name = \"rate\" )  exp_plot_data_long[, period := factor(period,   levels = c(\"det_month_overall\", \"det_fortnight_overall\", \"det_week_overall\"),   labels = c(\"Month\", \"Fortnight\", \"Week\") )]  exp_plot_data_long[, rate_pct := rate * 100]  # Create bar chart p_exp <- ggplot(exp_plot_data_long,                 aes(x = period, y = rate_pct, fill = strategy_display)) +   geom_col(position = \"dodge\", width = 0.7) +   geom_text(aes(label = sprintf(\"%.1f%%\", rate_pct)),             position = position_dodge(width = 0.7),             vjust = -0.5, size = 3) +   labs(     title = \"Determination Rates: Strict vs Probabilistic Strategies\",     subtitle = \"8-quarter benchmark (2019-2020), 3.76M observations\",     x = NULL,     y = \"Determination Rate (%)\",     fill = \"Strategy\"   ) +   scale_y_continuous(     limits = c(0, 105),     breaks = seq(0, 100, by = 20),     labels = function(x) paste0(x, \"%\")   ) +   scale_fill_manual(values = c(     \"Strict baseline\" = \"#D55E00\",     \"Probabilistic (conf=0.8)\" = \"#0072B2\",     \"Probabilistic (conf=0.9)\" = \"#009E73\"   )) +   theme_minimal(base_size = 12) +   theme(     plot.title = element_text(face = \"bold\", size = 14),     plot.subtitle = element_text(color = \"#666666\", size = 11),     legend.position = \"bottom\",     panel.grid.major.x = element_blank(),     panel.grid.minor = element_blank(),     axis.title = element_text(size = 11),     plot.margin = margin(10, 20, 10, 10)   )  p_exp"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"probabilistic-strategy","dir":"Articles","previous_headings":"Experimental Strategies","what":"Probabilistic Strategy","title":"How PNADCperiods Works","text":"interview date range spans exactly 2 fortnights 2 weeks, probabilistic strategy assigns period containing midpoint date range. Example: probabilistic assignments relatively low confidence (55-60%), meaning ’re slightly better coin flip. Consider filtering higher confidence values (>=0.7) reliable analysis.","code":"For each undetermined observation with date range [date_min, date_max]:   1. Check if range spans exactly 2 periods   2. Calculate the midpoint: date_midpoint = (date_min + date_max) / 2   3. Assign the period containing the midpoint   4. Calculate confidence: based on proportion of range in assigned period Person with date range: March 10 - March 20 (within Q1 2023) Fortnight boundary: March 15/16  Days in fortnight 5 (Mar 1-15):  10, 11, 12, 13, 14, 15 = 6 days Days in fortnight 6 (Mar 16-31): 16, 17, 18, 19, 20     = 5 days  Date midpoint: March 15 -> Falls in fortnight 5 Confidence: 6/11 ~ 0.55 (55% probability of fortnight 5) # Build standard crosswalk (store_date_bounds must be TRUE for experimental) crosswalk <- pnadc_identify_periods(pnadc_stacked, store_date_bounds = TRUE)  # Apply probabilistic strategy with conservative threshold crosswalk_prob <- pnadc_experimental_periods(   crosswalk,   strategy = \"probabilistic\",   confidence_threshold = 0.9,   verbose = TRUE )  # Check results — experimental assigns determined_probable_* flags crosswalk_prob[, .(   strict_fortnight = sum(determined_fortnight),   probable_fortnight = sum(determined_probable_fortnight, na.rm = TRUE),   strict_week = sum(determined_week),   probable_week = sum(determined_probable_week, na.rm = TRUE) )]  # Filter to strictly determined only (excluding probabilistic) strict_only <- crosswalk_prob[probabilistic_assignment == FALSE]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"upa-aggregation-strategy","dir":"Articles","previous_headings":"Experimental Strategies","what":"UPA Aggregation Strategy","title":"How PNADCperiods Works","text":"UPA aggregation strategy exploits remarkable empirical finding: 100% UPA homogeneity fortnights weeks across 55 quarters PNADC data (9.6 million household-quarter observations). Whenever fortnight week strictly determined household UPA, strictly determined households UPA period. Despite finding, UPA aggregation provides essentially zero improvement comprehensive testing. UPAs already households determined (undetermined) strict algorithm. strategy create determinations none exist — can propagate existing ones within UPAs. Recommendation: Use strategy = \"probabilistic\" practical improvements. UPA aggregation available methodological research via strategy = \"upa_aggregation\" strategy = \"\".","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"output-columns","dir":"Articles","previous_headings":"Experimental Strategies","what":"Output Columns","title":"How PNADCperiods Works","text":"pnadc_experimental_periods() adds following columns crosswalk:","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"caveats","dir":"Articles","previous_headings":"Experimental Strategies","what":"Caveats","title":"How PNADCperiods Works","text":"Low confidence assignments: Mean confidence ~0.58. Many assignments marginally better random. Consider filtering confidence >= 0.7. Neither replaces strict determination: rigorous causal analysis official statistics, strict determination preferred. Use probabilistic_assignment flag: Filter crosswalk[probabilistic_assignment == FALSE] get strict-assignments sensitivity analysis.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"weight-calibration","dir":"Articles","previous_headings":"","what":"Weight Calibration","title":"How PNADCperiods Works","text":"sub-quarterly aggregate estimates, need appropriately calibrated survey weights. calibrate = TRUE pnadc_apply_periods(), package:","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"fetches-monthly-population-from-sidra-api","dir":"Articles","previous_headings":"Weight Calibration","what":"1. Fetches Monthly Population from SIDRA API","title":"How PNADCperiods Works","text":"SIDRA (table 6022) provides moving-quarter population estimates (thousands), exact monthly values: package shifts values align center month. Boundary months (Jan 2012, latest month) extrapolated via quadratic regression.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"applies-hierarchical-rake-weighting","dir":"Articles","previous_headings":"Weight Calibration","what":"2. Applies Hierarchical Rake Weighting","title":"How PNADCperiods Works","text":"Calibration cells nested: number cell levels depends sample size granularity:","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"calibrates-to-monthly-population-totals","dir":"Articles","previous_headings":"Weight Calibration","what":"3. Calibrates to Monthly Population Totals","title":"How PNADCperiods Works","text":"Final scaling ensures monthly weighted totals match SIDRA population (~206 million average).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"weight-smoothing","dir":"Articles","previous_headings":"Weight Calibration","what":"Weight Smoothing","title":"How PNADCperiods Works","text":"smooth parameter pnadc_apply_periods() (default: FALSE) applies rolling mean cell-level calibration adjustments, reducing artificial quarterly patterns weights. enable smoothing (smooth = TRUE): Computing time series publication visualization Analyzing gradual trends (employment growth, demographic shifts) keep smoothing disabled (default): Analyzing rapid shocks (COVID-19 lockdown, sudden policy changes) Studying immediate month--month changes Comparing specific months across years","code":"# Monthly calibration (default) result <- pnadc_apply_periods(pnadc_stacked, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\",                                calibrate = TRUE)  # With smoothing for trend analysis result_smooth <- pnadc_apply_periods(pnadc_stacked, crosswalk,                                       weight_var = \"V1028\",                                       anchor = \"quarter\",                                       smooth = TRUE)  # Fortnight calibration (simplified raking) result_fn <- pnadc_apply_periods(pnadc_stacked, crosswalk,                                   weight_var = \"V1028\",                                   anchor = \"quarter\",                                   calibration_unit = \"fortnight\")"},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"handling-indeterminate-observations","dir":"Articles","previous_headings":"Weight Calibration","what":"Handling Indeterminate Observations","title":"How PNADCperiods Works","text":"default (keep_all = TRUE), input rows returned. Indeterminate observations get weight_monthly = NA:","code":"# All rows returned (default keep_all = TRUE) result <- pnadc_apply_periods(pnadc_stacked, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\")  # Filter to determined observations for analysis monthly_pop <- result[!is.na(weight_monthly), .(   population = sum(weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"benchmarks","dir":"Articles","previous_headings":"Performance","what":"Benchmarks","title":"How PNADCperiods Works","text":"Period Identification (pnadc_identify_periods()): Experimental Strategies (pnadc_experimental_periods()):","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"determination-rates-by-year","dir":"Articles","previous_headings":"Performance","what":"Determination Rates by Year","title":"How PNADCperiods Works","text":"Based real PNADC data (2012-2025, 55 quarters, 28.4M observations): boundary quarters lower rates: PNADC’s rotating panel (5 visits 5 quarters), boundary quarters consecutive series include UPA-V1014 groups fewer 5 visits data. example, dataset 9 consecutive quarters, 5th quarter full panel utilization — households 1st 5th visit complete histories.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"tips-and-best-practices","dir":"Articles","previous_headings":"","what":"Tips and Best Practices","title":"How PNADCperiods Works","text":"Stack data first: Load 2+ years calling pnadc_identify_periods() maximize determination rate. Validate inputs: Use validate_pnadc() catch missing columns early. Check rates year: Rates ~96-99% 2013-2019. Lower rates suggest data issues boundary effects. Handle indeterminate observations: Use keep_all = TRUE (default) preserve observations; indeterminate ones get NA weights. Verify population totals: Monthly weighted sums approximate Brazil’s population (~206 million 2024).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"further-reading","dir":"Articles","previous_headings":"","what":"Further Reading","title":"How PNADCperiods Works","text":"Get Started - Basic workflow using PNADCperiods Applied Examples - COVID, recession, minimum wage validation Annual Poverty Analysis - Monthly poverty annual PNADC data Complex Survey Design - Standard errors confidence intervals IBGE PNADC Documentation Package function reference: ?pnadc_identify_periods, ?pnadc_apply_periods Source code: GitHub repository","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/how-it-works.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"How PNADCperiods Works","text":"HECKSHER, Marcos. “Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua”. IPEA - Nota Tecnica Disoc, n. 62. Brasilia, DF: IPEA, 2020. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453 HECKSHER, M. “Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes”. IPEA - Nota Tecnica Disoc, n. 87. Brasilia, DF: IPEA, 2020. HECKSHER, Marcos. “Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril”. IPEA - Carta de Conjuntura, v. 47, p. 1-6, 2020. Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package version v0.1.0. https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"Brazil’s Continuous National Household Sample Survey (PNADC) publishes labor market indicators rolling (moving) quarters — 3-month moving averages published “quarter” shares 2 months neighbors. smoothing hides short-term dynamics: turning points delayed, seasonal patterns distorted, international comparison becomes difficult. PNADCperiods package includes SIDRA mensalization module recovers exact monthly estimates rolling quarter data. vignette explains use .","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"why-rolling-quarters-are-problematic","dir":"Articles","previous_headings":"Overview","what":"Why Rolling Quarters Are Problematic","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"published “quarter” actually 3-month moving average: “2019-Q1” = average Jan, Feb, Mar 2019 “2019-Q2” = average Feb, Mar, Apr 2019 “2019-Q3” = average Mar, Apr, May 2019 unemployment jumps sharply single month, rolling quarter spreads spike across multiple overlapping periods. mensalization algorithm inverts averaging process recover true monthly values.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"quick-start","dir":"Articles","previous_headings":"","what":"Quick Start","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"’s ! now monthly estimates starting January 2012. fetch_sidra_rolling_quarters() downloaded 86+ economic indicators IBGE’s SIDRA API mensalize_sidra_series() applied mensalization formula using pre-computed starting points (bundled package) result data.table one row per month m_* columns mensalized series","code":"library(PNADCperiods)  # Step 1: Fetch rolling quarter data from SIDRA API rolling_quarters <- fetch_sidra_rolling_quarters()  # Step 2: Convert to monthly estimates monthly <- mensalize_sidra_series(rolling_quarters)  # Step 3: Use your monthly data! head(monthly[, .(anomesexato, m_popocup, m_taxadesocup)])"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"understanding-the-output","dir":"Articles","previous_headings":"","what":"Understanding the Output","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"mensalized output contains: anomesexato: Month identifier (YYYYMM format, e.g., 201903 = March 2019) m_* columns: Mensalized (monthly) estimates series Price indices: ipca100dez1993, inpc100dez1993 (passed deflation) Key series include: Rate series (like m_taxadesocup) derived mensalized level series compute_derived = TRUE (default). computed ratios mensalized levels, directly mensalized rolling quarter rates.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"discovering-available-series","dir":"Articles","previous_headings":"Understanding the Output","what":"Discovering Available Series","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"Use get_sidra_series_metadata() explore 86+ available series: metadata uses hierarchical taxonomy: theme (top level, e.g., “labor_market”), theme_category (e.g., “employment_type”), optionally subcategory (e.g., “levels”, “rates”).","code":"meta <- get_sidra_series_metadata()  # View series organized by theme meta[, .N, by = .(theme, theme_category)]  # Filter to specific theme categories meta[theme_category == \"employment_type\", .(series_name, description)]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"data-flow","dir":"Articles","previous_headings":"","what":"Data Flow","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"mensalization process follows three-step pipeline:","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"step-1-fetching-rolling-quarter-data","dir":"Articles","previous_headings":"Data Flow","what":"Step 1: Fetching Rolling Quarter Data","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"fetch_sidra_rolling_quarters() downloads data five SIDRA tables: Key columns: anomesfinaltrimmovel (end month rolling quarter, YYYYMM), mesnotrim (month position 1/2/3), plus one column per series.","code":"rq <- fetch_sidra_rolling_quarters(verbose = TRUE)  # Inspect structure dim(rq) names(rq)[1:20]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"step-2-the-mensalization-transform","dir":"Articles","previous_headings":"Data Flow","what":"Step 2: The Mensalization Transform","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"row count approximately (one per month), meaning changes “rolling quarter ending month X” “exact estimate month X”.","code":"monthly <- mensalize_sidra_series(rq, verbose = TRUE)  # Compare dimensions cat(\"Rolling quarters:\", nrow(rq), \"rows\\n\") cat(\"Monthly data:\", nrow(monthly), \"rows\\n\")"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"step-3-using-monthly-estimates","dir":"Articles","previous_headings":"Data Flow","what":"Step 3: Using Monthly Estimates","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"","code":"# --- VIGNETTE CODE: plot-unemployment --- library(ggplot2)  monthly[, date := as.Date(paste0(substr(anomesexato, 1, 4), \"-\",                                   substr(anomesexato, 5, 6), \"-01\"))]  ggplot(monthly, aes(x = date, y = m_taxadesocup)) +   geom_line(color = \"#1976D2\", linewidth = 0.8) +   labs(title = \"Monthly Unemployment Rate\",        x = NULL, y = \"Unemployment Rate (%)\")"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"population-data-for-weighting","dir":"Articles","previous_headings":"Data Flow","what":"Population Data for Weighting","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"analyses requiring monthly population estimates separately: Returns data.table ref_month_yyyymm m_populacao columns.","code":"pop <- fetch_monthly_population() head(pop)"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"fetching-by-theme","dir":"Articles","previous_headings":"Working with Series","what":"Fetching by Theme","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"Instead fetching 86+ series, filter theme theme category:","code":"# Only employment type series employment <- fetch_sidra_rolling_quarters(theme_category = \"employment_type\")  # Only wage mass series wages <- fetch_sidra_rolling_quarters(theme_category = \"wage_mass\")  # Only labor market theme (includes participation, unemployment, employment types, etc.) labor <- fetch_sidra_rolling_quarters(theme = \"labor_market\")"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"fetching-specific-series","dir":"Articles","previous_headings":"Working with Series","what":"Fetching Specific Series","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"maximum efficiency, request series need:","code":"# Only unemployment-related series unemp <- fetch_sidra_rolling_quarters(   series = c(\"popdesocup\", \"taxadesocup\", \"popnaforca\") )"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"excluding-derived-series","dir":"Articles","previous_headings":"Working with Series","what":"Excluding Derived Series","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"series rates computed series. fetch “base” series:","code":"# Exclude computed rates (only population and income levels) base_only <- fetch_sidra_rolling_quarters(exclude_derived = TRUE)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"selecting-output-columns","dir":"Articles","previous_headings":"Working with Series","what":"Selecting Output Columns","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"mensalization, select columns needed:","code":"monthly <- mensalize_sidra_series(rq)  # Select specific series labor_market <- monthly[, .(   anomesexato,   employed = m_popocup,   unemployed = m_popdesocup,   unemp_rate = m_taxadesocup,   participation = m_taxapartic )]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"the-mensalization-methodology","dir":"Articles","previous_headings":"","what":"The Mensalization Methodology","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"section can skipped users just need results.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"the-core-concept","dir":"Articles","previous_headings":"The Mensalization Methodology","what":"The Core Concept","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"Rolling quarters 3-month moving averages. denote true monthly value month tt yty_t, rolling quarter value xtx_t : xt=yt−2+yt−1+yt3x_t = \\frac{y_{t-2} + y_{t-1} + y_t}{3} mensalization algorithm inverts relationship recover yty_t sequence xtx_t values.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"the-mensalization-formula","dir":"Articles","previous_headings":"The Mensalization Methodology","what":"The Mensalization Formula","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"Step 1: Compute first differences d3t=xt−xt−1d3_t = x_t - x_{t-1} Step 2: Identify month position (mesnotrim) month position within quarter: - Position 1: Jan, Apr, Jul, Oct - Position 2: Feb, May, Aug, Nov - Position 3: Mar, Jun, Sep, Dec Step 3: Cumulative sum position position separately, compute cumulative sum first differences, starting calibrated “starting point” y0y_0: yt=y0+∑s∈position,s≤td3sy_t = y_0 + \\sum_{s \\\\text{position}, s \\leq t} d3_s","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"the-role-of-starting-points-y_0","dir":"Articles","previous_headings":"The Mensalization Methodology","what":"The Role of Starting Points (y0y_0)","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"starting point y0y_0 crucial. determines level subsequent monthly estimates. package includes pre-computed starting points 53 series, calibrated stable 2013-2019 period. Starting points computed : Processing PNADC microdata get “true” monthly aggregates (zz values) Comparing rolling quarters Finding y0y_0 makes y0+cumsum(d3)y_0 + \\text{cumsum}(d3) match microdata","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"assumptions-and-limitations","dir":"Articles","previous_headings":"The Mensalization Methodology","what":"Assumptions and Limitations","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"Monthly values within position evolve smoothly calibration period (2013-2019) reflects “normal” conditions recover intra-month variation Starting points calibrated national totals (regional breakdowns)","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"api-caching","dir":"Articles","previous_headings":"Practical Considerations","what":"API Caching","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"package caches SIDRA API responses memory R session: cache persists call clear_sidra_cache() restart R.","code":"# First call: fetches from API (~10 seconds) rq1 <- fetch_sidra_rolling_quarters()  # Second call with use_cache = TRUE: uses cached data (instant) rq2 <- fetch_sidra_rolling_quarters(use_cache = TRUE)  # Clear all cached data (force fresh fetch on next call) clear_sidra_cache()"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"common-errors","dir":"Articles","previous_headings":"Practical Considerations","what":"Common Errors","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"","code":"# Check if series exists meta <- get_sidra_series_metadata() \"taxadesocup\" %in% meta$series_name  # TRUE"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"data-quality-notes","dir":"Articles","previous_headings":"Practical Considerations","what":"Data Quality Notes","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"COVID-19 disruptions (2020): IBGE suspended -person interviews pandemic. indicators show unusual patterns 2020-Q2. CNPJ series availability: Series based CNPJ registration (empregadorcomcnpj, contapropriacomcnpj, etc.) available October 2015, V4019 introduced.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"custom-starting-points","dir":"Articles","previous_headings":"","what":"Custom Starting Points","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"users calibrated PNADC microdata. Use bundled starting points (default) unless: series isn’t bundled — Custom variable definitions Different calibration period — Non-standard reference period Regional breakdown — State metro-area mensalization","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"option-a-all-in-one-function","dir":"Articles","previous_headings":"Custom Starting Points","what":"Option A: All-in-One Function","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"","code":"# Load your stacked PNADC microdata (with pnadc_apply_periods weights) stacked <- readRDS(\"my_calibrated_pnadc.rds\")  # Compute starting points custom_y0 <- compute_starting_points_from_microdata(   data = stacked,   calibration_start = 201301L,   calibration_end = 201912L,   verbose = TRUE )  # Use custom starting points monthly <- mensalize_sidra_series(rq, starting_points = custom_y0)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"option-b-step-by-step","dir":"Articles","previous_headings":"Custom Starting Points","what":"Option B: Step-by-Step","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"CNPJ-based series automatically use later calibration period (2016-2019) use_series_specific_periods = TRUE (default compute_series_starting_points()).","code":"# Step 1: Build crosswalk and calibrate crosswalk <- pnadc_identify_periods(stacked) calibrated <- pnadc_apply_periods(   stacked, crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibration_unit = \"month\" )  # Step 2: Compute z_ aggregates (monthly totals from microdata) z_agg <- compute_z_aggregates(calibrated)  # Step 3: Fetch rolling quarters for comparison rq <- fetch_sidra_rolling_quarters()  # Step 4: Compute starting points y0 <- compute_series_starting_points(   monthly_estimates = z_agg,   rolling_quarters = rq,   calibration_start = 201301L,   calibration_end = 201912L )  # Step 5: Use custom starting points result <- mensalize_sidra_series(rq, starting_points = y0)"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"validating-custom-starting-points","dir":"Articles","previous_headings":"Custom Starting Points","what":"Validating Custom Starting Points","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"","code":"bundled <- pnadc_series_starting_points  # Merge and compare comp <- merge(custom_y0, bundled,               by = c(\"series_name\", \"mesnotrim\"),               suffixes = c(\"_custom\", \"_bundled\"))  comp[, rel_diff := abs(y0_custom - y0_bundled) / abs(y0_bundled) * 100] comp[rel_diff > 1]  # Flag series with >1% difference"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"case-study-covid-19-unemployment","dir":"Articles","previous_headings":"","what":"Case Study: COVID-19 Unemployment","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"quickly unemployment rise COVID-19 hit Brazil? Rolling quarter data obscures dynamics. Monthly estimates reveal exact timing. Key findings monthly estimates: Exact peak timing: Monthly data pinpoints peak month, rolling quarters show gradual rise Speed impact: monthly series reveals sharp spike rolling quarters smooth 3+ months Recovery dynamics: Monthly estimates show pauses reversals recovery hidden quarterly averages","code":"# --- VIGNETTE CODE: covid-analysis --- # Fetch all series and mensalize rq <- fetch_sidra_rolling_quarters() monthly <- mensalize_sidra_series(rq)  # Filter to COVID period covid_period <- monthly[anomesexato >= 201901 & anomesexato <= 202212]  # Create date column covid_period[, date := as.Date(paste0(   substr(anomesexato, 1, 4), \"-\",   substr(anomesexato, 5, 6), \"-01\" ))]  # Find peak peak_month <- covid_period[which.max(m_taxadesocup)] cat(\"Peak unemployment:\", peak_month$m_taxadesocup, \"% in\",     format(peak_month$date, \"%B %Y\"), \"\\n\")"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"series-naming-conventions","dir":"Articles","previous_headings":"","what":"Series Naming Conventions","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"complete catalog, use get_sidra_series_metadata():","code":"meta <- get_sidra_series_metadata()  # Filter by theme category meta[theme_category == \"employment_type\", .(series_name, description)]  # Filter by theme and pattern meta[theme == \"labor_market\" & grepl(\"taxa|nivel\", series_name),      .(series_name, description)]"},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"function-reference","dir":"Articles","previous_headings":"","what":"Function Reference","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"Bundled data: pnadc_series_starting_points — pre-computed y0y_0 53 series x 3 month positions (calibration period: 2013-2019).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"HECKSHER, Marcos. “Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua”. IPEA - Nota Tecnica Disoc, n. 62. Brasilia, DF: IPEA, 2020. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453 HECKSHER, M. “Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes”. IPEA - Nota Tecnica Disoc, n. 87. Brasilia, DF: IPEA, 2020. HECKSHER, Marcos. “Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril”. IPEA - Carta de Conjuntura, v. 47, p. 1-6, 2020. Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package version v0.1.0. https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/articles/sidra-mensalization.html","id":"further-reading","dir":"Articles","previous_headings":"","what":"Further Reading","title":"From Rolling Quarters to Monthly Estimates: SIDRA Mensalization Guide","text":"vignette(\"getting-started\") — Setting PNADC microdata analysis vignette(\"--works\") — period identification algorithm vignette(\"applied-examples\") — Applied research examples IBGE SIDRA API: https://sidra.ibge.gov.br/ Package repository: https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Rogerio Barbosa. Author, maintainer.            R package, dashboard, website Marcos Hecksher. Author.            Mensalization methodology","code":""},{"path":"https://antrologos.github.io/PNADCperiods/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Barbosa R, Hecksher M (2026). PNADCperiods: Identify Reference Periods Brazil's PNADC Survey Data. R package version 0.1.0, https://github.com/antrologos/PNADCperiods. Hecksher M (2020). “Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua.” Nota Tecnica Disoc 62, IPEA, Brasilia, DF. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453. Hecksher M (2020). “Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes.” Nota Tecnica Disoc 87, IPEA, Brasilia, DF. Hecksher M (2020). “Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril.” IPEA - Carta de Conjuntura, 47, 1-6.","code":"@Manual{,   title = {PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data},   author = {Rogerio J. Barbosa and Marcos Hecksher},   year = {2026},   note = {R package version 0.1.0},   url = {https://github.com/antrologos/PNADCperiods}, } @TechReport{,   title = {Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua},   author = {Marcos Hecksher},   year = {2020},   institution = {IPEA},   type = {Nota Tecnica Disoc},   number = {62},   address = {Brasilia, DF},   url = {https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453}, } @TechReport{,   title = {Cinco meses de perdas de empregos e simulacao de um incentivo a contratacoes},   author = {Marcos Hecksher},   year = {2020},   institution = {IPEA},   type = {Nota Tecnica Disoc},   number = {87},   address = {Brasilia, DF}, } @Article{,   title = {Mercado de trabalho: A queda da segunda quinzena de marco, aprofundada em abril},   author = {Marcos Hecksher},   year = {2020},   journal = {IPEA - Carta de Conjuntura},   volume = {47},   pages = {1-6}, }"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"project-overview","dir":"","previous_headings":"","what":"Project Overview","title":"CLAUDE.md","text":"R package (PNADCperiods) converts Brazil’s quarterly PNADC survey data sub-quarterly time series (monthly, fortnightly, weekly) optional weight calibration. Authors: Marcos Hecksher & Rogerio Barbosa Repository: https://github.com/antrologos/PNADCperiods","code":""},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"quick-reference","dir":"","previous_headings":"","what":"Quick Reference","title":"CLAUDE.md","text":"","code":"library(PNADCperiods) crosswalk <- pnadc_identify_periods(pnadc_stacked) result <- pnadc_apply_periods(pnadc_2023, crosswalk, weight_var = \"V1028\", anchor = \"quarter\")"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"required-variables","dir":"","previous_headings":"Quick Reference","what":"Required Variables","title":"CLAUDE.md","text":"Identification: Ano, Trimestre, UPA, V1008, V1014, V2008, V20081, V20082, V2009 Calibration: add V1028/V1032, UF, posest, posest_sxi","code":""},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"determination-rates","dir":"","previous_headings":"Quick Reference","what":"Determination Rates","title":"CLAUDE.md","text":"Always use stacked multi-quarter data best month determination rate.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"development-workflow","dir":"","previous_headings":"","what":"Development Workflow","title":"CLAUDE.md","text":"","code":"devtools::document(\"PNADCperiods\")  # Update NAMESPACE and man/ devtools::check(\"PNADCperiods\")     # R CMD check devtools::test(\"PNADCperiods\")      # Run tests devtools::install(\"PNADCperiods\", dependencies = FALSE)  # Install locally pkgdown::build_site(\"PNADCperiods\")  # Rebuild docs locally"},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"github-pages-deployment","dir":"","previous_headings":"Development Workflow","what":"GitHub Pages Deployment","title":"CLAUDE.md","text":"pkgdown site automatically publishes master branch via GitHub Actions. update online documentation: GitHub Actions workflow triggers push master automatically deploys GitHub Pages. Site URL: https://antrologos.github.io/PNADCperiods/","code":"cd \"D:\\Dropbox\\Artigos\\mensalizacao_pnad\\PNADCperiods\" pkgdown::build_site()  # Build locally first (optional - verifies it works) git add . git commit -m \"Update documentation\" git push origin master  # Push to master - site rebuilds automatically via GitHub Actions"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"algorithm-summary","dir":"","previous_headings":"","what":"Algorithm Summary","title":"CLAUDE.md","text":"Calculate valid interview Saturdays (IBGE timing rules) Apply birthday constraints narrow date range Convert dates month/fortnight/week positions Aggregate constraints UPA-panel level across quarters (months ) Dynamic exception detection edge cases Final determination: min == max → determined Critical: Months aggregate .(UPA, V1014) across quarters. Fortnights/weeks aggregate .(Ano, Trimestre, UPA, V1008) within quarter .","code":""},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"weight-calibration","dir":"","previous_headings":"Algorithm Summary","what":"Weight Calibration","title":"CLAUDE.md","text":"time periods calibrate FULL Brazilian population (divided). Hierarchical raking simplified sparse data:","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"shell-environment-critical","dir":"","previous_headings":"Important Notes for Claude Code","what":"Shell Environment (CRITICAL)","title":"CLAUDE.md","text":"Claude Code uses Unix bash shell even Windows. shell /usr/bin/bash, Windows CMD PowerShell. Always use Unix commands, Windows commands: Using Windows commands causes: Exit code 127: command found","code":""},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"running-r-scripts-on-windows","dir":"","previous_headings":"Important Notes for Claude Code","what":"Running R Scripts on Windows","title":"CLAUDE.md","text":"R location: C:\\Program Files\\R\\R-4.5.0\\bin\\Rscript.exe run R scripts command line: NEVER use -e flag complex R code - causes segfaults.","code":"\"C:\\\\Program Files\\\\R\\\\R-4.5.0\\\\bin\\\\Rscript.exe\" script.R # WRONG Rscript -e \"complex code...\"  # CORRECT - write to file first # 1. Write script to temp.R # 2. Run: \"C:\\\\Program Files\\\\R\\\\R-4.5.0\\\\bin\\\\Rscript.exe\" temp.R # 3. Clean up: rm temp.R"},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"data-quality-rules","dir":"","previous_headings":"Important Notes for Claude Code","what":"Data Quality Rules","title":"CLAUDE.md","text":"NEVER use simulated placeholder data vignettes, figures, examples. figures analyses must use real PNADC data real official statistics. external validation data needed (e.g., IBGE official poverty estimates), fetch official sources clearly state validation requires user-provided data. NEVER use “Expected output” sections vignettes documentation. code examples either: 1. Show actual outputs pre-computed real data (eval=FALSE chunks), 2. executable real data (eval=TRUE chunks) output shown (e.g., depends user’s data), omit output section entirely rather showing hypothetical results.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"git-repository-location","dir":"","previous_headings":"Important Notes for Claude Code","what":"Git Repository Location","title":"CLAUDE.md","text":"CRITICAL: git repository inside package directory, project root. Always use package directory git commands: Common git errors using wrong directory: - Exit code 128: fatal: git repository - Exit code 129: warning: git repository","code":"D:\\Dropbox\\Artigos\\mensalizacao_pnad\\          # Project root (NOT a git repo) └── PNADCperiods\\                            # Git repository is HERE     ├── .git\\     ├── R\\     ├── tests\\     └── ... # WRONG - causes exit codes 128/129 cd \"D:\\Dropbox\\Artigos\\mensalizacao_pnad\" && git status  # CORRECT cd \"D:\\Dropbox\\Artigos\\mensalizacao_pnad\\PNADCperiods\" && git status"},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"common-issues","dir":"","previous_headings":"Important Notes for Claude Code","what":"Common Issues","title":"CLAUDE.md","text":"Low determination rate → Stack 2+ years data Missing columns → Use validate_pnadc() check SIDRA API errors → Check internet; API rate limits Git errors (exit 128/129) → Use PNADCperiods/ directory, project root Dropbox file locking → devtools::document() fails “Invalid argument” error writing vignettes, pause Dropbox sync. vignettes purl = FALSE prevent .R file creation, Dropbox can still interfere.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"local-data-paths-rogerios-machine","dir":"","previous_headings":"Important Notes for Claude Code","what":"Local Data Paths (Rogerio’s machine)","title":"CLAUDE.md","text":"File naming conventions: - Quarterly: pnadc_2019-1q.fst, pnadc_2019-2q.fst, etc. - Annual: pnadc_2019_visita1.fst, pnadc_2020_visita5.fst, etc. Visit selection annual data: - 2015-2019: Visit 1 - 2020-2021: Visit 5 (COVID period - visit 1 available) - 2022-2024: Visit 1","code":"D:/Dropbox/Bancos_Dados/PNADC/ ├── Trimestral/Dados/           # Quarterly data (pnadc_YYYY-Nq.fst) └── Anual/visitas/              # Annual visit data (pnadc_YYYY_visitaN.fst)"},{"path":"https://antrologos.github.io/PNADCperiods/CLAUDE.html","id":"vignette-precompute-scripts","dir":"","previous_headings":"Important Notes for Claude Code","what":"Vignette Precompute Scripts","title":"CLAUDE.md","text":"CRITICAL: Vignette precompute scripts outputs must inside package folder. Convention: - Scripts: code/precompute_<vignette_name>.R code/generate_<vignette_name>_figures.R - Outputs: output/vignette/<vignette_name>_*.rds|txt|png - Figures copied package: PNADCperiods/vignettes/figures/<vignette_name>/","code":"D:\\Dropbox\\Artigos\\mensalizacao_pnad\\ ├── code\\                              # Precompute scripts go HERE │   ├── precompute_getting_started.R │   ├── precompute_download_prepare.R │   ├── generate_how_it_works_figures.R │   └── ... ├── output\\vignette\\                   # Precomputed outputs go HERE │   ├── figures\\                       # Generated figures │   ├── tables\\                        # Generated tables │   ├── getting_started_crosswalk.rds  # Saved R objects │   └── *.txt                          # Text outputs for vignettes └── PNADCperiods\\                      # Package folder (git repo)     └── vignettes\\                     # Only .Rmd files and static assets"},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"pnadcperiods","dir":"","previous_headings":"","what":"Identify Reference Periods in Brazil's PNADC Survey Data","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Convert Brazil’s quarterly PNADC survey data sub-quarterly time series (monthly, fortnightly, weekly) mensalize IBGE SIDRA aggregate series.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"","code":"devtools::install_github(\"antrologos/PNADCperiods\")"},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"main-features","dir":"","previous_headings":"","what":"Main Features","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Microdata mensalization: Identify reference months, fortnights, weeks PNADC microdata SIDRA mensalization: Convert 86+ rolling quarterly IBGE series exact monthly values Weight calibration: Hierarchical raking IBGE population totals ~97% monthly determination full data stacking; experimental strategies improve fortnight/week rates ","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"microdata-mensalization","dir":"","previous_headings":"Basic Usage","what":"Microdata Mensalization","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"","code":"library(PNADCperiods)  # Build crosswalk identifying reference periods crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply to data with weight calibration result <- pnadc_apply_periods(pnadc, crosswalk, weight_var = \"V1028\", anchor = \"quarter\")"},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"sidra-series-mensalization","dir":"","previous_headings":"Basic Usage","what":"SIDRA Series Mensalization","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"","code":"# Fetch rolling quarterly data from SIDRA rolling <- fetch_sidra_rolling_quarters(theme = \"labor_market\")  # Convert to exact monthly series monthly <- mensalize_sidra_series(rolling)"},{"path":[]},{"path":[]},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"documentation","dir":"","previous_headings":"","what":"Documentation","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Getting Started SIDRA Mensalization Works Applied Examples Full Reference","code":""},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"authors","dir":"","previous_headings":"","what":"Authors","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Rogerio J. Barbosa (Ceres-IESP/UERJ) – R package, dashboard, website Marcos Hecksher (Ipea) – Mensalization methodology","code":""},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"credits","dir":"","previous_headings":"","what":"Credits","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Original PNADC data collected Brazilian Institute Geography Statistics (IBGE). mensalization methodology developed Marcos Hecksher (Ipea) — see Hecksher (2020, IPEA Nota Tecnica Disoc n. 62 n. 87; Carta de Conjuntura v. 47). R package, interactive dashboard, documentation website developed Rogerio J. Barbosa Center Study Wealth Social Stratification (Ceres - IESP/UERJ). Citation: Barbosa, Rogerio J; Hecksher, Marcos. (2026). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package version v0.1.0. https://github.com/antrologos/PNADCperiods","code":"citation(\"PNADCperiods\")"},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"getting-help","dir":"","previous_headings":"","what":"Getting Help","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"GitHub Issues bug reports questions","code":""},{"path":"https://antrologos.github.io/PNADCperiods/index.html","id":"license","dir":"","previous_headings":"","what":"License","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"MIT","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/calibrate_monthly_weights.html","id":null,"dir":"Reference","previous_headings":"","what":"Calibrate Monthly Weights — calibrate_monthly_weights","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"original PNADC survey weights (V1028) designed quarterly estimates. function creates monthly weights : Grouping observations nested demographic/geographic cells Iteratively adjusting weights monthly totals match quarterly totals within cell Calibrating final weights external monthly population totals","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/calibrate_monthly_weights.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"","code":"calibrate_monthly_weights(   data,   monthly_totals,   n_cells = 4L,   keep_all = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/calibrate_monthly_weights.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"data data.frame data.table PNADC microdata including reference month information (output identify_reference_month). Required columns include: Reference month columns: ref_month_yyyymm, ref_month_in_quarter Survey design: V1028, UF, posest, posest_sxi Demographics: V2009 (age) Time: Ano, Trimestre monthly_totals data.frame monthly population totals. Required columns: ref_month_yyyymm anomesexato: YYYYMM integer m_populacao: Monthly population thousands n_cells Integer. Number hierarchical cell levels use (1-4). Default 4 (full hierarchy). Lower values faster less precise. keep_all Logical. TRUE (default), return rows including indeterminate reference months (weight_calibrated = NA). FALSE, return observations determined reference months. verbose Logical. Print progress messages? Default TRUE.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/calibrate_monthly_weights.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"data.table input data plus: weight_calibrated: Calibrated monthly weight celula1 celula4: Cell identifiers (computed)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/calibrate_monthly_weights.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"Redistributes quarterly survey weights monthly weights using hierarchical calibration across demographic geographic cells. hierarchical calibration cells : celula1 Age groups: 0-13, 14-29, 30-59, 60+ celula2 Post-stratum group + age group celula3 State (UF) + celula2 celula4 Post-stratum (posest) + celula2 level, weights adjusted : sum(weight_new) (cell, month) / sum(weight_old) (cell, month) equals sum(V1028) (cell, quarter) / sum(weight_old) (cell, month) preserves quarterly totals redistributing months.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/calibrate_monthly_weights.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"Important: function designed quarterly PNADC data 5 panel visits present. annual PNADC analysis (visit-specific data), use pnadc_apply_periods anchor = \"year\" instead.","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/calibrate_monthly_weights.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"","code":"if (FALSE) { # \\dontrun{ # Recommended workflow using main API: crosswalk <- pnadc_identify_periods(pnadc_stacked) result <- pnadc_apply_periods(pnadc_2023, crosswalk,                               weight_var = \"V1028\",                               anchor = \"quarter\")  # Alternative: manual workflow with this function crosswalk <- pnadc_identify_periods(pnadc_stacked) merged <- merge(pnadc_data, crosswalk, by = c(\"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\")) monthly_pop <- fetch_monthly_population() result <- calibrate_monthly_weights(merged, monthly_pop) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/clear_sidra_cache.html","id":null,"dir":"Reference","previous_headings":"","what":"Clear All SIDRA Caches — clear_sidra_cache","title":"Clear All SIDRA Caches — clear_sidra_cache","text":"Clears cached SIDRA data (rolling quarter series population). Use need force fresh download, example IBGE updates data.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/clear_sidra_cache.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Clear All SIDRA Caches — clear_sidra_cache","text":"","code":"clear_sidra_cache()"},{"path":"https://antrologos.github.io/PNADCperiods/reference/clear_sidra_cache.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Clear All SIDRA Caches — clear_sidra_cache","text":"Invisibly returns TRUE cache cleared, FALSE empty.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/clear_sidra_cache.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Clear All SIDRA Caches — clear_sidra_cache","text":"","code":"if (FALSE) { # \\dontrun{ clear_sidra_cache() series <- fetch_sidra_rolling_quarters()  # Will fetch fresh from API pop <- fetch_monthly_population()          # Will also fetch fresh } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_series_starting_points.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Starting Points from Microdata — compute_series_starting_points","title":"Compute Starting Points from Microdata — compute_series_starting_points","text":"advanced users want compute custom starting points using calibrated microdata estimates.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_series_starting_points.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Starting Points from Microdata — compute_series_starting_points","text":"","code":"compute_series_starting_points(   monthly_estimates,   rolling_quarters,   calibration_start = NULL,   calibration_end = NULL,   scale_factor = 1000,   use_series_specific_periods = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_series_starting_points.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Starting Points from Microdata — compute_series_starting_points","text":"monthly_estimates data.table columns: anomesexato: YYYYMM exact month z_<series>: Monthly estimates calibrated microdata rolling_quarters data.table fetch_sidra_rolling_quarters calibration_start Integer. Start calibration period (YYYYMM). Default NULL uses .PNADC_DATES$DEFAULT_CALIB_START (201301). Note: CNPJ series automatically use CNPJ_CALIB_START (201601) regardless. calibration_end Integer. End calibration period (YYYYMM). Default NULL uses .PNADC_DATES$DEFAULT_CALIB_END (201912). scale_factor Numeric. Scale factor z_ values (usually 1000). Default 1000. use_series_specific_periods Logical. TRUE (default), use series-specific calibration periods CNPJ series (201601-201912) cumsum starting dates (201510). Set FALSE use uniform calibration series. verbose Logical. Print progress? Default TRUE.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_series_starting_points.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Starting Points from Microdata — compute_series_starting_points","text":"data.table columns: series_name Character. Series name mesnotrim Integer. Month position (1, 2, 3) y0 Numeric. Starting point value","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_series_starting_points.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute Starting Points from Microdata — compute_series_starting_points","text":"starting points (y0) computed : Calculating cumulative variations SIDRA rolling quarters Computing backprojection: e0 = z / scale_factor - cum Averaging e0 mesnotrim calibration period","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_series_starting_points.html","id":"series-specific-handling","dir":"Reference","previous_headings":"","what":"Series-Specific Handling","title":"Compute Starting Points from Microdata — compute_series_starting_points","text":"use_series_specific_periods = TRUE, following series receive special handling series-specific data availability: CNPJ series empregadorcomcnpj, empregadorsemcnpj, contapropriacomcnpj, contapropriasemcnpj use calibration period 201601-201912 cumsum starts 201510 (V4019 became available)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_series_starting_points.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute Starting Points from Microdata — compute_series_starting_points","text":"","code":"if (FALSE) { # \\dontrun{ # After calibrating microdata with pnadc_apply_periods(): # monthly_est <- compute_monthly_estimates(calibrated_data) # rq <- fetch_sidra_rolling_quarters() # y0 <- compute_series_starting_points(monthly_est, rq) # monthly <- mensalize_sidra_series(rq, starting_points = y0) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_starting_points_from_microdata.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Starting Points from Raw PNADC Microdata — compute_starting_points_from_microdata","title":"Compute Starting Points from Raw PNADC Microdata — compute_starting_points_from_microdata","text":"Complete workflow compute y0 starting points raw PNADC microdata. convenience wrapper combines period identification, weight calibration, z_ aggregation, starting point computation.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_starting_points_from_microdata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Starting Points from Raw PNADC Microdata — compute_starting_points_from_microdata","text":"","code":"compute_starting_points_from_microdata(   data,   calibration_start = NULL,   calibration_end = NULL,   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_starting_points_from_microdata.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Starting Points from Raw PNADC Microdata — compute_starting_points_from_microdata","text":"data Stacked PNADC microdata (multiple quarters). Must contain variables period identification (see pnadc_identify_periods). calibration_start Integer. Start calibration period (YYYYMM). Default NULL uses .PNADC_DATES$DEFAULT_CALIB_START (201301). calibration_end Integer. End calibration period (YYYYMM). Default NULL uses .PNADC_DATES$DEFAULT_CALIB_END (201912). verbose Print progress messages.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_starting_points_from_microdata.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Starting Points from Raw PNADC Microdata — compute_starting_points_from_microdata","text":"data.table columns: series_name Character. Series name mesnotrim Integer. Month position (1, 2, 3) y0 Numeric. Starting point value","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_starting_points_from_microdata.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute Starting Points from Raw PNADC Microdata — compute_starting_points_from_microdata","text":"function performs complete workflow: Build crosswalk via pnadc_identify_periods() Calibrate weights via pnadc_apply_periods() Compute z_ aggregates via compute_z_aggregates() Fetch SIDRA rolling quarters Compute starting points via compute_series_starting_points()","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_starting_points_from_microdata.html","id":"weight-calibration","dir":"Reference","previous_headings":"","what":"Weight Calibration","title":"Compute Starting Points from Raw PNADC Microdata — compute_starting_points_from_microdata","text":"months scaled uniformly SIDRA monthly population totals.","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_starting_points_from_microdata.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute Starting Points from Raw PNADC Microdata — compute_starting_points_from_microdata","text":"","code":"if (FALSE) { # \\dontrun{ # Load stacked PNADC data stacked <- fst::read_fst(\"pnadc_stacked.fst\", as.data.table = TRUE)  # Compute starting points y0 <- compute_starting_points_from_microdata(stacked)  # Compare with bundled values bundled <- pnadc_series_starting_points comparison <- merge(y0, bundled, by = c(\"series_name\", \"mesnotrim\")) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_z_aggregates.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute z_ Aggregates from Monthly Microdata — compute_z_aggregates","title":"Compute z_ Aggregates from Monthly Microdata — compute_z_aggregates","text":"Computes monthly z_ aggregates PNADC microdata using calibrated monthly weights, options different population scaling approaches.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_z_aggregates.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute z_ Aggregates from Monthly Microdata — compute_z_aggregates","text":"","code":"compute_z_aggregates(calibrated_data, verbose = TRUE)"},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_z_aggregates.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute z_ Aggregates from Monthly Microdata — compute_z_aggregates","text":"calibrated_data PNADC microdata output pnadc_apply_periods() calibrate = TRUE. Must include weight_monthly, ref_month_yyyymm, ref_month_in_quarter. verbose Print progress messages.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_z_aggregates.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute z_ Aggregates from Monthly Microdata — compute_z_aggregates","text":"data.table columns: anomesexato Integer YYYYMM month z_ Numeric weighted aggregates series","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_z_aggregates.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute z_ Aggregates from Monthly Microdata — compute_z_aggregates","text":"function creates z_ indicator variables aggregates using calibrated weight_monthly pnadc_apply_periods(). pnadc_apply_periods() function implements calibration methodology follows: months scaled uniformly SIDRA monthly population totals. function simply aggregates indicators using already-calibrated weights.","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/compute_z_aggregates.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute z_ Aggregates from Monthly Microdata — compute_z_aggregates","text":"","code":"if (FALSE) { # \\dontrun{ # Step 1: Build crosswalk crosswalk <- pnadc_identify_periods(stacked_data)  # Step 2: Calibrate weights calibrated <- pnadc_apply_periods(stacked_data, crosswalk,                                    weight_var = \"V1028\",                                    calibration_unit = \"month\")  # Step 3: Compute z_ aggregates using calibrated weights z_agg <- compute_z_aggregates(calibrated)  # Step 4: Compute starting points rq <- fetch_sidra_rolling_quarters() y0 <- compute_series_starting_points(z_agg, rq) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/dot-get_mesnotrim.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Month Position in Quarter (mesnotrim) — .get_mesnotrim","title":"Get Month Position in Quarter (mesnotrim) — .get_mesnotrim","text":"Given month (1-12), returns position rolling quarter (1, 2, 3). January, April, July, October = position 1 February, May, August, November = position 2 March, June, September, December = position 3","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/dot-get_mesnotrim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Month Position in Quarter (mesnotrim) — .get_mesnotrim","text":"","code":".get_mesnotrim(month)"},{"path":"https://antrologos.github.io/PNADCperiods/reference/dot-get_mesnotrim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Month Position in Quarter (mesnotrim) — .get_mesnotrim","text":"month Integer. Month number (1-12).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/dot-get_mesnotrim.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Month Position in Quarter (mesnotrim) — .get_mesnotrim","text":"Integer. Position quarter (1, 2, 3).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch-sidra-population.html","id":null,"dir":"Reference","previous_headings":"","what":"Fetch Monthly Population from SIDRA — fetch-sidra-population","title":"Fetch Monthly Population from SIDRA — fetch-sidra-population","text":"Functions download transform IBGE's population estimates SIDRA API use monthly weight calibration.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch-sidra-series.html","id":null,"dir":"Reference","previous_headings":"","what":"Fetch SIDRA Rolling Quarter Series — fetch-sidra-series","title":"Fetch SIDRA Rolling Quarter Series — fetch-sidra-series","text":"Functions download PNADC labor market indicators IBGE's SIDRA API. series published rolling quarterly averages (trimestre movel).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_monthly_population.html","id":null,"dir":"Reference","previous_headings":"","what":"Fetch Monthly Population from SIDRA — fetch_monthly_population","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"Downloads population estimates IBGE SIDRA API (table 6022) transforms moving-quarter exact monthly values.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_monthly_population.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"","code":"fetch_monthly_population(   start_yyyymm = NULL,   end_yyyymm = NULL,   verbose = TRUE,   use_cache = FALSE,   cache_max_age_hours = 24 )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_monthly_population.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"start_yyyymm Integer. First month include (YYYYMM format). NULL, returns available months. end_yyyymm Integer. Last month include (YYYYMM format). NULL, returns available months. verbose Logical. Print progress messages? Default TRUE. use_cache Logical. TRUE, uses cached data available expired. Default FALSE (always fetch fresh data consistency). Set TRUE faster repeated calls development. cache_max_age_hours Numeric. Maximum cache age hours automatic expiration use_cache=TRUE. Default 24 hours.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_monthly_population.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"data.table columns: ref_month_yyyymm: Integer YYYYMM format m_populacao: Monthly population thousands","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_monthly_population.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"SIDRA table 6022 provides moving-quarter population estimates. value represents 3-month average centered middle month. example, value code 201203 (quarter ending March 2012) represents population February 2012. function: Fetches raw moving-quarter data SIDRA Transforms exact monthly values aligning middle months Extrapolates boundary months (first last) using quadratic regression extrapolation uses quadratic regression population differences estimate first month (Jan 2012) recent month.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_monthly_population.html","id":"dependencies","dir":"Reference","previous_headings":"","what":"Dependencies","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"function requires sidrar package API access. Install : install.packages(\"sidrar\")","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_monthly_population.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"","code":"if (FALSE) { # \\dontrun{ # Fetch all available months pop <- fetch_monthly_population()  # Fetch specific date range pop <- fetch_monthly_population(201301, 201912) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_sidra_rolling_quarters.html","id":null,"dir":"Reference","previous_headings":"","what":"Fetch Rolling Quarter Series from SIDRA — fetch_sidra_rolling_quarters","title":"Fetch Rolling Quarter Series from SIDRA — fetch_sidra_rolling_quarters","text":"Downloads PNADC labor market indicators IBGE's SIDRA API. series published rolling quarterly averages (trimestre movel), 12 observations per year.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_sidra_rolling_quarters.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fetch Rolling Quarter Series from SIDRA — fetch_sidra_rolling_quarters","text":"","code":"fetch_sidra_rolling_quarters(   series = \"all\",   theme = NULL,   theme_category = NULL,   subcategory = NULL,   exclude_derived = FALSE,   use_cache = FALSE,   verbose = TRUE,   retry_failed = TRUE,   max_retries = 3 )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_sidra_rolling_quarters.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fetch Rolling Quarter Series from SIDRA — fetch_sidra_rolling_quarters","text":"series Character vector series names fetch, \"\" (default) available series. Use get_sidra_series_metadata()$series_name see available names. theme Character vector themes filter . Valid options: \"labor_market\", \"earnings\", \"demographics\", \"social_protection\", \"prices\". Use NULL filter. theme_category Character vector theme categories filter . Use NULL filter. subcategory Character vector subcategories filter . Use NULL filter. exclude_derived Logical. TRUE, exclude series marked derived (is_derived = TRUE metadata). Default FALSE backward compatibility. Derived series (rates) computed series mensalization, excluding saves API calls fetching mensalization. use_cache Logical. Use cached data available? Default FALSE. TRUE, shows date data cached (may outdated). Use clear_sidra_cache force fresh download. verbose Logical. Print progress messages? Default TRUE. retry_failed Logical. Retry failed series downloads? Default TRUE. max_retries Integer. Maximum retry attempts per series. Default 3.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_sidra_rolling_quarters.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fetch Rolling Quarter Series from SIDRA — fetch_sidra_rolling_quarters","text":"data.table columns: anomesfinaltrimmovel Integer. YYYYMM rolling quarter end month mesnotrim Integer. Month position quarter (1, 2, 3) <series_name> Numeric. One column per requested series","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_sidra_rolling_quarters.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Fetch Rolling Quarter Series from SIDRA — fetch_sidra_rolling_quarters","text":"Rolling quarters labeled ending month: 201201 = Nov 2011 - Jan 2012 (mesnotrim = 1) 201202 = Dec 2011 - Feb 2012 (mesnotrim = 2) 201203 = Jan - Mar 2012 (mesnotrim = 3) 201204 = Feb - Apr 2012 (mesnotrim = 1) etc. mesnotrim column indicates month's position within rolling quarter, essential mensalization algorithm.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_sidra_rolling_quarters.html","id":"rate-limiting","dir":"Reference","previous_headings":"","what":"Rate Limiting","title":"Fetch Rolling Quarter Series from SIDRA — fetch_sidra_rolling_quarters","text":"SIDRA API may rate limits. function includes automatic retry logic exponential backoff failed requests.","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/fetch_sidra_rolling_quarters.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Fetch Rolling Quarter Series from SIDRA — fetch_sidra_rolling_quarters","text":"","code":"if (FALSE) { # \\dontrun{ # Fetch all series (may take several minutes on first call) rq <- fetch_sidra_rolling_quarters()  # Fetch only labor market series rq_labor <- fetch_sidra_rolling_quarters(theme = \"labor_market\")  # Fetch only unemployment data rq_unemp <- fetch_sidra_rolling_quarters(theme = \"labor_market\",                                           theme_category = \"unemployment\")  # Fetch specific series rq <- fetch_sidra_rolling_quarters(   series = c(\"taxadesocup\", \"popocup\", \"popdesocup\") ) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/get_sidra_series_metadata.html","id":null,"dir":"Reference","previous_headings":"","what":"Get SIDRA Series Metadata — get_sidra_series_metadata","title":"Get SIDRA Series Metadata — get_sidra_series_metadata","text":"Returns data.table metadata PNADC rolling quarter series available IBGE's SIDRA API.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/get_sidra_series_metadata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get SIDRA Series Metadata — get_sidra_series_metadata","text":"","code":"get_sidra_series_metadata(   series = \"all\",   theme = NULL,   theme_category = NULL,   subcategory = NULL,   lang = \"pt\" )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/get_sidra_series_metadata.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get SIDRA Series Metadata — get_sidra_series_metadata","text":"series Character vector series names retrieve, \"\" (default) series. theme Character vector themes filter . Valid themes: \"labor_market\", \"earnings\", \"demographics\", \"social_protection\", \"prices\". Use NULL (default) filtering. theme_category Character vector theme categories filter . Use NULL (default) filtering. subcategory Character vector subcategories filter . Use NULL (default) filtering. lang Character. Language descriptions: \"pt\" (Portuguese, default) \"en\" (English). \"en\", description column contains English text.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/get_sidra_series_metadata.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get SIDRA Series Metadata — get_sidra_series_metadata","text":"data.table columns: series_name Character. Internal name used package api_path Character. SIDRA API path get_sidra() table_id Integer. SIDRA table number variable_id Integer. SIDRA variable code theme Character. Top-level theme theme_category Character. Middle-level category within theme subcategory Character. Optional subcategory filtering description_pt Character. Portuguese description description_en Character. English description description Character. Description requested language unit Character. Unit measurement unit_label_pt Character. Unit label Portuguese unit_label_en Character. Unit label English is_derived Logical. TRUE computed series requires_deflation Logical. TRUE needs IPCA deflation","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/get_sidra_series_metadata.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get SIDRA Series Metadata — get_sidra_series_metadata","text":"","code":"if (FALSE) { # \\dontrun{ # Get all series metadata meta <- get_sidra_series_metadata()  # Get only labor market series labor <- get_sidra_series_metadata(theme = \"labor_market\")  # Get unemployment rates unemp <- get_sidra_series_metadata(theme = \"labor_market\",                                     theme_category = \"unemployment\")  # Get specific series with English descriptions meta <- get_sidra_series_metadata(series = c(\"taxadesocup\", \"popocup\"),                                    lang = \"en\") } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_fortnight.html","id":null,"dir":"Reference","previous_headings":"","what":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"PNADC quarterly survey interview occurs specific fortnight within quarter. function identifies IBGE fortnight (1-6 per quarter, 1-24 per year) observation belongs , enabling bi-weekly time series analysis. algorithm uses: IBGE's reference week timing rules (first Saturday sufficient days month) IBGE week boundaries (Sunday-Saturday, calendar days) Respondent birthdates constrain possible interview dates Household-level aggregation within quarter (persons household interviewed day) Dynamic exception detection (identifies quarters needing relaxed rules)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_fortnight.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"","code":"identify_reference_fortnight(data, verbose = TRUE, .pb = NULL, .pb_offset = 0L)"},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_fortnight.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"data data.frame data.table PNADC microdata. Required columns: Ano: Survey year Trimestre: Quarter (1-4) UPA: Primary Sampling Unit V1008: Household sequence within UPA V1014: Panel identifier V2008: Birth day (1-31) V20081: Birth month (1-12) V20082: Birth year V2009: Age verbose Logical. TRUE (default), display progress information. .pb Optional progress bar object. .pb_offset Integer. Offset progress bar updates.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_fortnight.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"data.table original key columns plus: ref_fortnight_start: Reference fortnight start (Sunday first IBGE week) ref_fortnight_end: Reference fortnight end (Saturday last IBGE week) ref_fortnight_in_quarter: Position quarter (1-6) NA ref_fortnight_yyyyff: Integer YYYYFF format (1-24 per year) ref_fortnight_weeks: Number IBGE weeks fortnight (always 2)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_fortnight.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"Determines IBGE fortnight (quinzena) within quarter corresponds survey observation based IBGE's interview timing rules.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_fortnight.html","id":"ibge-fortnight-definition","dir":"Reference","previous_headings":"","what":"IBGE Fortnight Definition","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"IBGE fortnights based IBGE reference weeks, calendar days: Fortnight 1 month = IBGE weeks 1-2 month (14 days) Fortnight 2 month = IBGE weeks 3-4 month (14 days) quarter 6 fortnights (2 per month). fortnight exactly 2 weeks.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_fortnight.html","id":"expected-determination-rate","dir":"Reference","previous_headings":"","what":"Expected Determination Rate","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"Fortnight determination rate typically low (~6-8%) : Unlike months, fortnights aggregate across quarters Birthday constraints typically narrow date range weeks IBGE fortnight (2 weeks) difficult pinpoint without cross-quarter data algorithm determines fortnight interview date range falls entirely within single IBGE fortnight (weeks 1-2 weeks 3+). Note: month algorithm achieves ~97% determination aggregating UPA-V1014 level across quarters (leveraging panel design units interviewed consistent relative positions). Fortnights weeks use cross-quarter aggregation positions consistent across panel visits.","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_fortnight.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"","code":"if (FALSE) { # \\dontrun{ # Identify reference fortnights result <- identify_reference_fortnight(pnadc_data)  # Check determination rate by quarter result[, .(   total = .N,   determined = sum(!is.na(ref_fortnight_in_quarter)),   rate = mean(!is.na(ref_fortnight_in_quarter)) ), by = .(Ano, Trimestre)]  # Note: Fortnight determination rate is typically low (~6-8%) # because fortnights cannot aggregate across quarters like months can. } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":null,"dir":"Reference","previous_headings":"","what":"Identify Reference Month in PNADC Data — identify_reference_month","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"PNADC quarterly survey, interview actually refers specific month within quarter. function identifies month observation belongs , enabling shorter term time series analysis. algorithm uses: IBGE's reference week timing rules (first Saturday sufficient days month) Respondent birthdates constrain possible interview dates UPA-panel level aggregation (everyone sampling unit interviewed together) Dynamic exception detection (identifies quarters needing relaxed rules data)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"","code":"identify_reference_month(data, verbose = TRUE, .pb = NULL, .pb_offset = 0L)"},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"data data.frame data.table PNADC microdata. Required columns: Ano: Survey year Trimestre: Quarter (1-4) UPA: Primary Sampling Unit V1014: Panel identifier V2008: Birth day (1-31) V20081: Birth month (1-12) V20082: Birth year V2009: Age Optional recommended complete crosswalk: V1008: Household sequence within UPA V2003: Person sequence within household verbose Logical. TRUE (default), display progress bar step information. .pb Optional progress bar object created txtProgressBar. provided, function updates progress bar instead creating . Used internally pnadc_identify_periods() show unified progress across steps. .pb_offset Integer. Offset add progress bar updates using external progress bar. Default 0.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"data.table original key columns plus: ref_month_start: Reference month start (Sunday first IBGE reference week) ref_month_end: Reference month end (Saturday last IBGE reference week) ref_month_in_quarter: Position quarter (1, 2, 3) NA indeterminate ref_month_yyyymm: Integer YYYYMM format (e.g., 202301) ref_month_weeks: Number IBGE weeks month (always 4)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"Determines month within quarter corresponds survey observation based IBGE's \"Parada Técnica\" (technical break) rules.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":"exception-detection","dir":"Reference","previous_headings":"","what":"Exception Detection","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"function detects quarters need relaxed timing rules based data . algorithm detects exceptions per-month level within quarter: Checks standard rules produce impossible results (min > max) Checks relaxed rules resolve issue Applies exception rules entire quarter UPA requires ","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":"cross-quarter-aggregation-important-","dir":"Reference","previous_headings":"","what":"Cross-Quarter Aggregation (Important!)","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"optimal determination rates (~97%), input data stacked across multiple quarters (ideally 4+ years). algorithm leverages PNADC's rotating panel design UPA-V1014 interviewed relative week across quarterly visits. Per-quarter processing: ~65-75% determination rate Multi-quarter stacked: ~97% determination rate","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":"processing-steps","dir":"Reference","previous_headings":"","what":"Processing Steps","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"function processes data following steps: Calculate first valid interview Saturday month quarter (standard rule) person, calculate possible interview date range based birthday constraints Convert date ranges month--quarter positions Aggregate UPA-panel level (persons must agree) Calculate alternative (exception) date ranges positions Dynamically detect quarters/months need exception rules Apply exception rules recalculate final month positions","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_month.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"","code":"if (FALSE) { # \\dontrun{ # Identify reference months result <- identify_reference_month(pnadc_data)  # Check determination rate result[, .(   total = .N,   determined = sum(!is.na(ref_month_in_quarter)),   rate = mean(!is.na(ref_month_in_quarter)) ), by = .(Ano, Trimestre)] } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":null,"dir":"Reference","previous_headings":"","what":"Identify Reference Week in PNADC Data — identify_reference_week","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"PNADC quarterly survey interview occurs specific week within quarter. function identifies IBGE reference week observation belongs , enabling weekly time series analysis. algorithm uses: IBGE's reference week timing rules (first Saturday sufficient days month) IBGE week boundaries (Sunday-Saturday, ISO Monday-Sunday) Respondent birthdates constrain possible interview dates Household-level aggregation (persons household interviewed day) Dynamic exception detection (identifies quarters needing relaxed rules data) Key difference monthly identification: function aggregates household level WITHIN quarter, UPA-V1014 level across quarters. households interviewed month position across quarterly visits, week position.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"","code":"identify_reference_week(data, verbose = TRUE, .pb = NULL, .pb_offset = 0L)"},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"data data.frame data.table PNADC microdata. Required columns: Ano: Survey year Trimestre: Quarter (1-4) UPA: Primary Sampling Unit V1008: Household sequence within UPA V1014: Panel identifier V2008: Birth day (1-31) V20081: Birth month (1-12) V20082: Birth year V2009: Age Optional recommended complete crosswalk: V2003: Person sequence within household verbose Logical. TRUE (default), display progress bar step information. .pb Optional progress bar object created txtProgressBar. provided, function updates progress bar instead creating . .pb_offset Integer. Offset add progress bar updates using external progress bar. Default 0.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"data.table original key columns plus: ref_week_start: Reference week start (Sunday IBGE week) ref_week_end: Reference week end (Saturday IBGE week) ref_week_in_quarter: Position quarter (1-12, always 4 weeks per month × 3 months = 12 weeks per quarter) NA indeterminate. Technical stops handled via fallback rules (see Technical Stops section). ref_week_yyyyww: Integer YYYYWW format (IBGE-based)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"Determines IBGE reference week survey observation corresponds based IBGE's interview timing rules birthday constraints.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"household-aggregation","dir":"Reference","previous_headings":"","what":"Household Aggregation","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"persons household (UPA + V1008) interviewed day. algorithm aggregates birthday constraints across household members narrow possible interview week: person weeks 2-4 possibilities person B weeks 3-5 possibilities household's interview week must 3-4 (intersection) Aggregation done (Ano, Trimestre, UPA, V1008) - within quarter , households interviewed week across quarterly visits.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"expected-determination-rate","dir":"Reference","previous_headings":"","what":"Expected Determination Rate","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"weekly determination rate (~1.5%) much lower monthly (~97%) : aggregate across quarters (consistent week position panel design) Finer granularity (12 weeks vs 3 months per quarter) Birthday constraints rarely narrow interview window single 7-day period","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"ibge-reference-weeks","dir":"Reference","previous_headings":"","what":"IBGE Reference Weeks","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"Weeks follow IBGE reference calendar: Weeks start Sunday end Saturday week belongs IBGE month Saturday falls first valid Saturday must >= 4 days month IBGE month exactly 4 reference weeks (28 days) IBGE quarter exactly 12 reference weeks","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"technical-stops-paradas-t-cnicas-","dir":"Reference","previous_headings":"","what":"Technical Stops (Paradas Técnicas)","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"Technical stops periods (full weeks Sunday Saturday) fall valid IBGE reference weeks. part IBGE month. person's possible date range falls entirely within technical stop, following rules applied: Rule 3.1 - Quarter boundary: technical stop quarters, interview assigned last valid week quarter observation belongs (week 12), since interviews must belong source quarter. Rule 3.2 - Household consensus: technical stop within quarter, algorithm checks household members valid week assignment. assigned members agree single week, week used. Rule 3.3 - Fallback: household consensus exists, interview assigned first valid week technical stop (still belongs quarter).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/identify_reference_week.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"","code":"if (FALSE) { # \\dontrun{ # Identify reference weeks result <- identify_reference_week(pnadc_data)  # Check determination rate result[, .(   total = .N,   determined = sum(!is.na(ref_week_in_quarter)),   rate = mean(!is.na(ref_week_in_quarter)) ), by = .(Ano, Trimestre)] } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize-sidra-series.html","id":null,"dir":"Reference","previous_headings":"","what":"Mensalize SIDRA Rolling Quarter Series — mensalize-sidra-series","title":"Mensalize SIDRA Rolling Quarter Series — mensalize-sidra-series","text":"Functions convert IBGE's rolling quarterly (trimestre movel) series exact monthly estimates.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC-package.html","id":null,"dir":"Reference","previous_headings":"","what":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","title":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","text":"mensalizePNADC package provides tools identify exact month Brazil's quarterly official household survey, PNADC (Pesquisa Nacional por Amostra de Domicilios Continua - IBGE), allowing analyzing survey data monthly time series.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC-package.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","text":"package offers two main capabilities: Reference month identification: Determines month within quarter survey observation refers , using IBGE's \"Parada Tecnica\" rules respondent birthdates Monthly weight computation: Adjusts survey weights monthly (instead quarterly) estimates using hierarchical rake weighting package highly optimized large datasets: approximately 1 minute process 28.4 million rows (450,000 rows/sec), 97.0 percent determination rate. Uses pre-computed lookup tables 20x faster date creation. main function mensalizePNADC, processes stacked quarterly PNADC data returns crosswalk joining original data.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC-package.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","text":"IBGE Manual Basico da Entrevista PNADC (methodology \"Parada Tecnica\")","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","text":"Marcos Hecksher mdhecksher@gmail.com Rogerio Barbosa rogerio.barbosa@iesp.uerj.br","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":null,"dir":"Reference","previous_headings":"","what":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"function processes stacked quarterly PNADC microdata : Identify month within quarter observation refers Optionally compute monthly adjusted survey weights (compute_weights = TRUE) output crosswalk table can joined original (stacked unstacked) PNADC data files add monthly time information.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"","code":"mensalizePNADC(   data,   compute_weights = FALSE,   keep_all = TRUE,   output = c(\"crosswalk\", \"microdata\", \"aggregates\"),   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"data data.frame data.table stacked quarterly PNADC microdata. reference month identification (compute_weights = FALSE), minimum required columns : Ano, Trimestre: Year quarter UPA, V1014: Primary sampling unit panel V2008, V20081, V20082: Birth day, month, year V2009: Age monthly weight computation (compute_weights = TRUE), additional columns required. See Details. compute_weights Logical. TRUE, compute monthly adjusted survey weights addition identifying reference months. Default FALSE. Requires sidrar package fetch population data IBGE SIDRA API. makes monthly weights sum population results https://sidra.ibge.gov.br/tabela/6022. keep_all Logical. TRUE (default), return rows input data, weight_monthly = NA observations reference month determined. FALSE, return observations determined reference months (smaller output). applies compute_weights = TRUE. output Character. return: \"crosswalk\" (default): Minimal crosswalk joining \"microdata\": Full microdata computed columns \"aggregates\": Monthly aggregated indicators verbose Logical. Print progress messages? Default TRUE.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"Depends output parameter: output = \"crosswalk\" (default): data.table join keys new time variables: Join keys: Ano, Trimestre, UPA, V1008, V1014, V2003 ref_month: Reference month Date ref_month_in_quarter: Position quarter (1, 2, 3) NA ref_month_yyyymm: Integer YYYYMM format weight_monthly: Monthly weight (compute_weights = TRUE) output = \"microdata\": Full input data computed columns added. output = \"aggregates\": data.table monthly aggregated indicators containing: ref_month_yyyymm: Month identifier YYYYMM format n_obs: Number observations per month population: Total monthly population (sum weights) Requires compute_weights = TRUE.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"Main function convert quarterly PNADC survey data monthly time series. Returns crosswalk data.frame joining original data, adding reference month information optionally monthly survey weights.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"reference-month-identification","dir":"Reference","previous_headings":"","what":"Reference Month Identification","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"algorithm determines month survey response refers based : IBGE's \"Parada Tecnica\" rules reference week timing Respondent birthdates (constrains possible interview dates) UPA-panel grouping (everyone interviewed together)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"cross-quarter-aggregation-important-","dir":"Reference","previous_headings":"","what":"Cross-Quarter Aggregation (Important!)","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"optimal determination rates (~97%), input data stacked across multiple quarter datasets (ideally 4+ years). algorithm leverages PNADC's rotating panel design locations defined values variables UPA-V1014 always interviewed relative month within given quarter across quarterly visits. Per-quarter processing: ~65-75% determination rate Multi-quarter stacked: ~97% determination rate cross-quarter aggregation dramatically improves accuracy combining birthday constraints multiple interview rounds.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"monthly-weight-computation","dir":"Reference","previous_headings":"","what":"Monthly Weight Computation","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"compute_weights = TRUE, function: Fetches monthly population IBGE SIDRA API (table 6022) Redistributes quarterly weights months using hierarchical rake weighting Smooths monthly aggregates remove quarterly artifacts resulting weight_monthly adjusted weight general-purpose monthly analysis. Additional required columns weight computation: Survey design: V1028, V1008, V2003, UF, posest, posest_sxi","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"dependencies","dir":"Reference","previous_headings":"","what":"Dependencies","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"compute_weights = TRUE, sidrar package required fetch population data. Install : install.packages(\"sidrar\")","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalizePNADC.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"","code":"if (FALSE) { # \\dontrun{ # Basic usage: identify reference months only library(mensalizePNADC)  # Load stacked quarterly data (minimum columns) pnadc <- data.table::fread(\"pnadc_stacked.csv\",   select = c(\"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\", \"V2003\",              \"V2008\", \"V20081\", \"V20082\", \"V2009\"))  # Get crosswalk crosswalk <- mensalizePNADC(pnadc)  # Join with original quarterly file original <- haven::read_dta(\"PNADC_2023T1.dta\") monthly <- dplyr::left_join(original, crosswalk,   by = c(\"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\", \"V2003\"))   # With monthly weights for general analysis # (requires sidrar package and internet connection) pnadc_full <- haven::read_dta(\"PNADCtrimestralempilhada.dta\")  result <- mensalizePNADC(pnadc_full, compute_weights = TRUE)  # Use weight_monthly for any monthly aggregate result[, .(pop = sum(weight_monthly)), by = ref_month_yyyymm] } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_annual_pnadc.html","id":null,"dir":"Reference","previous_headings":"","what":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"function: Merges annual PNADC data crosswalk add reference month information Optionally calibrates V1032 weights using hierarchical rake weighting Final calibration SIDRA monthly population totals","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_annual_pnadc.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"","code":"mensalize_annual_pnadc(   annual_data,   crosswalk,   calibrate_weights = TRUE,   n_cells = 4L,   keep_all = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_annual_pnadc.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"annual_data data.frame/data.table annual PNADC data (stacked single year). Required columns (case-insensitive, converted lowercase internally): Join keys: ano, trimestre, upa, v1008, v1014, v2003 Weight: v1032 Demographics (calibration): v2009 (age), uf, posest, posest_sxi crosswalk Output mensalizePNADC() reference month information. calibrate_weights Logical. TRUE (default), calibrate V1032 weights monthly SIDRA population totals using hierarchical rake weighting. FALSE, just merge crosswalk without calibration. n_cells Integer (1-4). Number hierarchical cell levels raking. Default 4 (full hierarchy: age, posest_sxi, UF, posest). keep_all Logical. Keep observations without determined reference month? Default TRUE. verbose Logical. Print progress? Default TRUE.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_annual_pnadc.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"data.table annual data merged crosswalk plus: ref_month, ref_month_in_quarter, ref_month_yyyymm: crosswalk weight_monthly: Calibrated monthly weight (calibrate_weights = TRUE)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_annual_pnadc.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"Merges annual PNADC data mensalization crosswalk optionally calibrates annual weights (V1032) monthly population totals.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_annual_pnadc.html","id":"why-not-use-quarterly-crosswalk-weights-","dir":"Reference","previous_headings":"","what":"Why Not Use Quarterly Crosswalk Weights?","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"weight_monthly quarterly crosswalk calibrated assuming 5 panel visits present quarter. Annual data 1 visit per observation, weights inappropriate. function uses annual weight V1032 starting point applies: Hierarchical rake weighting within demographic cells (redistributing yearly totals months) Final calibration SIDRA monthly population totals","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_annual_pnadc.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"","code":"if (FALSE) { # \\dontrun{ # Step 1: Create crosswalk from quarterly data crosswalk <- mensalizePNADC(quarterly_data, compute_weights = FALSE)  # Step 2: Load and merge annual data with calibration d <- mensalize_annual_pnadc(   annual_data = annual_data,   crosswalk = crosswalk,   calibrate_weights = TRUE )  # Use the calibrated weight d[, .(pop = sum(weight_monthly)), by = ref_month_yyyymm] } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_sidra_series.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","title":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","text":"Transforms SIDRA rolling quarterly averages exact monthly values using mathematical relationship consecutive rolling quarters.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_sidra_series.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","text":"","code":"mensalize_sidra_series(   rolling_quarters,   starting_points = NULL,   series = \"all\",   compute_derived = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_sidra_series.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","text":"rolling_quarters data.table fetch_sidra_rolling_quarters containing rolling quarter series columns anomesfinaltrimmovel, mesnotrim, series value columns. starting_points Optional data.table precomputed starting points (y0 values). NULL (default), uses bundled pnadc_series_starting_points. See Details format. series Character vector series names mensalize, \"\" (default) series input data (except price indices). compute_derived Logical. Compute derived series (rates, aggregates)? Default TRUE. verbose Logical. Print progress messages? Default TRUE.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_sidra_series.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","text":"data.table columns: anomesexato Integer. YYYYMM exact month m_ Numeric. Mensalized value series","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_sidra_series.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","text":"algorithm exploits mathematical property rolling quarterly averages: $$RQ_t - RQ_{t-1} = (Month_t - Month_{t-3}) / 3$$ means exact 3-month variations can extracted consecutive rolling quarters. accumulating variations separately month-position (1, 2, 3), build cumulative variation series. unknown starting level Jan, Feb, Mar 2012. Starting points estimated : Computing monthly estimates calibrated microdata (z_ variables) Calculating cumulative variations SIDRA (cum_ variables) Backprojecting: e0 = z_ - cum_ calibration period (2013-2019) Averaging e0 month position get y0_ position Final adjustment ensures average 3 consecutive mensalized values equals original rolling quarter value.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_sidra_series.html","id":"starting-points-format","dir":"Reference","previous_headings":"","what":"Starting Points Format","title":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","text":"providing custom starting points, data.table must columns: series_name: Character. Series name matching rolling_quarters columns mesnotrim: Integer (1, 2, 3). Month position quarter y0: Numeric. Starting point value","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_sidra_series.html","id":"mathematical-foundation","dir":"Reference","previous_headings":"","what":"Mathematical Foundation","title":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","text":"mensalization algorithm proceeds steps: Calculate d3 = 3 * (RQ_t - RQ_t-1) Separate d3 month position: d3m1, d3m2, d3m3 Cumulate separately: cum1, cum2, cum3 Apply starting points: y = y0 + cum Final adjustment rolling quarter consistency","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/mensalize_sidra_series.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert Rolling Quarters to Exact Monthly Series — mensalize_sidra_series","text":"","code":"if (FALSE) { # \\dontrun{ # Fetch rolling quarters and mensalize rq <- fetch_sidra_rolling_quarters(category = \"population\") monthly <- mensalize_sidra_series(rq)  # View unemployment rate over time monthly[, .(anomesexato, m_popocup, m_popdesocup)] } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/PNADCperiods-package.html","id":null,"dir":"Reference","previous_headings":"","what":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","title":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","text":"PNADCperiods package provides tools identify exact reference period (month, fortnight, week) Brazil's quarterly official household survey, PNADC (Pesquisa Nacional por Amostra de Domicilios Continua - IBGE), allowing analyzing survey data sub-quarterly temporal granularity.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/PNADCperiods-package.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","text":"package offers four main capabilities: Reference period identification: Determines temporal period (month, fortnight, week) within quarter survey observation refers , using IBGE's \"Parada Técnica\" rules respondent birthdates. identification nested construction: fortnights require months, weeks require fortnights. Period-specific weight calibration: Adjusts survey weights sub-quarterly estimates using adaptive hierarchical rake weighting (4/2/1 cell levels month/fortnight/week respectively) Experimental strategies: Probabilistic assignment UPA aggregation boost fortnight/week determination rates sensitivity analysis SIDRA series mensalization: Converts IBGE's rolling quarterly (trimestre móvel) aggregate series exact monthly estimates Determination rates (strict, full series 2012-2025): Monthly: ~97\\ Fortnight: ~9\\ Week: ~3\\ smaller datasets, rates may differ (e.g., 8 quarters: ~94\\ Experimental strategies (probabilistic + UPA aggregation) improve determination rates. package highly optimized large datasets (~450,000 rows/sec). Uses pre-computed lookup tables 20x faster date creation. Note: Strict fortnight week determination rates inherently low leverage cross-quarter aggregation like months can. birthday constraints within single quarter available narrow interview window. main functions : pnadc_identify_periods: Builds crosswalk containing month, fortnight, week reference periods IBGE calendar-based dates pnadc_apply_periods: Applies crosswalk PNADC dataset optionally calibrates weights pnadc_experimental_periods: Applies experimental strategies (probabilistic, UPA aggregation) improved fortnight/week determination get_sidra_series_metadata: Lists 86+ available PNADC rolling quarter series SIDRA fetch_sidra_rolling_quarters: Downloads rolling quarterly data IBGE SIDRA API mensalize_sidra_series: Converts rolling quarters exact monthly estimates","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/PNADCperiods-package.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","text":"HECKSHER, Marcos. \"Valor Impreciso por Mes Exato: Microdados e Indicadores Mensais Baseados na Pnad Continua\". IPEA - Nota Tecnica Disoc, n. 62. Brasilia, DF: IPEA, 2020. https://portalantigo.ipea.gov.br/portal/index.php?option=com_content&view=article&id=35453 HECKSHER, M. \"Cinco meses de perdas de empregos e simulacao de um incentivo contratacoes\". IPEA - Nota Tecnica Disoc, n. 87. Brasilia, DF: IPEA, 2020. HECKSHER, Marcos. \"Mercado de trabalho: queda da segunda quinzena de marco, aprofundada em abril\". IPEA - Carta de Conjuntura, v. 47, p. 1-6, 2020. IBGE. Manual Basico da Entrevista PNADC (methodology \"Parada Tecnica\").","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/PNADCperiods-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","text":"Rogerio Barbosa rogerio.barbosa@iesp.uerj.br (R package, dashboard, website; Ceres-IESP/UERJ) Marcos Hecksher mdhecksher@gmail.com (mensalization methodology; Ipea)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":null,"dir":"Reference","previous_headings":"","what":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"function takes crosswalk pnadc_identify_periods applies PNADC dataset (quarterly annual). can optionally calibrate survey weights match external population totals chosen temporal granularity (month, fortnight, week).","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"","code":"pnadc_apply_periods(   data,   crosswalk,   weight_var,   anchor,   calibrate = TRUE,   calibration_unit = c(\"month\", \"fortnight\", \"week\"),   calibration_min_cell_size = 1,   target_totals = NULL,   smooth = FALSE,   keep_all = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"data data.frame data.table PNADC microdata. Must contain join keys Ano, Trimestre, UPA, V1008, V1014 merge crosswalk. crosswalk data.table crosswalk pnadc_identify_periods. weight_var Character. Name survey weight column. Must specified: \"V1028\" quarterly PNADC data \"V1032\" annual PNADC data (visit-specific annual releases organized quarters) anchor Character. anchor weight redistribution. Must specified: \"quarter\" quarterly data annual releases organized quarters (preserves quarterly totals) \"year\" annual visit-specific data (preserves yearly totals) calibrate Logical. TRUE (default), calibrate weights external population totals. FALSE, merge crosswalk without calibration. calibration_unit Character. Temporal unit weight calibration. One \"month\" (default), \"fortnight\", \"week\". calibration_min_cell_size Integer. Minimum sample size required cell used hierarchical raking. Cells smaller threshold collapsed coarser levels. Default: 1 (use cells). target_totals Optional data.table population targets. NULL (default), fetches monthly population SIDRA derives targets fortnight/week. time period (month, fortnight, week) calibrated FULL Brazilian population SIDRA. providing custom targets, population column (m_populacao months, f_populacao fortnights, w_populacao weeks) must thousands. function multiplies 1000 internally. smooth Logical. TRUE, smooth calibrated weights remove quarterly artifacts. Smoothing adapted per time period: monthly (3-period window), fortnight (7-period window), weekly (smoothing). Default: FALSE. keep_all Logical. TRUE (default), keep observations including undetermined reference periods. FALSE, drop undetermined rows. verbose Logical. TRUE (default), print progress messages.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"data.table input data plus crosswalk columns: ref_month_in_quarter, ref_month_in_year Month position (1-3 quarter, 1-12 year) ref_fortnight_in_month, ref_fortnight_in_quarter Fortnight position (1-2 month, 1-6 quarter) ref_week_in_month, ref_week_in_quarter Week position (1-4 month, 1-12 quarter) ref_month_yyyymm, ref_fortnight_yyyyff, ref_week_yyyyww Integer period codes determined_month, determined_fortnight, determined_week Logical determination flags weight_monthly, weight_fortnight, weight_weekly Calibrated weights (calibrate=TRUE)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"Merges reference period crosswalk PNADC microdata optionally calibrates survey weights sub-quarterly analysis.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"weight-calibration","dir":"Reference","previous_headings":"","what":"Weight Calibration","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"calibrate = TRUE, function performs hierarchical rake weighting: Groups observations nested demographic/geographic cells Iteratively adjusts weights sub-period totals match anchor-period totals Calibrates final weights external population totals (FULL Brazilian population) Optionally smooths weights remove quarterly artifacts","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"population-targets","dir":"Reference","previous_headings":"","what":"Population Targets","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"time periods (months, fortnights, weeks) calibrated FULL Brazilian population SIDRA. means: Monthly weights sum Brazilian population month Fortnight weights sum Brazilian population containing month Weekly weights sum Brazilian population containing month","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"hierarchical-raking-levels","dir":"Reference","previous_headings":"","what":"Hierarchical Raking Levels","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"number hierarchical cell levels automatically adjusted based calibration unit avoid sparse cell issues: \"month\": 4 levels (age, region, state, post-stratum) - full hierarchy \"fortnight\": 2 levels (age, region) - simplified lower sample size \"week\": 1 level (age groups ) - minimal hierarchy sparse data","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"anchor-period","dir":"Reference","previous_headings":"","what":"Anchor Period","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"anchor parameter determines weights redistributed: \"quarter\": Quarterly totals preserved redistributed months/fortnights/weeks \"year\": Yearly totals preserved redistributed months/fortnights/weeks Use anchor = \"quarter\" quarterly V1028 weights, anchor = \"year\" annual V1032 weights.","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_apply_periods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"","code":"if (FALSE) { # \\dontrun{ # Build crosswalk crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply to quarterly data with monthly calibration result <- pnadc_apply_periods(   pnadc_2023,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\" )  # Apply to annual data result <- pnadc_apply_periods(   pnadc_annual,   crosswalk,   weight_var = \"V1032\",   anchor = \"year\" )  # Weekly calibration result <- pnadc_apply_periods(   pnadc_2023,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibration_unit = \"week\" )  # No calibration (just merge crosswalk) result <- pnadc_apply_periods(   pnadc_2023,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = FALSE ) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":null,"dir":"Reference","previous_headings":"","what":"Experimental Period Identification Strategies — pnadc_experimental_periods","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"Three experimental strategies available, properly nested period: probabilistic: narrow ranges (2 possible periods), classifies based date interval falls. Assigns confidence exceeds threshold. upa_aggregation: Extends strictly identified periods observations UPA-V1014 within quarter, sufficient proportion already strict identification. : Sequentially applies probabilistic strategy first, UPA aggregation top. Guarantees identification rate >= max individual strategies.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"","code":"pnadc_experimental_periods(   crosswalk,   strategy = c(\"probabilistic\", \"upa_aggregation\", \"both\"),   confidence_threshold = 0.9,   upa_proportion_threshold = 0.5,   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"crosswalk crosswalk data.table pnadc_identify_periods() strategy Character specifying strategy apply. Options: \"probabilistic\", \"upa_aggregation\", \"\" confidence_threshold Numeric (0-1). Minimum confidence required assign probabilistic period. Used probabilistic combined strategies. Default 0.9. upa_proportion_threshold Numeric (0-1). Minimum proportion UPA observations (within quarter) must strict identification consensus extending unidentified observations. Default 0.5. verbose Logical. TRUE, print progress information.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"modified crosswalk additional columns. Output directly compatible pnadc_apply_periods(): ref_month_in_quarter, ref_month_in_year, ref_month_yyyymm: Month position (combined strict + experimental, strict takes priority) ref_fortnight_in_month, ref_fortnight_in_quarter, ref_fortnight_yyyyff: Fortnight position (combined strict + experimental) ref_week_in_month, ref_week_in_quarter, ref_week_yyyyww: Week position (combined strict + experimental) determined_month, determined_fortnight, determined_week: TRUE period assigned (strictly experimentally) determined_probable_month, determined_probable_fortnight, determined_probable_week: TRUE period assigned probabilistic strategy probabilistic_assignment: TRUE period assigned experimentally (vs strictly deterministic) week_1_start, week_1_end, ..., week_4_start, week_4_end: IBGE week boundaries assigned month","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"Provides experimental strategies improving period identification rates beyond standard deterministic algorithm. strategies respect nested identification hierarchy: weeks require fortnights, fortnights require months.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"nesting-enforcement","dir":"Reference","previous_headings":"","what":"Nesting Enforcement","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"strategies enforce proper nesting: Fortnights can assigned month identified (strictly experimentally) Weeks can assigned fortnight identified (strictly experimentally)","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"probabilistic-strategy","dir":"Reference","previous_headings":"","what":"Probabilistic Strategy","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"period type (processed order: months, fortnights, weeks): Check required parent period identified bounds narrowed exactly 2 sequential periods, calculate period contains date interval Calculate confidence based proportion interval likely period (0-1) assign confidence >= confidence_threshold months: aggregates UPA-V1014 level across quarters (like strict algorithm) fortnights weeks: works household level within quarter","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"upa-aggregation-strategy","dir":"Reference","previous_headings":"","what":"UPA Aggregation Strategy","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"Extends strictly identified periods based consensus within geographic groups: Months: Uses UPA level within quarter Fortnights/Weeks: Uses UPA level within quarter (households UPA interviewed fortnight/week within quarter) Calculate proportion observations strictly identified period proportion >= upa_proportion_threshold consensus exists, extend Apply nested order: months first, fortnights, weeks","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"combined-strategy-both-","dir":"Reference","previous_headings":"","what":"Combined Strategy (\"both\")","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"Sequentially applies strategies maximize identification: First, apply probabilistic strategy (captures observations narrow date ranges high confidence) , apply UPA aggregation (extends based strict consensus within UPA/UPA-V1014 groups) guarantees \"\" identifies least many observations either individual strategy alone. strategies operate independently (UPA aggregation considers strict identifications), result union strategies.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"integration-with-weight-calibration","dir":"Reference","previous_headings":"","what":"Integration with Weight Calibration","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"output can passed directly pnadc_apply_periods() weight calibration. derived columns combine strict experimental assignments, strict taking priority. Use probabilistic_assignment flag filter want strict determinations.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"strategies produce \"experimental\" assignments, strict determinations. standard pnadc_identify_periods() function used rigorous analysis. Experimental outputs useful : Sensitivity analysis Robustness checks Research identification algorithm improvements","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_experimental_periods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"","code":"if (FALSE) { # \\dontrun{ # Build standard crosswalk crosswalk <- pnadc_identify_periods(pnadc_data)  # Apply experimental strategies crosswalk_exp <- pnadc_experimental_periods(   crosswalk,   strategy = \"probabilistic\",   confidence_threshold = 0.9 )  # Check how many additional assignments we get crosswalk_exp[, .(   strict = sum(!is.na(ref_month_in_quarter) & !probabilistic_assignment),   experimental = sum(probabilistic_assignment, na.rm = TRUE),   total = sum(determined_month) )]  # Use directly with calibration (experimental output is compatible) result <- pnadc_apply_periods(pnadc_data, crosswalk_exp,                               period = \"month\", calibrate = TRUE)  # Or filter to only strict determinations strict_only <- crosswalk_exp[probabilistic_assignment == FALSE | is.na(probabilistic_assignment)] } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":null,"dir":"Reference","previous_headings":"","what":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"PNADC quarterly survey, interview actually refers specific temporal period within quarter. function identifies month, fortnight (quinzena), week observation belongs , enabling sub-quarterly time series analysis. algorithm uses nested identification approach: Phase 1: Identify MONTHS observations using: IBGE's reference week timing rules (first reference week – ending Saturday – sufficient days) Respondent birthdates constrain possible interview dates UPA-panel level aggregation across quarters (panel design) Dynamic exception detection (identifies quarters needing relaxed rules) Phase 2: Identify FORTNIGHTS month-determined observations: Search space constrained 2 fortnights within determined month Household-level aggregation within quarter Phase 3: Identify WEEKS fortnight-determined observations: Search space constrained ~2 weeks within determined fortnight Household-level aggregation within quarter","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"","code":"pnadc_identify_periods(data, verbose = TRUE, store_date_bounds = FALSE)"},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"data data.frame data.table PNADC microdata. Required columns: Ano: Survey year Trimestre: Quarter (1-4) UPA: Primary Sampling Unit V1008: Household id/sequence within UPA V1014: Panel identifier V2008: Birth day (1-31) V20081: Birth month (1-12) V20082: Birth year V2009: Age Optional recommended: V2003: Person sequence within household verbose Logical. TRUE (default), display progress information. store_date_bounds Logical. TRUE, stores date bounds exception flags crosswalk optimization calling pnadc_experimental_periods(). enables 10-20x speedup probabilistic strategy avoiding redundant computation. Default FALSE.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"data.table crosswalk columns: Ano, Trimestre, UPA, V1008, V1014 Join keys (year, quarter, UPA, household, panel) ref_month_in_quarter Integer. Month position quarter (1, 2, 3) NA ref_month_in_year Integer. Month position year (1-12) NA ref_fortnight_in_month Integer. Fortnight position month (1 2) NA ref_fortnight_in_quarter Integer. Fortnight position quarter (1-6) NA ref_week_in_month Integer. Week position month (1-4) NA ref_week_in_quarter Integer. Week position quarter (1-12) NA date_min Date. Lower bound interview reference date individual. returned store_date_bounds = TRUE date_max Date. Upper bound interview reference date individual. returned store_date_bounds = TRUE week_1_start Date. Sunday IBGE first reference week month. returned store_date_bounds = TRUE week_1_end Date. Saturday IBGE first reference week month. returned store_date_bounds = TRUE week_2_start Date. Sunday IBGE second reference week month. returned store_date_bounds = TRUE week_2_end Date. Saturday IBGE second reference week month. returned store_date_bounds = TRUE week_3_start Date. Sunday IBGE third reference week month. returned store_date_bounds = TRUE week_3_end Date. Saturday IBGE third reference week month. returned store_date_bounds = TRUE week_4_start Date. Sunday IBGE fourth reference week month. returned store_date_bounds = TRUE week_4_end Date. Saturday IBGE fourth reference week month. returned store_date_bounds = TRUE month_max_upa Integer. Maximum month position across UPA-V1014 group (debugging). returned store_date_bounds = TRUE month_min_upa Integer. Minimum month position across UPA-V1014 group (debugging). returned store_date_bounds = TRUE fortnight_max_hh Integer. Maximum fortnight position within household (debugging). returned store_date_bounds = TRUE fortnight_min_hh Integer. Minimum fortnight position within household (debugging). returned store_date_bounds = TRUE week_min_hh Integer. Minimum week position within household (debugging). returned store_date_bounds = TRUE week_max_hh Integer. Maximum week position within household (debugging). returned store_date_bounds = TRUE ref_month_yyyymm Integer. Identified reference month format YYYYMM, MM follows IBGE calendar. 1 <= MM  <= 12 ref_fortnight_yyyyff Integer. Identified reference fortnight format YYYYFF, FF follows IBGE calendar. 1 <= FF  <= 24 ref_week_yyyyww Integer. Identified reference Week format YYYYWW, WW follows IBGE calendar. 1 <= WW  <= 48 determined_month Logical. Flags month determined. determined_fortnight Logical. Flags fortnight determined. determined_week Logical. Flags week determined.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"Builds crosswalk containing reference periods (month, fortnight, week) PNADC survey data based IBGE's interview timing rules.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"temporal-granularity","dir":"Reference","previous_headings":"","what":"Temporal Granularity","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"crosswalk contains three levels temporal granularity: Month: 3 per quarter, ~97\\ Fortnight (quinzena): 6 per quarter, ~9\\ Week: 12 per quarter, ~3\\","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"cross-quarter-aggregation-important-","dir":"Reference","previous_headings":"","what":"Cross-Quarter Aggregation (Important!)","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"optimal month determination rates, input data stacked across multiple quarters (ideally 4+ years). algorithm leverages PNADC's rotating panel design UPA-V1014 interviewed relative position across quarterly visits.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"fortnight-definition","dir":"Reference","previous_headings":"","what":"Fortnight Definition","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"Fortnights numbered 1-6 per quarter (2 per month), based IBGE reference week calendar (calendar days). IBGE \"month\" consists exactly 4 reference weeks (28 days), starting Sunday: Fortnight 1 month: IBGE weeks 1-2 (days 1-14 IBGE month) Fortnight 2 month: IBGE weeks 3-4 (days 15-28 IBGE month)","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"nested-identification-hierarchy","dir":"Reference","previous_headings":"","what":"Nested Identification Hierarchy","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"algorithm enforces strict nesting construction: Fortnights can identified observations determined months Weeks can identified observations determined fortnights guarantees: determined_week => determined_fortnight => determined_month","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"aggregation-levels","dir":"Reference","previous_headings":"","what":"Aggregation Levels","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"crosswalk aggregates different levels: Months: UPA-V1014 level across quarters (PNADC panel design ensures month position) Fortnights: Household level within quarter Weeks: Household level within quarter ","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_identify_periods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"","code":"if (FALSE) { # \\dontrun{ # Build crosswalk from stacked quarterly data crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Check determination rates crosswalk[, .(   month_rate = mean(determined_month),   fortnight_rate = mean(determined_fortnight),   week_rate = mean(determined_week) )]  # Verify nesting (always TRUE by construction) crosswalk[determined_fortnight, all(determined_month)] crosswalk[determined_week, all(determined_fortnight)]  # Apply to a specific dataset result <- pnadc_apply_periods(pnadc_2023, crosswalk,                               weight_var = \"V1028\",                               anchor = \"quarter\") } # }"},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_ipf_calibrate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"IPF Weight Calibration for PNADC Data — pnadc_ipf_calibrate","text":"","code":"pnadc_ipf_calibrate(   data,   weight_var = \"V1028\",   calibration_unit = \"month\",   margins = c(\"age_group\", \"gender\", \"hh_group\", \"posest\"),   target_totals = NULL,   bounds = c(0.1, 10),   max_iter = 300L,   tol = 1e-06,   bias_correction = c(\"none\", \"propensity\"),   method = c(\"margin\", \"cell\"),   min_cell_size = 30L,   verbose = TRUE )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_ipf_calibrate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"IPF Weight Calibration for PNADC Data — pnadc_ipf_calibrate","text":"data data.table period assignments pnadc_apply_periods() pnadc_identify_periods(). Must contain reference period columns (e.g., ref_month_yyyymm) demographic variables. weight_var Character. Name original weight column, either \"V1028\" (quarterly) \"V1032\" (annual). Default: \"V1028\". calibration_unit Character. Time unit calibration: \"month\", \"fortnight\", \"week\". Default: \"month\". margins Character vector margin names use. Available margins: \"age_group\" (9 age categories), \"gender\" (male/female), \"hh_group\" (household size: 1, 2, 3-4, 5+), \"posest\" (IBGE post-stratum), \"rural_urban\" (requires V1022). Default: c(\"age_group\", \"gender\", \"hh_group\", \"posest\"). Use fewer/simpler margins sparse data (fortnight, week). target_totals Optional data.table external population totals fetch_monthly_population(). provided, final weights scaled match totals. NULL, weights preserve sample's weighted totals. bounds Numeric vector length 2. Weight adjustment bounds ratios original weight, e.g., c(0.1, 10) allows weights reduced 10\\ max_iterInteger. Maximum number IPF iterations. Default: 300. tolNumeric. Convergence tolerance - iteration stops maximum relative change weights value. Default: 1e-6. bias_correctionCharacter. Method correcting selection bias determined sample. Options: \"none\" (default, use standard weights), \"propensity\" (use inverse probability weighting based propensity scores determined sample). methodCharacter. IPF method use. Options: \"margin\" (default, iterate independent margins), \"cell\" (iterate hierarchical cells like nested raking, preserving anchor-period structure). min_cell_sizeInteger. Minimum cell size threshold adaptive margin collapsing. margin cells smaller , margin categories collapsed (e.g., 9 age groups -> 4). Default: 30. Set 0 disable. verboseLogical. Print progress messages. Default: TRUE. input data.table new weight column added: weight_ipf_monthly, weight_ipf_fortnightly, weight_ipf_weekly, depending calibration_unit.   Alternative weight calibration using Iterative Proportional Fitting (IPF). Unlike nested-cells raking pnadc_apply_periods(), function adjusts weights simultaneously match multiple independent margins: age groups, gender, household size, posest, optionally rural/urban.   IPF algorithm iteratively adjusts weights match target proportions margin. Critically, target proportions derived FULL quarterly sample (observations, just determined reference periods). corrects selection bias month/fortnight/week determined sample.algorithm flow: Create margin variables observations (Optional) Compute propensity scores IPW bias correction Calculate target proportions FULL quarterly sample (unbiased) (Optional) Adaptively collapse sparse margins Filter determined observations Run IPF iterations (margin-based cell-based) Apply weight bounds Scale SIDRA population totals (period containing month) Cell-Based IPFThe method = \"cell\" option runs IPF within hierarchical cells (similar nested raking) rather matching independent margins. preserves anchor-period totals within cells often produces better temporal consistency. Adaptive MarginsWhen min_cell_size > 0, margins sparse cells automatically collapsed prevent extreme weight adjustments. example, 9 age groups may collapsed 4 broader categories fortnight/week calibration.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_series_starting_points.html","id":null,"dir":"Reference","previous_headings":"","what":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","title":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","text":"Pre-computed starting point values (y0) mensalizing IBGE's rolling quarterly series exact monthly estimates.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_series_starting_points.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","text":"","code":"data(pnadc_series_starting_points)"},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_series_starting_points.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","text":"data.table 159 rows 3 columns: series_name Character. Name SIDRA series (53 series) mesnotrim Integer. Month position quarter (1, 2, 3) y0 Numeric. Starting point value series position","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_series_starting_points.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","text":"Computed using data-raw/regenerate_starting_points_from_microdata.R","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_series_starting_points.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","text":"starting points computed PNADC microdata using full R package pipeline, ensuring consistency compute_starting_points_from_microdata: Weight calibration via pnadc_apply_periods: months scaled SIDRA monthly population totals z_ aggregates computed via compute_z_aggregates using calibrated weight_monthly Starting points computed via compute_series_starting_points CNPJ-aware calibration periods calibration period (2013-2019) chosen : includes stable pre-pandemic data IBGE methodology consistent period Sufficient observations reliable estimates CNPJ series (empregadorcomcnpj, empregadorsemcnpj, contapropriacomcnpj, contapropriasemcnpj) use calibration period 2016-2019 cumulative sum starting October 2015 due V4019 variable availability.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_series_starting_points.html","id":"methodology-consistency","dir":"Reference","previous_headings":"","what":"Methodology Consistency","title":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","text":"bundled starting points generated using pipeline compute_starting_points_from_microdata, ensuring users compute custom starting points get consistent results.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_series_starting_points.html","id":"when-to-use-custom-starting-points","dir":"Reference","previous_headings":"","what":"When to Use Custom Starting Points","title":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","text":"bundled starting points suitable users. Consider computing custom starting points compute_starting_points_from_microdata : IBGE makes major methodological changes PNADC need series included bundled data want use different calibration period working updated different microdata","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/pnadc_series_starting_points.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Starting Points for SIDRA Series Mensalization — pnadc_series_starting_points","text":"","code":"if (FALSE) { # \\dontrun{ # View bundled starting points data(pnadc_series_starting_points) head(pnadc_series_starting_points)  # See which series are available unique(pnadc_series_starting_points$series_name) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/sidra-series-metadata.html","id":null,"dir":"Reference","previous_headings":"","what":"SIDRA Series Metadata for PNADC Mensalization — sidra-series-metadata","title":"SIDRA Series Metadata for PNADC Mensalization — sidra-series-metadata","text":"file contains metadata definitions 86 SIDRA series used mensalization process. maps series names SIDRA API endpoints, table IDs, variable codes, hierarchical categorization.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/smooth_monthly_aggregates.html","id":null,"dir":"Reference","previous_headings":"","what":"Smooth Monthly Aggregates — smooth_monthly_aggregates","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"quarterly survey data converted monthly estimates, resulting time series often shows artificial quarterly patterns. function applies smoothing algorithm : Computes 3-month differences capture trends Stratifies month position within quarter (1st, 2nd, 3rd) Accumulates changes via cumulative sums Calibrates reference period Produces smooth monthly series preserve genuine variation","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/smooth_monthly_aggregates.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"","code":"smooth_monthly_aggregates(   monthly_aggregates,   calibration_start = 201301L,   calibration_end = 201912L )"},{"path":"https://antrologos.github.io/PNADCperiods/reference/smooth_monthly_aggregates.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"monthly_aggregates data.table monthly aggregated indicators. Required columns: ref_month_yyyymm: Month identifier YYYYMM format z_*: Indicator columns monthly totals (e.g., z_popocup) calibration_start Integer YYYYMM. Start calibration period. Default 201301. calibration_end Integer YYYYMM. End calibration period. Default 201912.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/smooth_monthly_aggregates.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"data.table original data plus smoothed estimates. Contains: ref_month_yyyymm: Month identifier (preserved input) Original z_* columns (unchanged) m_varname: Smoothed monthly estimate input z_varname","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/smooth_monthly_aggregates.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"Applies moving average methodology remove quarterly artifacts monthly estimates derived quarterly survey data. smoothing algorithm works follows: indicator variable: Compute 3-month difference: d3 = 3 * (value[t] - value[t-1]) Split month position (1, 2, 3 within quarter) Compute cumulative sum within position Calculate residual intermediate series calibration period Apply position-specific adjustment Final smoothed value uses moving average quarterly reference","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/smooth_monthly_aggregates.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"","code":"if (FALSE) { # \\dontrun{ # After calibrating weights, aggregate to monthly totals monthly_agg <- calibrated_data[, .(z_populacao = sum(weight_calibrated)), by = ref_month_yyyymm] smoothed <- smooth_monthly_aggregates(monthly_agg) } # }"},{"path":"https://antrologos.github.io/PNADCperiods/reference/utils-dates.html","id":null,"dir":"Reference","previous_headings":"","what":"Date Utility Functions — utils-dates","title":"Date Utility Functions — utils-dates","text":"Internal helper functions date calculations. file includes: Day week calculation (dow) ISO 8601 week utilities (Monday-Sunday weeks) IBGE first Saturday calculation reference weeks Month position calculation quarter mapping","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/utils-validation.html","id":null,"dir":"Reference","previous_headings":"","what":"Input Validation Utilities — utils-validation","title":"Input Validation Utilities — utils-validation","text":"Internal helper functions validating PNADC input data.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/validate_pnadc.html","id":null,"dir":"Reference","previous_headings":"","what":"Validate PNADC Input Data — validate_pnadc","title":"Validate PNADC Input Data — validate_pnadc","text":"Checks input data required columns specified processing.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/validate_pnadc.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Validate PNADC Input Data — validate_pnadc","text":"","code":"validate_pnadc(data, check_weights = FALSE, stop_on_error = TRUE)"},{"path":"https://antrologos.github.io/PNADCperiods/reference/validate_pnadc.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Validate PNADC Input Data — validate_pnadc","text":"data data.frame data.table PNADC microdata check_weights Logical. TRUE, also check weight-related variables. stop_on_error Logical. TRUE, stops error. FALSE, returns validation report list.","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/validate_pnadc.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Validate PNADC Input Data — validate_pnadc","text":"stop_on_error = TRUE, returns invisibly valid stops error. stop_on_error = FALSE, returns list : valid: Logical indicating data passed validations issues: Named list validation issues found (empty none) n_rows: Number rows input data n_cols: Number columns input data join_keys_available: Character vector available join key columns","code":""},{"path":"https://antrologos.github.io/PNADCperiods/reference/validate_pnadc.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Validate PNADC Input Data — validate_pnadc","text":"function performs following validations: Checks required columns reference period identification: Ano, Trimestre, UPA, V1008, V1014, V2008, V20081, V20082, V2009 Validates year range (2012-2100 PNADC coverage) Validates quarter values (must 1-4) Validates birth day values (must 1-31 99 unknown) Validates birth month values (must 1-12 99 unknown) Warns unusual ages (outside 0-130 range) check_weights = TRUE, also validates weight-related columns: V1028, UF, posest, posest_sxi","code":""},{"path":[]},{"path":"https://antrologos.github.io/PNADCperiods/reference/validate_pnadc.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Validate PNADC Input Data — validate_pnadc","text":"","code":"if (FALSE) { # \\dontrun{ validate_pnadc(my_data) validate_pnadc(my_data, check_weights = TRUE) } # }"}]
