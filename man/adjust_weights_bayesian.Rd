% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/adjust-weights-bayesian.R
\name{adjust_weights_bayesian}
\alias{adjust_weights_bayesian}
\title{Bayesian Weight Adjustment}
\usage{
adjust_weights_bayesian(data, monthly_targets, employment_detail = TRUE)
}
\arguments{
\item{data}{A data.table with microdata and calibrated weights (output from
\code{\link{calibrate_monthly_weights}}). Required columns:
\itemize{
\item \code{weight_calibrated}: Calibrated monthly weight
\item \code{ref_month_yyyymm}: Reference month
\item Employment variables: \code{VD4001}, \code{VD4002}, \code{VD4009}
\item Demographics: \code{V2009}, \code{posest}, \code{posest_sxi}, \code{V2010}
}}

\item{monthly_targets}{A data.table with smoothed monthly targets (output from
\code{\link{smooth_monthly_aggregates}}). Required columns:
\itemize{
\item \code{ref_month_yyyymm}: Month identifier
\item \code{m_*}: Smoothed monthly estimates for each employment category
}}

\item{employment_detail}{Logical. If TRUE (default), use detailed employment
categories including CNPJ distinction for employers and self-employed
(requires \code{V4019} column for post-2015 data).}
}
\value{
A data.table with the input data plus:
\itemize{
\item \code{weight_monthly}: Final Bayesian-adjusted monthly weight
\item \code{employment_status}: Employment situation code used in adjustment
}
}
\description{
After smoothing monthly aggregates, individual weights need adjustment so that
when summed, they match the smoothed totals. This function uses Bayes' theorem:

\deqn{P(status | category) = P(status) \times P(category | status) / P(category)}

Where:
\itemize{
\item status = employment situation (employed, unemployed, etc.)
\item category = demographic/geographic cell (age x region x etc.)
}
}
\details{
Adjusts individual survey weights to match smoothed monthly targets using
Bayesian posterior probabilities.

Employment status categories (sit):
\describe{
\item{1}{Private employee with formal contract}
\item{2}{Private employee without formal contract}
\item{3}{Domestic worker with formal contract}
\item{4}{Domestic worker without formal contract}
\item{5}{Public employee with formal contract}
\item{6}{Public employee without formal contract}
\item{7}{Military/statutory employee}
\item{8}{Employer}
\item{9}{Self-employed}
\item{10}{Unpaid family worker}
\item{20}{Unemployed}
\item{30}{Discouraged worker}
\item{40}{Potential labor force (not discouraged)}
\item{50}{Out of labor force}
\item{60}{Children (0-13)}
}
}
\examples{
\dontrun{
# After calibrating weights and smoothing aggregates
final_data <- adjust_weights_bayesian(calibrated_data, smoothed_targets)
}

}
\seealso{
\code{\link{calibrate_monthly_weights}}, \code{\link{smooth_monthly_aggregates}}
}
