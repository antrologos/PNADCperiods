% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mensalize-sidra-series.R
\name{compute_z_aggregates}
\alias{compute_z_aggregates}
\title{Compute z_ Aggregates Using Stata-Compatible Methodology}
\usage{
compute_z_aggregates(calibrated_data, verbose = TRUE)
}
\arguments{
\item{calibrated_data}{PNADC microdata output from \code{pnadc_apply_periods()}
with \code{calibrate = TRUE}. Must include \code{weight_monthly},
\code{ref_month_yyyymm}, and \code{ref_month_in_quarter}.}

\item{verbose}{Print progress messages.}
}
\value{
data.table with columns:
\describe{
\item{anomesexato}{Integer YYYYMM month}
\item{z_\if{html}{\out{<series>}}}{Numeric weighted aggregates for each series}
}
}
\description{
Computes monthly z_ aggregates from PNADC microdata. Can replicate Marcos
Hecksher's exact Stata calibration or use a corrected methodology that scales
all months to external population.
}
\details{
This function creates z_ indicator variables and aggregates them using the
calibrated \code{weight_monthly} from \code{pnadc_apply_periods()}.

The \code{pnadc_apply_periods()} function now implements Marcos Hecksher's
methodology correctly:
\itemize{
\item Month 2: Scaled to poptrim (quarterly V1028 sum from ALL observations)
\item Months 1,3: Scaled to SIDRA monthly population
}

This function simply aggregates the indicators using the already-calibrated weights.
}
\examples{
\dontrun{
# Step 1: Build crosswalk
crosswalk <- pnadc_identify_periods(stacked_data)

# Step 2: Calibrate weights (implements Marcos' methodology)
calibrated <- pnadc_apply_periods(stacked_data, crosswalk,
                                   weight_var = "V1028",
                                   calibration_unit = "month")

# Step 3: Compute z_ aggregates using calibrated weights
z_agg <- compute_z_aggregates(calibrated)

# Step 4: Compute starting points
rq <- fetch_sidra_rolling_quarters()
y0 <- compute_series_starting_points(z_agg, rq)
}

}
\seealso{
\code{\link{pnadc_apply_periods}} for the calibration step
\code{\link{compute_series_starting_points}} for the y0 computation
}
