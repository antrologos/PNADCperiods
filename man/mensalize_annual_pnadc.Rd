% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mensalize-annual.R
\name{mensalize_annual_pnadc}
\alias{mensalize_annual_pnadc}
\title{Mensalize Annual PNADC Data}
\usage{
mensalize_annual_pnadc(
  annual_data,
  crosswalk,
  calibrate_weights = TRUE,
  n_cells = 4L,
  keep_all = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{annual_data}{data.frame/data.table with annual PNADC data (stacked or single year).
Required columns (case-insensitive, will be converted to lowercase internally):
\itemize{
\item Join keys: \code{ano}, \code{trimestre}, \code{upa}, \code{v1008}, \code{v1014}, \code{v2003}
\item Weight: \code{v1032}
\item Demographics (for calibration): \code{v2009} (age), \code{uf}, \code{posest}, \code{posest_sxi}
}}

\item{crosswalk}{Output from \code{mensalizePNADC()} with reference month information.}

\item{calibrate_weights}{Logical. If TRUE (default), calibrate V1032 weights to
monthly SIDRA population totals using hierarchical rake weighting.
If FALSE, just merge crosswalk without calibration.}

\item{n_cells}{Integer (1-4). Number of hierarchical cell levels for raking.
Default is 4 (full hierarchy: age, posest_sxi, UF, posest).}

\item{keep_all}{Logical. Keep observations without determined reference month? Default TRUE.}

\item{verbose}{Logical. Print progress? Default TRUE.}
}
\value{
data.table with annual data merged with crosswalk plus:
\itemize{
\item \code{ref_month}, \code{ref_month_in_quarter}, \code{ref_month_yyyymm}: From crosswalk
\item \code{weight_monthly}: Calibrated monthly weight (if calibrate_weights = TRUE)
}
}
\description{
This function:
\enumerate{
\item Merges annual PNADC data with a crosswalk to add reference month information
\item Optionally calibrates V1032 weights using hierarchical rake weighting
\item Final calibration to SIDRA monthly population totals
}
}
\details{
Merges annual PNADC data with a mensalization crosswalk and optionally
calibrates the annual weights (V1032) to monthly population totals.
\subsection{Why Not Use Quarterly Crosswalk Weights?}{

The \code{weight_monthly} from the quarterly crosswalk is calibrated assuming all 5
panel visits are present in each quarter. Annual data has only 1 visit per observation,
so those weights are inappropriate.

This function uses the annual weight \code{V1032} as the starting point and applies:
\enumerate{
\item Hierarchical rake weighting within demographic cells (redistributing yearly
totals to months)
\item Final calibration to SIDRA monthly population totals
}
}
}
\examples{
\dontrun{
# Step 1: Create crosswalk from quarterly data
crosswalk <- mensalizePNADC(quarterly_data, compute_weights = FALSE)

# Step 2: Load and merge annual data with calibration
d <- mensalize_annual_pnadc(
  annual_data = annual_data,
  crosswalk = crosswalk,
  calibrate_weights = TRUE
)

# Use the calibrated weight
d[, .(pop = sum(weight_monthly)), by = ref_month_yyyymm]
}

}
\seealso{
\code{\link{mensalizePNADC}} for creating the crosswalk
}
